svgedit={NS:{HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}};svgedit.getReverseNS=function(){var a={};$.each(this.NS,function(J,A){a[A]=J.toLowerCase()});return a};(function(){var a=jQuery.fn.attr;jQuery.fn.attr=function(J,A){var i,c=this.length;if(!c)return a.apply(this,arguments);for(i=0;i<c;++i){var p=this[i];if(p.namespaceURI==="http://www.w3.org/2000/svg"){if(A!==undefined)p.setAttribute(J,A);else if($.isArray(J)){c=J.length;for(var e={};c--;){var h=J[c];if((i=p.getAttribute(h))||i==="0")i=isNaN(i)?i:i-0;e[h]=i}return e}if(typeof J==="object")for(e in J)p.setAttribute(e,J[e]);else{if((i=p.getAttribute(J))||i==="0")i=isNaN(i)?i:i-0;return i}}else return a.apply(this,
arguments)}return this}})();jQuery&&function(){var a=$(window),J=$(document);$.extend($.fn,{contextMenu:function(A,i){if(A.menu==undefined)return false;if(A.inSpeed==undefined)A.inSpeed=150;if(A.outSpeed==undefined)A.outSpeed=75;if(A.inSpeed==0)A.inSpeed=-1;if(A.outSpeed==0)A.outSpeed=-1;$(this).each(function(){var c=$(this),p=$(c).offset(),e=$("#"+A.menu);e.addClass("contextMenu");$(this).bind("mousedown",function(h){$(this).mouseup(function(r){var v=$(this);v.unbind("mouseup");if(h.button===2||A.allowLeft||h.ctrlKey&&svgedit.browser.isMac()){r.stopPropagation();
$(".contextMenu").hide();if(c.hasClass("disabled"))return false;var D=r.pageX,C=r.pageY;r=a.width()-e.width();var s=a.height()-e.height();if(D>r-15)D=r-15;if(C>s-30)C=s-30;J.unbind("click");e.css({top:C,left:D}).fadeIn(A.inSpeed);e.find("A").mouseover(function(){e.find("LI.hover").removeClass("hover");$(this).parent().addClass("hover")}).mouseout(function(){e.find("LI.hover").removeClass("hover")});J.keypress(function(q){switch(q.keyCode){case 38:if(e.find("LI.hover").length){e.find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover");
e.find("LI.hover").length||e.find("LI:last").addClass("hover")}else e.find("LI:last").addClass("hover");break;case 40:if(e.find("LI.hover").length==0)e.find("LI:first").addClass("hover");else{e.find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover");e.find("LI.hover").length||e.find("LI:first").addClass("hover")}break;case 13:e.find("LI.hover A").trigger("click");break;case 27:J.trigger("click")}});e.find("A").unbind("mouseup");e.find("LI:not(.disabled) A").mouseup(function(){J.unbind("click").unbind("keypress");
$(".contextMenu").hide();i&&i($(this).attr("href").substr(1),$(v),{x:D-p.left,y:C-p.top,docX:D,docY:C});return false});setTimeout(function(){J.click(function(){J.unbind("click").unbind("keypress");e.fadeOut(A.outSpeed);return false})},0)}})});if($.browser.mozilla)$("#"+A.menu).each(function(){$(this).css({MozUserSelect:"none"})});else $.browser.msie?$("#"+A.menu).each(function(){$(this).bind("selectstart.disableTextSelect",function(){return false})}):$("#"+A.menu).each(function(){$(this).bind("mousedown.disableTextSelect",
function(){return false})});$(c).add($("UL.contextMenu")).bind("contextmenu",function(){return false})});return $(this)},disableContextMenuItems:function(A){if(A==undefined){$(this).find("LI").addClass("disabled");return $(this)}$(this).each(function(){if(A!=undefined)for(var i=A.split(","),c=0;c<i.length;c++)$(this).find('A[href="'+i[c]+'"]').parent().addClass("disabled")});return $(this)},enableContextMenuItems:function(A){if(A==undefined){$(this).find("LI.disabled").removeClass("disabled");return $(this)}$(this).each(function(){if(A!=
undefined)for(var i=A.split(","),c=0;c<i.length;c++)$(this).find('A[href="'+i[c]+'"]').parent().removeClass("disabled")});return $(this)},disableContextMenu:function(){$(this).each(function(){$(this).addClass("disabled")});return $(this)},enableContextMenu:function(){$(this).each(function(){$(this).removeClass("disabled")});return $(this)},destroyContextMenu:function(){$(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")});return $(this)}})}(jQuery);(function(){if(!svgedit.browser)svgedit.browser={};var a=svgedit.NS,J=!!document.createElementNS&&!!document.createElementNS(a.SVG,"svg").createSVGRect;svgedit.browser.supportsSvg=function(){return J};if(svgedit.browser.supportsSvg()){var A=navigator.userAgent,i=document.createElementNS(a.SVG,"svg"),c=!!window.opera,p=A.indexOf("AppleWebKit")>=0,e=A.indexOf("Gecko/")>=0,h=A.indexOf("MSIE")>=0,r=A.indexOf("Chrome/")>=0,v=A.indexOf("Windows")>=0,D=A.indexOf("Macintosh")>=0,C="ontouchstart"in window,
s=!!i.querySelector,q=!!document.evaluate,z=function(){var fa=document.createElementNS(a.SVG,"path");fa.setAttribute("d","M0,0 10,10");var ka=fa.pathSegList;fa=fa.createSVGPathSegLinetoAbs(5,5);try{ka.replaceItem(fa,0);return true}catch(Ia){}return false}(),t=function(){var fa=document.createElementNS(a.SVG,"path");fa.setAttribute("d","M0,0 10,10");var ka=fa.pathSegList;fa=fa.createSVGPathSegLinetoAbs(5,5);try{ka.insertItemBefore(fa,0);return true}catch(Ia){}return false}(),j=function(){var fa=document.createElementNS(a.SVG,
"svg"),ka=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(fa);ka.setAttribute("x",5);fa.appendChild(ka);var Ia=document.createElementNS(a.SVG,"text");Ia.textContent="a";ka.appendChild(Ia);ka=Ia.getStartPositionOfChar(0).x;document.documentElement.removeChild(fa);return ka===0}(),I=function(){var fa=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(fa);var ka=document.createElementNS(a.SVG,"path");ka.setAttribute("d","M0,0 C0,0 10,10 10,0");fa.appendChild(ka);
ka=ka.getBBox();document.documentElement.removeChild(fa);return ka.height>4&&ka.height<5}(),T=function(){var fa=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(fa);var ka=document.createElementNS(a.SVG,"path");ka.setAttribute("d","M0,0 10,0");var Ia=document.createElementNS(a.SVG,"path");Ia.setAttribute("d","M5,0 15,0");var Ba=document.createElementNS(a.SVG,"g");Ba.appendChild(ka);Ba.appendChild(Ia);fa.appendChild(Ba);ka=Ba.getBBox();document.documentElement.removeChild(fa);
return ka.width==15}(),aa=function(){var fa=document.createElementNS(a.SVG,"rect");fa.setAttribute("x",0.1);(fa=fa.cloneNode(false).getAttribute("x").indexOf(",")==-1)||$.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\nPlease upgrade to the <a href="http://opera.com">latest version</a> in which the problems have been fixed.');return fa}(),oa=function(){var fa=document.createElementNS(a.SVG,"rect");fa.setAttribute("style","vector-effect:non-scaling-stroke");return fa.style.vectorEffect===
"non-scaling-stroke"}(),ea=function(){var fa=document.createElementNS(a.SVG,"rect").transform.baseVal,ka=i.createSVGTransform();fa.appendItem(ka);return fa.getItem(0)==ka}();svgedit.browser.isOpera=function(){return c};svgedit.browser.isWebkit=function(){return p};svgedit.browser.isGecko=function(){return e};svgedit.browser.isIE=function(){return h};svgedit.browser.isChrome=function(){return r};svgedit.browser.isWindows=function(){return v};svgedit.browser.isMac=function(){return D};svgedit.browser.isTouch=
function(){return C};svgedit.browser.supportsSelectors=function(){return s};svgedit.browser.supportsXpath=function(){return q};svgedit.browser.supportsPathReplaceItem=function(){return z};svgedit.browser.supportsPathInsertItemBefore=function(){return t};svgedit.browser.supportsPathBBox=function(){return I};svgedit.browser.supportsHVLineContainerBBox=function(){return T};svgedit.browser.supportsGoodTextCharPos=function(){return j};svgedit.browser.supportsEditableText=function(){return c};svgedit.browser.supportsGoodDecimals=
function(){return aa};svgedit.browser.supportsNonScalingStroke=function(){return oa};svgedit.browser.supportsNativeTransformLists=function(){return ea}}else window.location="browser-not-supported.html"})();(function(){if(!svgedit.transformlist)svgedit.transformlist={};var a=document.createElementNS(svgedit.NS.SVG,"svg"),J={};svgedit.transformlist.SVGTransformList=function(A){this._elem=A||null;this._xforms=[];this._update=function(){var i="";a.createSVGMatrix();var c;for(c=0;c<this.numberOfItems;++c){var p=this._list.getItem(c);i=i;p=p;var e=p.matrix,h="";switch(p.type){case 1:h="matrix("+[e.a,e.b,e.c,e.d,e.e,e.f].join(",")+")";break;case 2:h="translate("+e.e+","+e.f+")";break;case 3:h=e.a==e.d?"scale("+
e.a+")":"scale("+e.a+","+e.d+")";break;case 4:var r=0;h=0;if(p.angle!=0){r=1-e.a;h=(r*e.f+e.b*e.e)/(r*r+e.b*e.b);r=(e.e-e.b*h)/r}h="rotate("+p.angle+" "+r+","+h+")"}i=i+(h+" ")}this._elem.setAttribute("transform",i)};this._list=this;this._init=function(){var i=this._elem.getAttribute("transform");if(i)for(var c=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/,p=true;p;){p=i.match(c);i=i.replace(c,"");if(p&&p[1]){var e=p[1].split(/\s*\(/),h=e[0];e=e[1].match(/\s*(.*?)\s*\)/);e[1]=e[1].replace(/(\d)-/g,
"$1 -");var r=e[1].split(/[, ]+/),v="abcdef".split(""),D=a.createSVGMatrix();$.each(r,function(q,z){r[q]=parseFloat(z);if(h=="matrix")D[v[q]]=r[q]});e=a.createSVGTransform();var C="set"+h.charAt(0).toUpperCase()+h.slice(1),s=h=="matrix"?[D]:r;if(h=="scale"&&s.length==1)s.push(s[0]);else if(h=="translate"&&s.length==1)s.push(0);else h=="rotate"&&s.length==1&&s.push(0,0);e[C].apply(e,s);this._list.appendItem(e)}}};this._removeFromOtherLists=function(i){if(i){var c=false,p;for(p in J){var e=J[p],h,r;
h=0;for(r=e._xforms.length;h<r;++h)if(e._xforms[h]==i){c=true;e.removeItem(h);break}if(c)break}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(i){this.numberOfItems=1;this._removeFromOtherLists(i);this._xforms=[i]};this.getItem=function(i){if(i<this.numberOfItems&&i>=0)return this._xforms[i];throw{code:1};};this.insertItemBefore=function(i,c){var p=null;if(c>=0)if(c<this.numberOfItems){this._removeFromOtherLists(i);p=Array(this.numberOfItems+
1);var e;for(e=0;e<c;++e)p[e]=this._xforms[e];p[e]=i;var h;for(h=e+1;e<this.numberOfItems;++h,++e)p[h]=this._xforms[e];this.numberOfItems++;this._xforms=p;p=i;this._list._update()}else p=this._list.appendItem(i);return p};this.replaceItem=function(i,c){var p=null;if(c<this.numberOfItems&&c>=0){this._removeFromOtherLists(i);p=this._xforms[c]=i;this._list._update()}return p};this.removeItem=function(i){if(i<this.numberOfItems&&i>=0){var c=this._xforms[i],p=Array(this.numberOfItems-1),e;for(e=0;e<i;++e)p[e]=
this._xforms[e];for(i=e;i<this.numberOfItems-1;++i,++e)p[i]=this._xforms[e+1];this.numberOfItems--;this._xforms=p;this._list._update();return c}throw{code:1};};this.appendItem=function(i){this._removeFromOtherLists(i);this._xforms.push(i);this.numberOfItems++;this._list._update();return i}};svgedit.transformlist.resetListMap=function(){J={}};svgedit.transformlist.removeElementFromListMap=function(A){A.id&&J[A.id]&&delete J[A.id]};svgedit.transformlist.getTransformList=function(A){if(!svgedit.browser.supportsNativeTransformLists()){var i=
A.id||"temp",c=J[i];if(!c||i==="temp"){J[i]=new svgedit.transformlist.SVGTransformList(A);J[i]._init();c=J[i]}return c}if(A.transform)return A.transform.baseVal;if(A.gradientTransform)return A.gradientTransform.baseVal;if(A.patternTransform)return A.patternTransform.baseVal;return null}})();(function(){if(!svgedit.math)svgedit.math={};var a=document.createElementNS(svgedit.NS.SVG,"svg");svgedit.math.transformPoint=function(J,A,i){return{x:i.a*J+i.c*A+i.e,y:i.b*J+i.d*A+i.f}};svgedit.math.isIdentity=function(J){return J.a===1&&J.b===0&&J.c===0&&J.d===1&&J.e===0&&J.f===0};svgedit.math.matrixMultiply=function(){for(var J=arguments,A=J.length,i=J[A-1];A-- >1;)i=J[A-1].multiply(i);if(Math.abs(i.a)<1.0E-14)i.a=0;if(Math.abs(i.b)<1.0E-14)i.b=0;if(Math.abs(i.c)<1.0E-14)i.c=0;if(Math.abs(i.d)<
1.0E-14)i.d=0;if(Math.abs(i.e)<1.0E-14)i.e=0;if(Math.abs(i.f)<1.0E-14)i.f=0;return i};svgedit.math.hasMatrixTransform=function(J){if(!J)return false;for(var A=J.numberOfItems;A--;){var i=J.getItem(A);if(i.type==1&&!svgedit.math.isIdentity(i.matrix))return true}return false};svgedit.math.transformBox=function(J,A,i,c,p){var e=svgedit.math.transformPoint,h=e(J,A,p),r=e(J+i,A,p),v=e(J,A+c,p);J=e(J+i,A+c,p);A=Math.min(h.x,r.x,v.x,J.x);i=Math.min(h.y,r.y,v.y,J.y);return{tl:h,tr:r,bl:v,br:J,aabox:{x:A,
y:i,width:Math.max(h.x,r.x,v.x,J.x)-A,height:Math.max(h.y,r.y,v.y,J.y)-i}}};svgedit.math.transformListToTransform=function(J,A,i){if(J==null)return a.createSVGTransformFromMatrix(a.createSVGMatrix());A=A||0;i=i||J.numberOfItems-1;A=parseInt(A,10);i=parseInt(i,10);if(A>i){var c=i;i=A;A=c}c=a.createSVGMatrix();for(A=A;A<=i;++A){var p=A>=0&&A<J.numberOfItems?J.getItem(A).matrix:a.createSVGMatrix();c=svgedit.math.matrixMultiply(c,p)}return a.createSVGTransformFromMatrix(c)};svgedit.math.getMatrix=function(J){J=
svgedit.transformlist.getTransformList(J);return svgedit.math.transformListToTransform(J).matrix};svgedit.math.snapToAngle=function(J,A,i,c){var p=Math.PI/4;i=i-J;var e=c-A;c=Math.sqrt(i*i+e*e);p=Math.round(Math.atan2(e,i)/p)*p;return{x:J+c*Math.cos(p),y:A+c*Math.sin(p),a:p}};svgedit.math.rectsIntersect=function(J,A){return A.x<J.x+J.width&&A.x+A.width>J.x&&A.y<J.y+J.height&&A.y+A.height>J.y}})();(function(){if(!svgedit.units)svgedit.units={};var a=svgedit.NS,J=["x","x1","cx","rx","width"],A=["y","y1","cy","ry","height"],i=["r","radius"].concat(J,A),c,p={};svgedit.units.init=function(h){c=h;h=document.createElementNS(a.SVG,"svg");document.body.appendChild(h);var r=document.createElementNS(a.SVG,"rect");r.setAttribute("width","1em");r.setAttribute("height","1ex");r.setAttribute("x","1in");h.appendChild(r);r=r.getBBox();document.body.removeChild(h);h=r.x;p={em:r.width,ex:r.height,"in":h,cm:h/
2.54,mm:h/25.4,pt:h/72,pc:h/6,px:1,"%":0}};svgedit.units.getTypeMap=function(){return p};svgedit.units.shortFloat=function(h){var r=c.getRoundDigits();if(!isNaN(h))return+(+h).toFixed(r);if($.isArray(h))return svgedit.units.shortFloat(h[0])+","+svgedit.units.shortFloat(h[1]);return parseFloat(h).toFixed(r)-0};svgedit.units.convertUnit=function(h,r){r=r||c.getBaseUnit();return svgedit.units.shortFloat(h/p[r])};svgedit.units.setUnitAttr=function(h,r,v){h.setAttribute(r,v)};var e={line:["x1","x2","y1",
"y2"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],foreignObject:["x","y","width","height"],rect:["x","y","width","height"],image:["x","y","width","height"],use:["x","y","width","height"],text:["x","y"]};svgedit.units.convertAttrs=function(h){var r=h.tagName,v=c.getBaseUnit();if(r=e[r]){var D=r.length,C;for(C=0;C<D;C++){var s=r[C],q=h.getAttribute(s);if(q)isNaN(q)||h.setAttribute(s,q/p[v]+v)}}};svgedit.units.convertToNum=function(h,r){if(!isNaN(r))return r-0;var v;if(r.substr(-1)==="%"){v=
r.substr(0,r.length-1)/100;var D=c.getWidth(),C=c.getHeight();if(J.indexOf(h)>=0)return v*D;if(A.indexOf(h)>=0)return v*C;return v*Math.sqrt(D*D+C*C)/Math.sqrt(2)}D=r.substr(-2);v=r.substr(0,r.length-2);return v*p[D]};svgedit.units.isValidUnit=function(h,r,v){var D=false;if(i.indexOf(h)>=0)if(isNaN(r)){r=r.toLowerCase();$.each(p,function(q){if(!D)if(RegExp("^-?[\\d\\.]+"+q+"$").test(r))D=true})}else D=true;else if(h=="id"){h=false;try{var C=c.getElement(r);h=C==null||C===v}catch(s){}return h}return D=
true}})();(function(){function a(h){if(svgedit.browser.supportsHVLineContainerBBox())try{return h.getBBox()}catch(r){}var v=$.data(h,"ref"),D=null,C;if(v){C=$(v).children().clone().attr("visibility","hidden");$(e).append(C);D=C.filter("line, path")}else D=$(h).find("line, path");var s=false;if(D.length){D.each(function(){var q=this.getBBox();if(!q.width||!q.height)s=true});if(s){h=v?C:$(h).children();h=getStrokedBBox(h)}else h=h.getBBox()}else h=h.getBBox();v&&C.remove();return h}if(!svgedit.utilities)svgedit.utilities=
{};var J=svgedit.NS,A="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),i=null,c=null,p=null,e=null;svgedit.utilities.init=function(h){i=h;c=h.getDOMDocument();p=h.getDOMContainer();e=h.getSVGRoot()};svgedit.utilities.toXml=function(h){return h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/,"&#x27;")};svgedit.utilities.fromXml=function(h){return $("<p/>").html(h).text()};svgedit.utilities.encode64=
function(h){h=svgedit.utilities.encodeUTF8(h);if(window.btoa)return window.btoa(h);var r=Array(Math.floor((h.length+2)/3)*4),v,D,C,s,q,z,t=0,j=0;do{v=h.charCodeAt(t++);D=h.charCodeAt(t++);C=h.charCodeAt(t++);s=v>>2;v=(v&3)<<4|D>>4;q=(D&15)<<2|C>>6;z=C&63;if(isNaN(D))q=z=64;else if(isNaN(C))z=64;r[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(s);r[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(v);r[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(q);
r[j++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(z)}while(t<h.length);return r.join("")};svgedit.utilities.decode64=function(h){if(window.atob)return window.atob(h);var r="",v,D,C="",s,q="",z=0;h=h.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(h.charAt(z++));D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(h.charAt(z++));s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(h.charAt(z++));
q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(h.charAt(z++));v=v<<2|D>>4;D=(D&15)<<4|s>>2;C=(s&3)<<6|q;r+=String.fromCharCode(v);if(s!=64)r+=String.fromCharCode(D);if(q!=64)r+=String.fromCharCode(C)}while(z<h.length);return unescape(r)};svgedit.utilities.encodeUTF8=function(h){if(h===null||typeof h==="undefined")return"";h=String(h);var r="",v,D,C=0;v=D=0;C=h.length;var s;for(s=0;s<C;s++){var q=h.charCodeAt(s),z=null;if(q<128)D++;else if(q>127&&q<2048)z=String.fromCharCode(q>>
6|192,q&63|128);else if((q&63488)!=55296)z=String.fromCharCode(q>>12|224,q>>6&63|128,q&63|128);else{if((q&64512)!=55296)throw new RangeError("Unmatched trail surrogate at "+s);z=h.charCodeAt(++s);if((z&64512)!=56320)throw new RangeError("Unmatched lead surrogate at "+(s-1));q=((q&1023)<<10)+(z&1023)+65536;z=String.fromCharCode(q>>18|240,q>>12&63|128,q>>6&63|128,q&63|128)}if(z!==null){if(D>v)r+=h.slice(v,D);r+=z;v=D=s+1}}if(D>v)r+=h.slice(v,C);return r};svgedit.utilities.convertToXMLReferences=function(h){var r,
v="";for(r=0;r<h.length;r++){var D=h.charCodeAt(r);if(D<128)v+=h[r];else if(D>127)v+="&#"+D+";"}return v};svgedit.utilities.text2xml=function(h){if(h.indexOf("<svg:svg")>=0)h=h.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns");var r,v;try{v=window.DOMParser?new DOMParser:new ActiveXObject("Microsoft.XMLDOM");v.async=false}catch(D){throw Error("XML Parser could not be instantiated");}try{r=v.loadXML?v.loadXML(h)?v:false:v.parseFromString(h,"text/xml")}catch(C){throw Error("Error parsing XML string");
}return r};svgedit.utilities.bboxToObj=function(h){return{x:h.x,y:h.y,width:h.width,height:h.height}};svgedit.utilities.walkTree=function(h,r){if(h&&h.nodeType==1){r(h);for(var v=h.childNodes.length;v--;)svgedit.utilities.walkTree(h.childNodes.item(v),r)}};svgedit.utilities.walkTreePost=function(h,r){if(h&&h.nodeType==1){for(var v=h.childNodes.length;v--;)svgedit.utilities.walkTree(h.childNodes.item(v),r);r(h)}};svgedit.utilities.getUrlFromAttr=function(h){if(h){if(h.indexOf('url("')===0)return h.substring(5,
h.indexOf('"',6));if(h.indexOf("url('")===0)return h.substring(5,h.indexOf("'",6));if(h.indexOf("url(")===0)return h.substring(4,h.indexOf(")"))}return null};svgedit.utilities.getHref=function(h){return h.getAttributeNS(J.XLINK,"href")};svgedit.utilities.setHref=function(h,r){h.setAttributeNS(J.XLINK,"xlink:href",r)};svgedit.utilities.findDefs=function(){var h=i.getSVGContent(),r=h.getElementsByTagNameNS(J.SVG,"defs");if(r.length>0)r=r[0];else{r=h.ownerDocument.createElementNS(J.SVG,"defs");h.firstChild?
h.insertBefore(r,h.firstChild.nextSibling):h.appendChild(r)}return r};svgedit.utilities.getPathBBox=function(h){var r=h.pathSegList,v=r.numberOfItems;h=[[],[]];var D=r.getItem(0),C=[D.x,D.y];for(D=0;D<v;D++){var s=r.getItem(D);if(typeof s.x!=="undefined"){h[0].push(C[0]);h[1].push(C[1]);if(s.x1){var q=[s.x1,s.y1],z=[s.x2,s.y2],t=[s.x,s.y],j;for(j=0;j<2;j++){s=function(ea){return Math.pow(1-ea,3)*C[j]+3*Math.pow(1-ea,2)*ea*q[j]+3*(1-ea)*Math.pow(ea,2)*z[j]+Math.pow(ea,3)*t[j]};var I=6*C[j]-12*q[j]+
6*z[j],T=-3*C[j]+9*q[j]-9*z[j]+3*t[j],aa=3*q[j]-3*C[j];if(T==0){if(I!=0){I=-aa/I;0<I&&I<1&&h[j].push(s(I))}}else{aa=Math.pow(I,2)-4*aa*T;if(!(aa<0)){var oa=(-I+Math.sqrt(aa))/(2*T);0<oa&&oa<1&&h[j].push(s(oa));I=(-I-Math.sqrt(aa))/(2*T);0<I&&I<1&&h[j].push(s(I))}}}C=t}else{h[0].push(s.x);h[1].push(s.y)}}}r=Math.min.apply(null,h[0]);v=Math.max.apply(null,h[0])-r;D=Math.min.apply(null,h[1]);h=Math.max.apply(null,h[1])-D;return{x:r,y:D,width:v,height:h}};svgedit.utilities.getBBox=function(h){var r=h||
i.geSelectedElements()[0];if(h.nodeType!=1)return null;h=null;var v=r.nodeName;switch(v){case "text":if(r.textContent===""){r.textContent="a";h=r.getBBox();r.textContent=""}else try{h=r.getBBox()}catch(D){}break;case "path":if(svgedit.browser.supportsPathBBox())try{h=r.getBBox()}catch(C){}else h=svgedit.utilities.getPathBBox(r);break;case "g":case "a":h=a(r);break;default:if(v==="use")h=a(r,true);if(v==="use"||v==="foreignObject"&&svgedit.browser.isWebkit()){h||(h=r.getBBox());v={};v.width=h.width;
v.height=h.height;v.x=h.x+parseFloat(r.getAttribute("x")||0);v.y=h.y+parseFloat(r.getAttribute("y")||0);h=v}else if(~A.indexOf(v))try{h=r.getBBox()}catch(s){r=$(r).closest("foreignObject");if(r.length)try{h=r[0].getBBox()}catch(q){h=null}else h=null}}if(h)h=svgedit.utilities.bboxToObj(h);return h};svgedit.utilities.getRotationAngle=function(h,r){var v=h||i.getSelectedElements()[0];v=svgedit.transformlist.getTransformList(v);if(!v)return 0;var D=v.numberOfItems,C;for(C=0;C<D;++C){var s=v.getItem(C);
if(s.type==4)return r?s.angle*Math.PI/180:s.angle}return 0};svgedit.utilities.getRefElem=function(h){return svgedit.utilities.getElem(svgedit.utilities.getUrlFromAttr(h).substr(1))};svgedit.utilities.getElem=svgedit.browser.supportsSelectors()?function(h){return e.querySelector("#"+h)}:svgedit.browser.supportsXpath()?function(h){return c.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+h+'"]',p,function(){return svgedit.NS.SVG},9,null).singleNodeValue}:function(h){return $(e).find("[id="+h+"]")[0]};
svgedit.utilities.assignAttributes=function(h,r,v,D){v||(v=0);svgedit.browser.isOpera()||e.suspendRedraw(v);for(var C in r)if(v=C.substr(0,4)==="xml:"?J.XML:C.substr(0,6)==="xlink:"?J.XLINK:null)h.setAttributeNS(v,C,r[C]);else D?svgedit.units.setUnitAttr(h,C,r[C]):h.setAttribute(C,r[C]);svgedit.browser.isOpera()||e.unsuspendRedraw(null)};svgedit.utilities.cleanupElement=function(h){var r=e.suspendRedraw(60),v={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter",
"stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0},D;for(D in v){var C=v[D];h.getAttribute(D)==C&&h.removeAttribute(D)}e.unsuspendRedraw(r)};svgedit.utilities.snapToGrid=function(h){var r=i.getSnappingStep(),v=i.getBaseUnit();if(v!=="px")r*=svgedit.units.getTypeMap()[v];return h=Math.round(h/r)*r};svgedit.utilities.preg_quote=function(h,r){return String(h).replace(RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(r||"")+"-]","g"),"\\$&")}})();(function(){if(!svgedit.sanitize)svgedit.sanitize={};var a=svgedit.NS,J=svgedit.getReverseNS(),A={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask",
"opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin",
"stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display",
"fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id",
"class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["sid","class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity",
"stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id",
"r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class",
"clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures",
"spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],
mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing",
"width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},i={};$.each(A,function(c,p){var e={};$.each(p,function(h,r){if(r.indexOf(":")>=0){var v=r.split(":");e[v[1]]=a[v[0].toUpperCase()]}else e[r]=r=="xmlns"?a.XMLNS:null});i[c]=e});svgedit.sanitize.sanitizeSvg=function(c){if(c.nodeType==3){c.nodeValue=c.nodeValue.replace(/^\s+|\s+$/g,"");c.nodeValue.length===0&&c.parentNode.removeChild(c)}if(c.nodeType==1){var p=
c.parentNode;if(c.ownerDocument&&p){var e=A[c.nodeName],h=i[c.nodeName],r;if(typeof e!=="undefined"){var v=[];for(r=c.attributes.length;r--;){var D=c.attributes.item(r),C=D.nodeName,s=D.localName,q=D.namespaceURI;if(!(h.hasOwnProperty(s)&&q==h[s]&&q!=a.XMLNS)&&!(q==a.XMLNS&&J[D.nodeValue])){C.indexOf("se:")===0&&v.push([C,D.nodeValue]);c.removeAttributeNS(q,s)}if(svgedit.browser.isGecko())switch(C){case "transform":case "gradientTransform":case "patternTransform":s=D.nodeValue.replace(/(\d)-/g,"$1 -");
c.setAttribute(C,s)}if(C=="style"){D=D.nodeValue.split(";");for(C=D.length;C--;){q=D[C].split(":");s=$.trim(q[0]);q=$.trim(q[1]);e.indexOf(s)>=0&&c.setAttribute(s,q)}c.removeAttribute("style")}}$.each(v,function(z,t){c.setAttributeNS(a.SE,t[0],t[1])});if((r=svgedit.utilities.getHref(c))&&["filter","linearGradient","pattern","radialGradient","textPath","use"].indexOf(c.nodeName)>=0)if(r[0]!="#"){svgedit.utilities.setHref(c,"");c.removeAttributeNS(a.XLINK,"href")}if(c.nodeName=="use"&&!svgedit.utilities.getHref(c))p.removeChild(c);
else{$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(z,t){var j=c.getAttribute(t);if(j)if((j=svgedit.utilities.getUrlFromAttr(j))&&j[0]!=="#"){c.setAttribute(t,"");c.removeAttribute(t)}});for(r=c.childNodes.length;r--;)svgedit.sanitize.sanitizeSvg(c.childNodes.item(r))}}else{e=[];for(console.log(c.firstChild,c);c.hasChildNodes();)e.push(p.insertBefore(c.firstChild,c));p.removeChild(c);for(r=e.length;r--;)svgedit.sanitize.sanitizeSvg(e[r])}}}}})();(function(){if(!svgedit.history)svgedit.history={};svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};svgedit.history.MoveElementCommand=function(a,J,A,i){this.elem=a;this.text=i?"Move "+a.tagName+" to "+i:"Move "+a.tagName;this.oldNextSibling=J;this.oldParent=A;this.newNextSibling=a.nextSibling;this.newParent=a.parentNode};svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"};
svgedit.history.MoveElementCommand.prototype.type=svgedit.history.MoveElementCommand.type;svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.MoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.MoveElementCommand.prototype.unapply=
function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.InsertElementCommand=function(a,J){this.elem=a;this.text=J||"Create "+a.tagName;this.parent=a.parentNode;this.nextSibling=this.elem.nextSibling};svgedit.history.InsertElementCommand.type=
function(){return"svgedit.history.InsertElementCommand"};svgedit.history.InsertElementCommand.prototype.type=svgedit.history.InsertElementCommand.type;svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text};svgedit.history.InsertElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.InsertElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.RemoveElementCommand=function(a,J,A,i){this.elem=a;this.text=i||"Delete "+a.tagName;
this.nextSibling=J;this.parent=A;svgedit.transformlist.removeElementFromListMap(a)};svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"};svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type;svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.RemoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);
svgedit.transformlist.removeElementFromListMap(this.elem);this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.RemoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);svgedit.transformlist.removeElementFromListMap(this.elem);this.nextSibling==null&&window.console&&console.log("Error: reference element was lost");
this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.ChangeElementCommand=function(a,J,A){this.elem=a;this.text=A?"Change "+a.tagName+" "+A:"Change "+a.tagName;this.newValues={};this.oldValues=J;for(var i in J)this.newValues[i]=i=="#text"?a.textContent:i=="#href"?svgedit.utilities.getHref(a):a.getAttribute(i)};svgedit.history.ChangeElementCommand.type=
function(){return"svgedit.history.ChangeElementCommand"};svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type;svgedit.history.ChangeElementCommand.prototype.getText=function(){return this.text};svgedit.history.ChangeElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var J=false,A;for(A in this.newValues){if(this.newValues[A])if(A=="#text")this.elem.textContent=this.newValues[A];else A=="#href"?
svgedit.utilities.setHref(this.elem,this.newValues[A]):this.elem.setAttribute(A,this.newValues[A]);else if(A=="#text")this.elem.textContent="";else{this.elem.setAttribute(A,"");this.elem.removeAttribute(A)}if(A=="transform")J=true}if(!J)if(J=svgedit.utilities.getRotationAngle(this.elem)){A=elem.getBBox();J=["rotate(",J," ",A.x+A.width/2,",",A.y+A.height/2,")"].join("");J!=elem.getAttribute("transform")&&elem.setAttribute("transform",J)}a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this);return true};svgedit.history.ChangeElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var J=false,A;for(A in this.oldValues){if(this.oldValues[A])if(A=="#text")this.elem.textContent=this.oldValues[A];else A=="#href"?svgedit.utilities.setHref(this.elem,this.oldValues[A]):this.elem.setAttribute(A,this.oldValues[A]);else if(A=="#text")this.elem.textContent="";else this.elem.removeAttribute(A);if(A=="transform")J=true}if(!J)if(J=
svgedit.utilities.getRotationAngle(this.elem)){A=elem.getBBox();J=["rotate(",J," ",A.x+A.width/2,",",A.y+A.height/2,")"].join("");J!=elem.getAttribute("transform")&&elem.setAttribute("transform",J)}svgedit.transformlist.removeElementFromListMap(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this);return true};svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.BatchCommand=function(a){this.text=a||"Batch Command";
this.stack=[]};svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"};svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type;svgedit.history.BatchCommand.prototype.getText=function(){return this.text};svgedit.history.BatchCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var J,A=this.stack.length;for(J=0;J<A;++J)this.stack[J].apply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.BatchCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var J;for(J=this.stack.length-1;J>=0;J--)this.stack[J].unapply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.BatchCommand.prototype.elements=function(){for(var a=[],J=this.stack.length;J--;)for(var A=this.stack[J].elements(),i=A.length;i--;)a.indexOf(A[i])==-1&&a.push(A[i]);return a};svgedit.history.BatchCommand.prototype.addSubCommand=
function(a){this.stack.push(a)};svgedit.history.BatchCommand.prototype.isEmpty=function(){return this.stack.length===0};svgedit.history.UndoManager=function(a){this.handler_=a||null;this.undoStackPointer=0;this.undoStack=[];this.undoChangeStackPointer=-1;this.undoableChangeStack=[]};svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[];this.undoStackPointer=0};svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer};svgedit.history.UndoManager.prototype.getRedoStackSize=
function(){return this.undoStack.length-this.undoStackPointer};svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""};svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""};svgedit.history.UndoManager.prototype.undo=function(){this.undoStackPointer>0&&this.undoStack[--this.undoStackPointer].unapply(this.handler_)};
svgedit.history.UndoManager.prototype.redo=function(){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&this.undoStack[this.undoStackPointer++].apply(this.handler_)};svgedit.history.UndoManager.prototype.addCommandToHistory=function(a){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0)this.undoStack=this.undoStack.splice(0,this.undoStackPointer);this.undoStack.push(a);this.undoStackPointer=this.undoStack.length};svgedit.history.UndoManager.prototype.beginUndoableChange=
function(a,J){for(var A=++this.undoChangeStackPointer,i=J.length,c=Array(i),p=Array(i);i--;){var e=J[i];if(e!=null){p[i]=e;c[i]=e.getAttribute(a)}}this.undoableChangeStack[A]={attrName:a,oldValues:c,elements:p}};svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var a=this.undoChangeStackPointer--,J=this.undoableChangeStack[a],A=J.elements.length,i=J.attrName,c=new svgedit.history.BatchCommand("Change "+i);A--;){var p=J.elements[A];if(p!=null){var e={};e[i]=J.oldValues[A];e[i]!=
p.getAttribute(i)&&c.addSubCommand(new svgedit.history.ChangeElementCommand(p,e,i))}}this.undoableChangeStack[a]=null;return c}})();var svgedit=svgedit||{};
(function(){if(!svgedit.coords)svgedit.coords={};var a=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],J=null;svgedit.coords.init=function(A){J=A};svgedit.coords.remapElement=function(A,i,c){var p,e,h=function(z,t){return svgedit.math.transformPoint(z,t,c)},r=J.getGridSnapping()&&A.parentNode.parentNode.localName==="svg",v=function(){var z;if(r)for(z in i)i[z]=svgedit.utilities.snapToGrid(i[z]);svgedit.utilities.assignAttributes(A,i,1E3,true)},D=svgedit.utilities.getBBox(A);
for(p=0;p<2;p++){e=p===0?"fill":"stroke";var C=A.getAttribute(e);if(C&&C.indexOf("url(")===0)if(c.a<0||c.d<0){C=svgedit.utilities.getRefElem(C).cloneNode(true);if(c.a<0){var s=C.getAttribute("x1"),q=C.getAttribute("x2");C.setAttribute("x1",-(s-1));C.setAttribute("x2",-(q-1))}if(c.d<0){s=C.getAttribute("y1");q=C.getAttribute("y2");C.setAttribute("y1",-(s-1));C.setAttribute("y2",-(q-1))}C.id=J.getDrawing().getNextId();svgedit.utilities.findDefs().appendChild(C);A.setAttribute(e,"url(#"+C.id+")")}}p=
A.tagName;if(p==="g"||p==="text"||p=="tspan"||p==="use")if(c.a==1&&c.b==0&&c.c==0&&c.d==1&&(c.e!=0||c.f!=0)){e=svgedit.math.transformListToTransform(A).matrix;e=svgedit.math.matrixMultiply(e.inverse(),c,e);i.x=parseFloat(i.x)+e.e;i.y=parseFloat(i.y)+e.f}else{e=svgedit.transformlist.getTransformList(A);C=svgroot.createSVGTransform();C.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(e).matrix,c));e.clear();e.appendItem(C)}switch(p){case "foreignObject":case "rect":case "image":if(p===
"image"&&(c.a<0||c.d<0)){e=svgedit.transformlist.getTransformList(A);C=svgroot.createSVGTransform();C.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(e).matrix,c));e.clear();e.appendItem(C)}else{C=h(i.x,i.y);i.width=c.a*i.width;i.height=c.d*i.height;i.x=C.x+Math.min(0,i.width);i.y=C.y+Math.min(0,i.height);i.width=Math.abs(i.width);i.height=Math.abs(i.height)}v();break;case "ellipse":h=h(i.cx,i.cy);i.cx=h.x;i.cy=h.y;i.rx=c.a*i.rx;i.ry=c.d*i.ry;i.rx=Math.abs(i.rx);i.ry=Math.abs(i.ry);
v();break;case "circle":h=h(i.cx,i.cy);i.cx=h.x;i.cy=h.y;h=svgedit.math.transformBox(D.x,D.y,D.width,D.height,c);i.r=Math.min((h.tr.x-h.tl.x)/2,(h.bl.y-h.tl.y)/2);if(i.r)i.r=Math.abs(i.r);v();break;case "line":C=h(i.x1,i.y1);s=h(i.x2,i.y2);i.x1=C.x;i.y1=C.y;i.x2=s.x;i.y2=s.y;case "text":case "tspan":case "use":v();break;case "g":(h=$(A).data("gsvg"))&&svgedit.utilities.assignAttributes(h,i,1E3,true);break;case "polyline":case "polygon":v=i.points.length;for(p=0;p<v;++p){e=i.points[p];e=h(e.x,e.y);
i.points[p].x=e.x;i.points[p].y=e.y}v=i.points.length;h="";for(p=0;p<v;++p){e=i.points[p];h+=e.x+","+e.y+" "}A.setAttribute("points",h);break;case "path":e=A.pathSegList;v=e.numberOfItems;i.d=[];for(p=0;p<v;++p){D=e.getItem(p);i.d[p]={type:D.pathSegType,x:D.x,y:D.y,x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,r1:D.r1,r2:D.r2,angle:D.angle,largeArcFlag:D.largeArcFlag,sweepFlag:D.sweepFlag}}v=i.d.length;p=i.d[0];q=h(p.x,p.y);i.d[0].x=q.x;i.d[0].y=q.y;for(p=1;p<v;++p){D=i.d[p];e=D.type;if(e%2==0){e=h(D.x!=undefined?
D.x:q.x,D.y!=undefined?D.y:q.y);C=h(D.x1,D.y1);s=h(D.x2,D.y2);D.x=e.x;D.y=e.y;D.x1=C.x;D.y1=C.y;D.x2=s.x;D.y2=s.y}else{D.x=c.a*D.x;D.y=c.d*D.y;D.x1=c.a*D.x1;D.y1=c.d*D.y1;D.x2=c.a*D.x2;D.y2=c.d*D.y2}D.r1=c.a*D.r1;D.r2=c.d*D.r2}h="";v=i.d.length;for(p=0;p<v;++p){D=i.d[p];e=D.type;h+=a[e];switch(e){case 13:case 12:h+=D.x+" ";break;case 15:case 14:h+=D.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:h+=D.x+","+D.y+" ";break;case 7:case 6:h+=D.x1+","+D.y1+" "+D.x2+","+D.y2+" "+D.x+","+D.y+" ";
break;case 9:case 8:h+=D.x1+","+D.y1+" "+D.x+","+D.y+" ";break;case 11:case 10:h+=D.r1+","+D.r2+" "+D.angle+" "+ +D.largeArcFlag+" "+ +D.sweepFlag+" "+D.x+","+D.y+" ";break;case 17:case 16:h+=D.x2+","+D.y2+" "+D.x+","+D.y+" "}}A.setAttribute("d",h)}}})();svgedit=svgedit||{};
(function(){if(!svgedit.recalculate)svgedit.recalculate={};var a=svgedit.NS,J;svgedit.recalculate.init=function(A){J=A};svgedit.recalculate.updateClipPath=function(A,i,c){A=getRefElem(A).firstChild;var p=svgedit.transformlist.getTransformList(A),e=J.getSVGRoot().createSVGTransform();e.setTranslate(i,c);p.appendItem(e);svgedit.recalculate.recalculateDimensions(A)};svgedit.recalculate.recalculateDimensions=function(A){if(A==null)return null;if(A.nodeName=="svg"&&navigator.userAgent.indexOf("Firefox/20")>=0)return null;
var i=J.getSVGRoot(),c=svgedit.transformlist.getTransformList(A),p;if(c&&c.numberOfItems>0){for(p=c.numberOfItems;p--;){var e=c.getItem(p);if(e.type===0)c.removeItem(p);else if(e.type===1)svgedit.math.isIdentity(e.matrix)&&c.removeItem(p);else e.type===4&&e.angle===0&&c.removeItem(p)}if(c.numberOfItems===1&&svgedit.utilities.getRotationAngle(A))return null}if(!c||c.numberOfItems==0){A.setAttribute("transform","");A.removeAttribute("transform");return null}if(c){p=c.numberOfItems;for(var h=[];p--;){e=
c.getItem(p);if(e.type===1)h.push([e.matrix,p]);else if(h.length)h=[]}if(h.length===2){p=i.createSVGTransformFromMatrix(svgedit.math.matrixMultiply(h[1][0],h[0][0]));c.removeItem(h[0][1]);c.removeItem(h[1][1]);c.insertItemBefore(p,h[1][1])}p=c.numberOfItems;if(p>=2&&c.getItem(p-2).type===1&&c.getItem(p-1).type===2){h=i.createSVGTransform();e=svgedit.math.matrixMultiply(c.getItem(p-2).matrix,c.getItem(p-1).matrix);h.setMatrix(e);c.removeItem(p-2);c.removeItem(p-2);c.appendItem(h)}}switch(A.tagName){case "line":case "polyline":case "polygon":case "path":break;
default:if(c.numberOfItems===1&&c.getItem(0).type===1||c.numberOfItems===2&&c.getItem(0).type===1&&c.getItem(0).type===4)return null}var r=$(A).data("gsvg");p=new svgedit.history.BatchCommand("Transform");var v={},D=null;e=[];switch(A.tagName){case "line":e=["x1","y1","x2","y2"];break;case "circle":e=["cx","cy","r"];break;case "ellipse":e=["cx","cy","rx","ry"];break;case "foreignObject":case "rect":case "image":e=["width","height","x","y"];break;case "use":case "text":case "tspan":e=["x","y"];break;
case "polygon":case "polyline":D={};D.points=A.getAttribute("points");h=A.points;var C=h.numberOfItems;v.points=Array(C);var s;for(s=0;s<C;++s){var q=h.getItem(s);v.points[s]={x:q.x,y:q.y}}break;case "path":D={};D.d=A.getAttribute("d");v.d=A.getAttribute("d")}if(e.length){v=$(A).attr(e);$.each(v,function(Ya,ya){v[Ya]=svgedit.units.convertToNum(Ya,ya)})}else if(r)v={x:$(r).attr("x")||0,y:$(r).attr("y")||0};if(D==null){D=$.extend(true,{},v);$.each(D,function(Ya,ya){D[Ya]=svgedit.units.convertToNum(Ya,
ya)})}D.transform=J.getStartTransform()||"";if(A.tagName=="g"&&!r||A.tagName=="a"){h=svgedit.utilities.getBBox(A);var z={x:h.x+h.width/2,y:h.y+h.height/2},t=svgedit.math.transformPoint(h.x+h.width/2,h.y+h.height/2,svgedit.math.transformListToTransform(c).matrix);e=i.createSVGMatrix();if(h=svgedit.utilities.getRotationAngle(A)){s=h*Math.PI/180;C=Math.abs(s)>1.0E-10?Math.sin(s)/(1-Math.cos(s)):2/s;for(s=0;s<c.numberOfItems;++s){e=c.getItem(s);if(e.type==4){e=e.matrix;z.y=(C*e.e+e.f)/2;z.x=(e.e-C*e.f)/
2;c.removeItem(s);break}}}s=e=r=0;var j=c.numberOfItems;if(j)var I=c.getItem(0).matrix;if(j>=3&&c.getItem(j-2).type==3&&c.getItem(j-3).type==2&&c.getItem(j-1).type==2){s=3;var T=c.getItem(j-3).matrix,aa=c.getItem(j-2).matrix,oa=c.getItem(j-1).matrix;C=A.childNodes;for(q=C.length;q--;){var ea=C.item(q);e=r=0;if(ea.nodeType==1){var fa=svgedit.transformlist.getTransformList(ea);if(fa){e=svgedit.math.transformListToTransform(fa).matrix;r=svgedit.utilities.getRotationAngle(ea);var ka=J.getStartTransform(),
Ia=[];J.setStartTransform(ea.getAttribute("transform"));if(r||svgedit.math.hasMatrixTransform(fa)){var Ba=i.createSVGTransform();Ba.setMatrix(svgedit.math.matrixMultiply(T,aa,oa,e));fa.clear();fa.appendItem(Ba);Ia.push(Ba)}else{r=svgedit.math.matrixMultiply(e.inverse(),oa,e);Ba=i.createSVGMatrix();Ba.e=-r.e;Ba.f=-r.f;e=svgedit.math.matrixMultiply(Ba.inverse(),e.inverse(),T,aa,oa,e,r.inverse());var Ab=i.createSVGTransform(),Bb=i.createSVGTransform(),mb=i.createSVGTransform();Ab.setTranslate(r.e,r.f);
Bb.setScale(e.a,e.d);mb.setTranslate(Ba.e,Ba.f);fa.appendItem(mb);fa.appendItem(Bb);fa.appendItem(Ab);Ia.push(mb);Ia.push(Bb);Ia.push(Ab)}p.addSubCommand(svgedit.recalculate.recalculateDimensions(ea));J.setStartTransform(ka)}}}c.removeItem(j-1);c.removeItem(j-2);c.removeItem(j-3)}else if(j>=3&&c.getItem(j-1).type==1){s=3;e=svgedit.math.transformListToTransform(c).matrix;Ba=i.createSVGTransform();Ba.setMatrix(e);c.clear();c.appendItem(Ba)}else if((j==1||j>1&&c.getItem(1).type!=3)&&c.getItem(0).type==
2){s=2;r=svgedit.math.transformListToTransform(c).matrix;c.removeItem(0);e=svgedit.math.transformListToTransform(c).matrix.inverse();e=svgedit.math.matrixMultiply(e,r);r=e.e;e=e.f;if(r!=0||e!=0){C=A.childNodes;q=C.length;for(j=[];q--;){ea=C.item(q);if(ea.nodeType==1){if(ea.getAttribute("clip-path")){ka=ea.getAttribute("clip-path");if(j.indexOf(ka)===-1){svgedit.recalculate.updateClipPath(ka,r,e);j.push(ka)}}ka=J.getStartTransform();J.setStartTransform(ea.getAttribute("transform"));if(fa=svgedit.transformlist.getTransformList(ea)){T=
i.createSVGTransform();T.setTranslate(r,e);fa.numberOfItems?fa.insertItemBefore(T,0):fa.appendItem(T);p.addSubCommand(svgedit.recalculate.recalculateDimensions(ea));fa=A.getElementsByTagNameNS(a.SVG,"use");ea="#"+ea.id;for(T=fa.length;T--;){aa=fa.item(T);if(ea==svgedit.utilities.getHref(aa)){oa=i.createSVGTransform();oa.setTranslate(-r,-e);svgedit.transformlist.getTransformList(aa).insertItemBefore(oa,0);p.addSubCommand(svgedit.recalculate.recalculateDimensions(aa))}}J.setStartTransform(ka)}}}j=[];
J.setStartTransform(ka)}}else if(j==1&&c.getItem(0).type==1&&!h){s=1;e=c.getItem(0).matrix;C=A.childNodes;for(q=C.length;q--;){ea=C.item(q);if(ea.nodeType==1){ka=J.getStartTransform();J.setStartTransform(ea.getAttribute("transform"));if(fa=svgedit.transformlist.getTransformList(ea)){r=svgedit.math.matrixMultiply(e,svgedit.math.transformListToTransform(fa).matrix);j=i.createSVGTransform();j.setMatrix(r);fa.clear();fa.appendItem(j,0);p.addSubCommand(svgedit.recalculate.recalculateDimensions(ea));J.setStartTransform(ka);
ka=ea.getAttribute("stroke-width");ea.getAttribute("stroke")!=="none"&&!isNaN(ka)&&ea.setAttribute("stroke-width",ka*((Math.abs(r.a)+Math.abs(r.d))/2))}}}c.clear()}else{if(h){i=i.createSVGTransform();i.setRotate(h,t.x,t.y);c.numberOfItems?c.insertItemBefore(i,0):c.appendItem(i)}c.numberOfItems==0&&A.removeAttribute("transform");return null}if(s==2){if(h){t={x:z.x+I.e,y:z.y+I.f};i=i.createSVGTransform();i.setRotate(h,t.x,t.y);c.numberOfItems?c.insertItemBefore(i,0):c.appendItem(i)}}else if(s==3){e=
svgedit.math.transformListToTransform(c).matrix;I=i.createSVGTransform();I.setRotate(h,z.x,z.y);I=I.matrix;z=i.createSVGTransform();z.setRotate(h,t.x,t.y);t=z.matrix.inverse();ka=e.inverse();t=svgedit.math.matrixMultiply(ka,t,I,e);r=t.e;e=t.f;if(r!=0||e!=0){C=A.childNodes;for(q=C.length;q--;){ea=C.item(q);if(ea.nodeType==1){ka=J.getStartTransform();J.setStartTransform(ea.getAttribute("transform"));fa=svgedit.transformlist.getTransformList(ea);T=i.createSVGTransform();T.setTranslate(r,e);fa.numberOfItems?
fa.insertItemBefore(T,0):fa.appendItem(T);p.addSubCommand(svgedit.recalculate.recalculateDimensions(ea));J.setStartTransform(ka)}}}if(h)c.numberOfItems?c.insertItemBefore(z,0):c.appendItem(z)}}else{h=svgedit.utilities.getBBox(A);if(!h&&A.tagName!="path")return null;e=i.createSVGMatrix();if(r=svgedit.utilities.getRotationAngle(A)){z={x:h.x+h.width/2,y:h.y+h.height/2};t=svgedit.math.transformPoint(h.x+h.width/2,h.y+h.height/2,svgedit.math.transformListToTransform(c).matrix);s=r*Math.PI/180;C=Math.abs(s)>
1.0E-10?Math.sin(s)/(1-Math.cos(s)):2/s;for(s=0;s<c.numberOfItems;++s){e=c.getItem(s);if(e.type==4){e=e.matrix;z.y=(C*e.e+e.f)/2;z.x=(e.e-C*e.f)/2;c.removeItem(s);break}}}s=0;j=c.numberOfItems;if(!svgedit.browser.isWebkit())if((I=A.getAttribute("fill"))&&I.indexOf("url(")===0){I=getRefElem(I);ka="pattern";if(I.tagName!==ka)ka="gradient";if(I.getAttribute(ka+"Units")==="userSpaceOnUse"){e=svgedit.math.transformListToTransform(c).matrix;h=svgedit.transformlist.getTransformList(I);h=svgedit.math.transformListToTransform(h).matrix;
e=svgedit.math.matrixMultiply(e,h);h="matrix("+[e.a,e.b,e.c,e.d,e.e,e.f].join(",")+")";I.setAttribute(ka+"Transform",h)}}if(j>=3&&c.getItem(j-2).type==3&&c.getItem(j-3).type==2&&c.getItem(j-1).type==2){s=3;e=svgedit.math.transformListToTransform(c,j-3,j-1).matrix;c.removeItem(j-1);c.removeItem(j-2);c.removeItem(j-3)}else if(j==4&&c.getItem(j-1).type==1){s=3;e=svgedit.math.transformListToTransform(c).matrix;Ba=i.createSVGTransform();Ba.setMatrix(e);c.clear();c.appendItem(Ba);e=i.createSVGMatrix()}else if((j==
1||j>1&&c.getItem(1).type!=3)&&c.getItem(0).type==2){s=2;I=c.getItem(0).matrix;ka=svgedit.math.transformListToTransform(c,1).matrix;h=ka.inverse();e=svgedit.math.matrixMultiply(h,I,ka);c.removeItem(0)}else if(j==1&&c.getItem(0).type==1&&!r){e=svgedit.math.transformListToTransform(c).matrix;switch(A.tagName){case "line":v=$(A).attr(["x1","y1","x2","y2"]);case "polyline":case "polygon":v.points=A.getAttribute("points");if(v.points){h=A.points;C=h.numberOfItems;v.points=Array(C);for(s=0;s<C;++s){q=h.getItem(s);
v.points[s]={x:q.x,y:q.y}}}case "path":v.d=A.getAttribute("d");s=1;c.clear()}}else{s=4;if(r){i=i.createSVGTransform();i.setRotate(r,t.x,t.y);c.numberOfItems?c.insertItemBefore(i,0):c.appendItem(i)}c.numberOfItems==0&&A.removeAttribute("transform");return null}if(s==1||s==2||s==3)svgedit.coords.remapElement(A,v,e);if(s==2){if(r){svgedit.math.hasMatrixTransform(c)||(t={x:z.x+e.e,y:z.y+e.f});i=i.createSVGTransform();i.setRotate(r,t.x,t.y);c.numberOfItems?c.insertItemBefore(i,0):c.appendItem(i)}if(A.tagName==
"text"){C=A.childNodes;for(q=C.length;q--;){ea=C.item(q);if(ea.tagName=="tspan"){i={x:$(ea).attr("x")||0,y:$(ea).attr("y")||0};svgedit.coords.remapElement(ea,i,e)}}}}else if(s==3&&r){e=svgedit.math.transformListToTransform(c).matrix;I=i.createSVGTransform();I.setRotate(r,z.x,z.y);I=I.matrix;z=i.createSVGTransform();z.setRotate(r,t.x,t.y);t=z.matrix.inverse();ka=e.inverse();t=svgedit.math.matrixMultiply(ka,t,I,e);svgedit.coords.remapElement(A,v,t);if(r)c.numberOfItems?c.insertItemBefore(z,0):c.appendItem(z)}}c.numberOfItems==
0&&A.removeAttribute("transform");p.addSubCommand(new svgedit.history.ChangeElementCommand(A,D));return p}})();(function(){if(!svgedit.select)svgedit.select={};var a,J,A,i=svgedit.browser.isTouch()?10:4;svgedit.select.Selector=function(c,p){this.id=c;this.selectedElement=p;this.locked=true;this.selectorGroup=a.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}});this.selectorRect=this.selectorGroup.appendChild(a.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}}));this.gripCoords={nw:null,
n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.reset(this.selectedElement)};svgedit.select.Selector.prototype.reset=function(c){this.locked=true;this.selectedElement=c;this.resize();this.selectorGroup.setAttribute("display","inline")};svgedit.select.Selector.prototype.updateGripCursors=function(c){var p,e=[];c=Math.round(c/45);if(c<0)c+=8;for(p in A.selectorGrips)e.push(p);for(;c>0;){e.push(e.shift());c--}c=0;for(p in A.selectorGrips){A.selectorGrips[p].setAttribute("style","cursor:"+e[c]+
"-resize");c++}};svgedit.select.Selector.prototype.showGrips=function(c){A.selectorGripsGroup.setAttribute("display",c?"inline":"none");var p=this.selectedElement;this.hasGrips=c;if(p&&c){this.selectorGroup.appendChild(A.selectorGripsGroup);this.updateGripCursors(svgedit.utilities.getRotationAngle(p))}};svgedit.select.Selector.prototype.resize=function(){var c=this.selectorRect,p=A,e=p.selectorGrips,h=this.selectedElement,r=h.getAttribute("stroke-width"),v=a.currentZoom(),D=1/v;if(h.getAttribute("stroke")!==
"none"&&!isNaN(r))D+=r/2;var C=h.tagName;if(C==="text")D+=2/v;r=svgedit.transformlist.getTransformList(h);r=svgedit.math.transformListToTransform(r).matrix;r.e*=v;r.f*=v;var s=svgedit.utilities.getBBox(h);if(C==="g"&&!$.data(h,"gsvg"))if(C=a.getStrokedBBox(h.childNodes))s=C;C=s.x;var q=s.y,z=s.width;s=s.height;D*=v;v=svgedit.math.transformBox(C*v,q*v,z*v,s*v,r);r=v.aabox;C=r.x-D;q=r.y-D;z=r.width+D*2;var t=r.height+D*2;r=C+z/2;s=q+t/2;if(h=svgedit.utilities.getRotationAngle(h)){C=a.svgRoot().createSVGTransform();
C.setRotate(-h,r,s);C=C.matrix;v.tl=svgedit.math.transformPoint(v.tl.x,v.tl.y,C);v.tr=svgedit.math.transformPoint(v.tr.x,v.tr.y,C);v.bl=svgedit.math.transformPoint(v.bl.x,v.bl.y,C);v.br=svgedit.math.transformPoint(v.br.x,v.br.y,C);C=v.tl;z=C.x;t=C.y;var j=C.x,I=C.y;C=Math.min;q=Math.max;z=C(z,C(v.tr.x,C(v.bl.x,v.br.x)))-D;t=C(t,C(v.tr.y,C(v.bl.y,v.br.y)))-D;j=q(j,q(v.tr.x,q(v.bl.x,v.br.x)))+D;I=q(I,q(v.tr.y,q(v.bl.y,v.br.y)))+D;C=z;q=t;z=j-z;t=I-t}D=a.svgRoot().suspendRedraw(100);c.setAttribute("d",
"M"+C+","+q+" L"+(C+z)+","+q+" "+(C+z)+","+(q+t)+" "+C+","+(q+t)+"z");this.selectorGroup.setAttribute("transform",h?"rotate("+[h,r,s].join(",")+")":"");this.gripCoords={nw:[C,q],ne:[C+z,q],sw:[C,q+t],se:[C+z,q+t],n:[C+z/2,q],w:[C,q+t/2],e:[C+z,q+t/2],s:[C+z/2,q+t]};for(var T in this.gripCoords){c=this.gripCoords[T];e[T].setAttribute("cx",c[0]);e[T].setAttribute("cy",c[1])}p.rotateGripConnector.setAttribute("x1",C+z/2);p.rotateGripConnector.setAttribute("y1",q);p.rotateGripConnector.setAttribute("x2",
C+z/2);p.rotateGripConnector.setAttribute("y2",q-i*5);p.rotateGrip.setAttribute("cx",C+z/2);p.rotateGrip.setAttribute("cy",q-i*5);a.svgRoot().unsuspendRedraw(D)};svgedit.select.SelectorManager=function(){this.rubberBandBox=this.selectorParentGroup=null;this.selectors=[];this.selectorMap={};this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.rotateGrip=this.rotateGripConnector=this.selectorGripsGroup=null;this.initGroup()};svgedit.select.SelectorManager.prototype.initGroup=
function(){this.selectorParentGroup&&this.selectorParentGroup.parentNode&&this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup);this.selectorParentGroup=a.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}});this.selectorGripsGroup=a.createSVGElement({element:"g",attr:{display:"none"}});this.selectorParentGroup.appendChild(this.selectorGripsGroup);a.svgRoot().appendChild(this.selectorParentGroup);this.selectorMap={};this.selectors=[];this.rubberBandBox=null;for(var c in this.selectorGrips){var p=
a.createSVGElement({element:"circle",attr:{id:"selectorGrip_resize_"+c,fill:"#22C",r:i,style:"cursor:"+c+"-resize","stroke-width":2,"pointer-events":"all"}});$.data(p,"dir",c);$.data(p,"type","resize");this.selectorGrips[c]=this.selectorGripsGroup.appendChild(p)}this.rotateGripConnector=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#22C","stroke-width":"1"}}));this.rotateGrip=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"circle",
attr:{id:"selectorGrip_rotate",fill:"lime",r:i,stroke:"#22C","stroke-width":2,style:"cursor:url("+J.imgPath+"rotate.png) 12 12, auto;"}}));$.data(this.rotateGrip,"type","rotate");if(!$("#canvasBackground").length){c=J.dimensions;c=a.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:c[0],height:c[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}});p=a.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,
stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});c.appendChild(p);a.svgRoot().insertBefore(c,a.svgContent())}};svgedit.select.SelectorManager.prototype.requestSelector=function(c){if(c==null)return null;var p,e=this.selectors.length;if(typeof this.selectorMap[c.id]=="object"){this.selectorMap[c.id].locked=true;return this.selectorMap[c.id]}for(p=0;p<e;++p)if(this.selectors[p]&&!this.selectors[p].locked){this.selectors[p].locked=true;this.selectors[p].reset(c);this.selectorMap[c.id]=this.selectors[p];
return this.selectors[p]}this.selectors[e]=new svgedit.select.Selector(e,c);this.selectorParentGroup.appendChild(this.selectors[e].selectorGroup);this.selectorMap[c.id]=this.selectors[e];return this.selectors[e]};svgedit.select.SelectorManager.prototype.releaseSelector=function(c){if(c!=null){var p,e=this.selectors.length,h=this.selectorMap[c.id];for(p=0;p<e;++p)if(this.selectors[p]&&this.selectors[p]==h){h.locked==false&&console.log("WARNING! selector was released but was already unlocked");delete this.selectorMap[c.id];
h.locked=false;h.selectedElement=null;h.showGrips(false);try{h.selectorGroup.setAttribute("display","none")}catch(r){}break}}};svgedit.select.SelectorManager.prototype.getRubberBandBox=function(){if(!this.rubberBandBox)this.rubberBandBox=this.selectorParentGroup.appendChild(a.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":0.15,stroke:"#22C","stroke-width":0.5,display:"none",style:"pointer-events:none"}}));return this.rubberBandBox};svgedit.select.init=function(c,
p){J=c;a=p;A=new svgedit.select.SelectorManager};svgedit.select.getSelectorManager=function(){return A}})();(function(){if(!svgedit.draw)svgedit.draw={};var a=svgedit.NS,J="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),A={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},i=A.LET_DOCUMENT_DECIDE;svgedit.draw.Layer=function(c,p){this.name_=c;this.group_=p};svgedit.draw.Layer.prototype.getName=function(){return this.name_};svgedit.draw.Layer.prototype.getGroup=function(){return this.group_};svgedit.draw.randomizeIds=function(c,p){i=c===false?
A.NEVER_RANDOMIZE:A.ALWAYS_RANDOMIZE;if(i==A.ALWAYS_RANDOMIZE&&!p.getNonce())p.setNonce(Math.floor(Math.random()*100001));else i==A.NEVER_RANDOMIZE&&p.getNonce()&&p.clearNonce()};svgedit.draw.Drawing=function(c,p){if(!c||!c.tagName||!c.namespaceURI||c.tagName!="svg"||c.namespaceURI!=a.SVG)throw"Error: svgedit.draw.Drawing instance initialized without a <svg> element";this.svgElem_=c;this.obj_num=0;this.idPrefix=p||"svg_";this.releasedNums=[];this.all_layers=[];this.current_layer=null;this.nonce_=
"";var e=this.svgElem_.getAttributeNS(a.SE,"nonce");if(e&&i!=A.NEVER_RANDOMIZE)this.nonce_=e;else i==A.ALWAYS_RANDOMIZE&&this.setNonce(Math.floor(Math.random()*100001))};svgedit.draw.Drawing.prototype.getElem_=function(c){if(this.svgElem_.querySelector)return this.svgElem_.querySelector("#"+c);return $(this.svgElem_).find("[id="+c+"]")[0]};svgedit.draw.Drawing.prototype.getSvgElem=function(){return this.svgElem_};svgedit.draw.Drawing.prototype.getNonce=function(){return this.nonce_};svgedit.draw.Drawing.prototype.setNonce=
function(c){this.svgElem_.setAttributeNS(a.XMLNS,"xmlns:se",a.SE);this.svgElem_.setAttributeNS(a.SE,"se:nonce",c);this.nonce_=c};svgedit.draw.Drawing.prototype.clearNonce=function(){this.nonce_=""};svgedit.draw.Drawing.prototype.getId=function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num};svgedit.draw.Drawing.prototype.getNextId=function(){var c=this.obj_num,p=false;if(this.releasedNums.length>0){this.obj_num=this.releasedNums.pop();p=true}else this.obj_num++;
for(var e=this.getId();this.getElem_(e);){if(p){this.obj_num=c;p=false}this.obj_num++;e=this.getId()}if(p)this.obj_num=c;return e};svgedit.draw.Drawing.prototype.releaseId=function(c){var p=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if(typeof c!=="string"||c.indexOf(p)!==0)return false;c=parseInt(c.substr(p.length),10);if(typeof c!=="number"||c<=0||this.releasedNums.indexOf(c)!=-1)return false;this.releasedNums.push(c);return true};svgedit.draw.Drawing.prototype.getNumLayers=function(){return this.all_layers.length};
svgedit.draw.Drawing.prototype.hasLayer=function(c){var p;for(p=0;p<this.getNumLayers();p++)if(this.all_layers[p][0]==c)return true;return false};svgedit.draw.Drawing.prototype.getLayerName=function(c){if(c>=0&&c<this.getNumLayers())return this.all_layers[c][0];return""};svgedit.draw.Drawing.prototype.getCurrentLayer=function(){return this.current_layer};svgedit.draw.Drawing.prototype.getCurrentLayerName=function(){var c;for(c=0;c<this.getNumLayers();++c)if(this.all_layers[c][1]==this.current_layer)return this.getLayerName(c);
return""};svgedit.draw.Drawing.prototype.setCurrentLayer=function(c){var p;for(p=0;p<this.getNumLayers();++p)if(c==this.getLayerName(p)){if(this.current_layer!=this.all_layers[p][1]){this.current_layer.setAttribute("style","pointer-events:none");this.current_layer=this.all_layers[p][1];this.current_layer.setAttribute("style","pointer-events:all")}return true}return false};svgedit.draw.Drawing.prototype.deleteCurrentLayer=function(){if(this.current_layer&&this.getNumLayers()>1){var c=this.current_layer.parentNode.removeChild(this.current_layer);
this.identifyLayers();return c}return null};svgedit.draw.Drawing.prototype.identifyLayers=function(){this.all_layers=[];var c=this.svgElem_.childNodes.length,p=[],e=[],h=null,r=false,v;for(v=0;v<c;++v){var D=this.svgElem_.childNodes.item(v);if(D&&D.nodeType==1)if(D.tagName=="g"){r=true;var C=$("title",D).text();if(!C&&svgedit.browser.isOpera()&&D.querySelectorAll)C=$(D.querySelectorAll("title")).text();if(C){e.push(C);this.all_layers.push([C,D]);h=D;svgedit.utilities.walkTree(D,function(s){s.setAttribute("style",
"pointer-events:inherit")});h.setAttribute("style","pointer-events:none")}else p.push(D)}else if(~J.indexOf(D.nodeName)){svgedit.utilities.getBBox(D);p.push(D)}}c=this.svgElem_.ownerDocument;if(p.length>0||!r){for(v=1;e.indexOf("Layer "+v)>=0;)v++;e="Layer "+v;h=c.createElementNS(a.SVG,"g");r=c.createElementNS(a.SVG,"title");r.textContent=e;h.appendChild(r);for(r=0;r<p.length;++r)h.appendChild(p[r]);this.svgElem_.appendChild(h);this.all_layers.push([e,h])}svgedit.utilities.walkTree(h,function(s){s.setAttribute("style",
"pointer-events:inherit")});this.current_layer=h;this.current_layer.setAttribute("style","pointer-events:all")};svgedit.draw.Drawing.prototype.createLayer=function(c){var p=this.svgElem_.ownerDocument,e=p.createElementNS(a.SVG,"g");p=p.createElementNS(a.SVG,"title");p.textContent=c;e.appendChild(p);this.svgElem_.appendChild(e);this.identifyLayers();return e};svgedit.draw.Drawing.prototype.getLayerVisibility=function(c){var p=null,e;for(e=0;e<this.getNumLayers();++e)if(this.getLayerName(e)==c){p=this.all_layers[e][1];
break}if(!p)return false;return p.getAttribute("display")!=="none"};svgedit.draw.Drawing.prototype.setLayerVisibility=function(c,p){if(typeof p!=="boolean")return null;var e=null,h;for(h=0;h<this.getNumLayers();++h)if(this.getLayerName(h)==c){e=this.all_layers[h][1];break}if(!e)return null;e.getAttribute("display");e.setAttribute("display",p?"inline":"none");return e};svgedit.draw.Drawing.prototype.getLayerOpacity=function(c){var p;for(p=0;p<this.getNumLayers();++p)if(this.getLayerName(p)==c){(c=
this.all_layers[p][1].getAttribute("opacity"))||(c="1.0");return parseFloat(c)}return null};svgedit.draw.Drawing.prototype.setLayerOpacity=function(c,p){if(!(typeof p!=="number"||p<0||p>1)){var e;for(e=0;e<this.getNumLayers();++e)if(this.getLayerName(e)==c){this.all_layers[e][1].setAttribute("opacity",p);break}}}})();(function(){if(!svgedit.path)svgedit.path={};var a=svgedit.NS,J={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},A={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},i=[],c=true,p={};svgedit.path.setLinkControlPoints=function(q){c=q};var e=svgedit.path.path=null;
svgedit.path.init=function(q){e=q;i=[0,"ClosePath"];$.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(z,t){i.push(t+"Abs");i.push(t+"Rel")})};svgedit.path.insertItemBefore=function(q,z,t){q=q.pathSegList;if(svgedit.browser.supportsPathInsertItemBefore())q.insertItemBefore(z,t);else{var j=q.numberOfItems,I=[],T;for(T=0;T<j;T++){var aa=q.getItem(T);I.push(aa)}q.clear();for(T=0;T<j;T++){T==t&&
q.appendItem(z);q.appendItem(I[T])}}};svgedit.path.ptObjToArr=function(q,z){var t=A[q],j=t.length,I,T=[];for(I=0;I<j;I++)T[I]=z[t[I]];return T};svgedit.path.getGripPt=function(q,z){var t={x:z?z.x:q.item.x,y:z?z.y:q.item.y},j=q.path;if(j.matrix)t=svgedit.math.transformPoint(t.x,t.y,j.matrix);t.x*=e.getCurrentZoom();t.y*=e.getCurrentZoom();return t};svgedit.path.getPointFromGrip=function(q,z){var t={x:q.x,y:q.y};if(z.matrix){q=svgedit.math.transformPoint(t.x,t.y,z.imatrix);t.x=q.x;t.y=q.y}t.x/=e.getCurrentZoom();
t.y/=e.getCurrentZoom();return t};svgedit.path.addPointGrip=function(q,z,t){var j=svgedit.path.getGripContainer(),I=svgedit.utilities.getElem("pathpointgrip_"+q);if(!I){I=document.createElementNS(a.SVG,"circle");svgedit.utilities.assignAttributes(I,{id:"pathpointgrip_"+q,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":J.pathNodeTooltip});I=j.appendChild(I);$("#pathpointgrip_"+q).dblclick(function(){svgedit.path.path&&svgedit.path.path.setSegType()})}z&&
t&&svgedit.utilities.assignAttributes(I,{cx:z,cy:t,display:"inline"});return I};svgedit.path.getGripContainer=function(){var q=svgedit.utilities.getElem("pathpointgrip_container");if(!q){q=svgedit.utilities.getElem("selectorParentGroup").appendChild(document.createElementNS(a.SVG,"g"));q.id="pathpointgrip_container"}return q};svgedit.path.addCtrlGrip=function(q){var z=svgedit.utilities.getElem("ctrlpointgrip_"+q);if(z)return z;z=document.createElementNS(a.SVG,"circle");svgedit.utilities.assignAttributes(z,
{id:"ctrlpointgrip_"+q,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":J.pathCtrlPtTooltip});svgedit.path.getGripContainer().appendChild(z);return z};svgedit.path.getCtrlLine=function(q){var z=svgedit.utilities.getElem("ctrlLine_"+q);if(z)return z;z=document.createElementNS(a.SVG,"line");svgedit.utilities.assignAttributes(z,{id:"ctrlLine_"+q,stroke:"#555","stroke-width":1,style:"pointer-events:none"});svgedit.path.getGripContainer().appendChild(z);
return z};svgedit.path.getPointGrip=function(q,z){var t=svgedit.path.addPointGrip(q.index);if(z){var j=svgedit.path.getGripPt(q);svgedit.utilities.assignAttributes(t,{cx:j.x,cy:j.y,display:"inline"})}return t};svgedit.path.getControlPoints=function(q){var z=q.item,t=q.index;if(!("x1"in z)||!("x2"in z))return null;var j={};svgedit.path.getGripContainer();var I=[svgedit.path.path.segs[t-1].item,z],T;for(T=1;T<3;T++){var aa=t+"c"+T,oa=j["c"+T+"_line"]=svgedit.path.getCtrlLine(aa),ea=svgedit.path.getGripPt(q,
{x:z["x"+T],y:z["y"+T]}),fa=svgedit.path.getGripPt(q,{x:I[T-1].x,y:I[T-1].y});svgedit.utilities.assignAttributes(oa,{x1:ea.x,y1:ea.y,x2:fa.x,y2:fa.y,display:"inline"});j["c"+T+"_line"]=oa;aa=j["c"+T]=svgedit.path.addCtrlGrip(aa);svgedit.utilities.assignAttributes(aa,{cx:ea.x,cy:ea.y,display:"inline"});j["c"+T]=aa}return j};svgedit.path.replacePathSeg=function(q,z,t,j){j=j||svgedit.path.path.elem;q="createSVGPathSeg"+i[q];if(q!=="createSVGPathSegArcAbs"){t=j[q].apply(j,t);if(svgedit.browser.supportsPathReplaceItem())j.pathSegList.replaceItem(t,
z);else{j=j.pathSegList;q=j.numberOfItems;var I=[],T;for(T=0;T<q;T++){var aa=j.getItem(T);I.push(aa)}j.clear();for(T=0;T<q;T++)T==z?j.appendItem(t):j.appendItem(I[T])}}};svgedit.path.getSegSelector=function(q,z){var t=q.index,j=svgedit.utilities.getElem("segline_"+t);if(!j){var I=svgedit.path.getGripContainer();j=document.createElementNS(a.SVG,"path");svgedit.utilities.assignAttributes(j,{id:"segline_"+t,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"});
I.appendChild(j)}if(z){t=q.prev;if(!t){j.setAttribute("display","none");return j}t=svgedit.path.getGripPt(t);svgedit.path.replacePathSeg(2,0,[t.x,t.y],j);I=svgedit.path.ptObjToArr(q.type,q.item,true);var T;for(T=0;T<I.length;T+=2){t=svgedit.path.getGripPt(q,{x:I[T],y:I[T+1]});I[T]=t.x;I[T+1]=t.y}svgedit.path.replacePathSeg(q.type,1,I,j)}return j};svgedit.path.smoothControlPoints=function(q,z,t){var j=q.x-t.x,I=q.y-t.y,T=z.x-t.x,aa=z.y-t.y;if((j!=0||I!=0)&&(T!=0||aa!=0)){q=Math.atan2(I,j);z=Math.atan2(aa,
T);j=Math.sqrt(j*j+I*I);T=Math.sqrt(T*T+aa*aa);I=e.getSVGRoot().createSVGPoint();aa=e.getSVGRoot().createSVGPoint();if(q<0)q+=2*Math.PI;if(z<0)z+=2*Math.PI;var oa=Math.abs(q-z),ea=Math.abs(Math.PI-oa)/2;if(q-z>0){q=oa<Math.PI?q+ea:q-ea;z=oa<Math.PI?z-ea:z+ea}else{q=oa<Math.PI?q-ea:q+ea;z=oa<Math.PI?z+ea:z-ea}I.x=j*Math.cos(q)+t.x;I.y=j*Math.sin(q)+t.y;aa.x=T*Math.cos(z)+t.x;aa.y=T*Math.sin(z)+t.y;return[I,aa]}};svgedit.path.Segment=function(q,z){this.selected=false;this.index=q;this.item=z;this.type=
z.pathSegType;this.ctrlpts=[];this.segsel=this.ptgrip=null};svgedit.path.Segment.prototype.showCtrlPts=function(q){for(var z in this.ctrlpts)if(this.ctrlpts.hasOwnProperty(z))this.ctrlpts[z].setAttribute("display",q?"inline":"none")};svgedit.path.Segment.prototype.selectCtrls=function(q){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",q?"#0FF":"#EEE")};svgedit.path.Segment.prototype.show=function(q){if(this.ptgrip){this.ptgrip.setAttribute("display",q?"inline":"none");
this.segsel.setAttribute("display",q?"inline":"none");this.showCtrlPts(q)}};svgedit.path.Segment.prototype.select=function(q){if(this.ptgrip){this.ptgrip.setAttribute("stroke",q?"#0FF":"#00F");this.segsel.setAttribute("display",q?"inline":"none");this.ctrlpts&&this.selectCtrls(q);this.selected=q}};svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,true);this.ctrlpts=svgedit.path.getControlPoints(this,true);this.segsel=svgedit.path.getSegSelector(this,true)};
svgedit.path.Segment.prototype.update=function(q){if(this.ptgrip){var z=svgedit.path.getGripPt(this);svgedit.utilities.assignAttributes(this.ptgrip,{cx:z.x,cy:z.y});svgedit.path.getSegSelector(this,true);if(this.ctrlpts){if(q){this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.type=this.item.pathSegType}svgedit.path.getControlPoints(this)}}};svgedit.path.Segment.prototype.move=function(q,z){var t;t=this.item;t=this.ctrlpts?[t.x+=q,t.y+=z,t.x1,t.y1,t.x2+=q,t.y2+=z]:[t.x+=q,t.y+=
z];svgedit.path.replacePathSeg(this.type,this.index,t);if(this.next&&this.next.ctrlpts){t=this.next.item;t=[t.x,t.y,t.x1+=q,t.y1+=z,t.x2,t.y2];svgedit.path.replacePathSeg(this.next.type,this.next.index,t)}if(this.mate){t=this.mate.item;t=[t.x+=q,t.y+=z];svgedit.path.replacePathSeg(this.mate.type,this.mate.index,t)}this.update(true);this.next&&this.next.update(true)};svgedit.path.Segment.prototype.setLinked=function(q){var z,t,j;if(q==2){t=1;z=this.next;if(!z)return;j=this.item}else{t=2;z=this.prev;
if(!z)return;j=z.item}var I=z.item;I["x"+t]=j.x+(j.x-this.item["x"+q]);I["y"+t]=j.y+(j.y-this.item["y"+q]);svgedit.path.replacePathSeg(z.type,z.index,[I.x,I.y,I.x1,I.y1,I.x2,I.y2]);z.update(true)};svgedit.path.Segment.prototype.moveCtrl=function(q,z,t){var j=this.item;j["x"+q]+=z;j["y"+q]+=t;svgedit.path.replacePathSeg(this.type,this.index,[j.x,j.y,j.x1,j.y1,j.x2,j.y2]);this.update(true)};svgedit.path.Segment.prototype.setType=function(q,z){svgedit.path.replacePathSeg(q,this.index,z);this.type=q;
this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.showCtrlPts(q===6);this.ctrlpts=svgedit.path.getControlPoints(this);this.update(true)};svgedit.path.Path=function(q){if(!q||q.tagName!=="path")throw"svgedit.path.Path constructed without a <path> element";this.elem=q;this.segs=[];this.selected_pts=[];svgedit.path.path=this;this.init()};svgedit.path.Path.prototype.init=function(){$(svgedit.path.getGripContainer()).find("*").attr("display","none");var q=this.elem.pathSegList,z=q.numberOfItems;
this.segs=[];this.selected_pts=[];this.first_seg=null;var t;for(t=0;t<z;t++){var j=q.getItem(t);j=new svgedit.path.Segment(t,j);j.path=this;this.segs.push(j)}q=this.segs;j=null;for(t=0;t<z;t++){var I=q[t],T=t+1>=z?null:q[t+1],aa=t-1<0?null:q[t-1];if(I.type===2){if(aa&&aa.type!==1){T=q[j];T.next=q[j+1];T.next.prev=T;T.addGrip()}j=t}else if(T&&T.type===1){I.next=q[j+1];I.next.prev=I;I.mate=q[j];I.addGrip();if(this.first_seg==null)this.first_seg=I}else if(T){if(I.type!==1){I.addGrip();if(T&&T.type!==
2){I.next=T;I.next.prev=I}}}else if(I.type!==1){T=q[j];T.next=q[j+1];T.next.prev=T;T.addGrip();I.addGrip();if(!this.first_seg)this.first_seg=q[j]}}return this};svgedit.path.Path.prototype.eachSeg=function(q){var z,t=this.segs.length;for(z=0;z<t;z++)if(q.call(this.segs[z],z)===false)break};svgedit.path.Path.prototype.addSeg=function(q){var z=this.segs[q];if(z.prev){console.log(z.item);var t=z.prev,j,I,T;switch(z.item.pathSegType){case 4:I=(z.item.x+t.item.x)/2;T=(z.item.y+t.item.y)/2;j=this.elem.createSVGPathSegLinetoAbs(I,
T);break;case 6:j=(t.item.x+z.item.x1)/2;var aa=(z.item.x1+z.item.x2)/2,oa=(z.item.x2+z.item.x)/2,ea=(j+aa)/2;aa=(aa+oa)/2;I=(ea+aa)/2;var fa=(t.item.y+z.item.y1)/2,ka=(z.item.y1+z.item.y2)/2;t=(z.item.y2+z.item.y)/2;var Ia=(fa+ka)/2;ka=(ka+t)/2;T=(Ia+ka)/2;j=this.elem.createSVGPathSegCurvetoCubicAbs(I,T,j,fa,ea,Ia);svgedit.path.replacePathSeg(z.type,q,[z.item.x,z.item.y,aa,ka,oa,t])}svgedit.path.insertItemBefore(this.elem,j,q)}};svgedit.path.Path.prototype.deleteSeg=function(q){var z=this.segs[q],
t=this.elem.pathSegList;z.show(false);var j=z.next,I;if(z.mate){I=[j.item.x,j.item.y];svgedit.path.replacePathSeg(2,j.index,I);svgedit.path.replacePathSeg(4,z.index,I);t.removeItem(z.mate.index)}else{if(!z.prev){I=[j.item.x,j.item.y];svgedit.path.replacePathSeg(2,z.next.index,I)}t.removeItem(q)}};svgedit.path.Path.prototype.subpathIsClosed=function(q){var z=false;svgedit.path.path.eachSeg(function(t){if(t<=q)return true;if(this.type===2)return false;if(this.type===1){z=true;return false}});return z};
svgedit.path.Path.prototype.removePtFromSelection=function(q){var z=this.selected_pts.indexOf(q);if(z!=-1){this.segs[q].select(false);this.selected_pts.splice(z,1)}};svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(false)});this.selected_pts=[]};svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")};svgedit.path.Path.prototype.show=function(q){this.eachSeg(function(){this.show(q)});q&&this.selectPt(this.first_seg.index);return this};
svgedit.path.Path.prototype.movePts=function(q,z){for(var t=this.selected_pts.length;t--;)this.segs[this.selected_pts[t]].move(q,z)};svgedit.path.Path.prototype.moveCtrl=function(q,z){var t=this.segs[this.selected_pts[0]];t.moveCtrl(this.dragctrl,q,z);c&&t.setLinked(this.dragctrl)};svgedit.path.Path.prototype.setSegType=function(q){this.storeD();for(var z=this.selected_pts.length,t;z--;){var j=this.segs[this.selected_pts[z]],I=j.prev;if(I){if(!q){t="Toggle Path Segment Type";q=j.type==6?4:6}q=Number(q);
var T=j.item.x,aa=j.item.y,oa=I.item.x;I=I.item.y;var ea;switch(q){case 6:if(j.olditem){oa=j.olditem;ea=[T,aa,oa.x1,oa.y1,oa.x2,oa.y2]}else{ea=T-oa;var fa=aa-I;ea=[T,aa,oa+ea/3,I+fa/3,T-ea/3,aa-fa/3]}break;case 4:ea=[T,aa];j.olditem=j.item}j.setType(q,ea)}}svgedit.path.path.endChanges(t)};svgedit.path.Path.prototype.selectPt=function(q,z){this.clearSelection();q==null&&this.eachSeg(function(t){if(this.prev)q=t});this.addPtsToSelection(q);if(z){this.dragctrl=z;c&&this.segs[q].setLinked(z)}};svgedit.path.Path.prototype.update=
function(){var q=this.elem;if(svgedit.utilities.getRotationAngle(q)){this.matrix=svgedit.math.getMatrix(q);this.imatrix=this.matrix.inverse()}else this.imatrix=this.matrix=null;this.eachSeg(function(z){this.item=q.pathSegList.getItem(z);this.update()});return this};svgedit.path.getPath_=function(q){var z=p[q.id];z||(z=p[q.id]=new svgedit.path.Path(q));return z};svgedit.path.removePath_=function(q){q in p&&delete p[q]};var h,r,v,D,C,s=function(q,z){var t=q-v,j=z-D,I=Math.sqrt(t*t+j*j);j=Math.atan2(j,
t)+C;t=I*Math.cos(j)+v;j=I*Math.sin(j)+D;t-=h;j-=r;I=Math.sqrt(t*t+j*j);j=Math.atan2(j,t)-C;return{x:I*Math.cos(j)+h,y:I*Math.sin(j)+r}};svgedit.path.recalcRotatedPath=function(){var q=svgedit.path.path.elem;if(C=svgedit.utilities.getRotationAngle(q,true)){var z=svgedit.utilities.getBBox(q),t=svgedit.path.path.oldbbox;v=t.x+t.width/2;D=t.y+t.height/2;h=z.x+z.width/2;r=z.y+z.height/2;t=h-v;var j=r-D;z=Math.sqrt(t*t+j*j);t=Math.atan2(j,t)+C;h=z*Math.cos(t)+v;r=z*Math.sin(t)+D;z=q.pathSegList;for(t=
z.numberOfItems;t;){t-=1;var I=z.getItem(t);j=I.pathSegType;if(j!=1){var T=s(I.x,I.y);T=[T.x,T.y];if(I.x1!=null&&I.x2!=null){var aa=s(I.x1,I.y1);I=s(I.x2,I.y2);T.splice(T.length,0,aa.x,aa.y,I.x,I.y)}svgedit.path.replacePathSeg(j,t,T)}}svgedit.utilities.getBBox(q);z=svgroot.createSVGTransform();q=svgedit.transformlist.getTransformList(q);z.setRotate(C*180/Math.PI,h,r);q.replaceItem(z,0)}};svgedit.path.clearData=function(){p={}}})();(function(){if(!window.console){window.console={};window.console.log=function(){};window.console.dir=function(){}}if(window.opera){window.console.log=function(a){opera.postError(a)};window.console.dir=function(){}}})();
$.SvgCanvas=function(a,J){function A(b,f){var d,o=svgedit.utilities.getBBox(b);for(d=0;d<2;d++){var n=d===0?"fill":"stroke",m=b.getAttribute(n);if(m&&m.indexOf("url(")===0){m=svgedit.utilities.getRefElem(m);if(m.tagName==="linearGradient"){var u=m.getAttribute("x1")||0,w=m.getAttribute("y1")||0,B=m.getAttribute("x2")||1,L=m.getAttribute("y2")||0;u=o.width*u+o.x;w=o.height*w+o.y;B=o.width*B+o.x;L=o.height*L+o.y;u=svgedit.math.transformPoint(u,w,f);L=svgedit.math.transformPoint(B,L,f);B={};B.x1=(u.x-
o.x)/o.width;B.y1=(u.y-o.y)/o.height;B.x2=(L.x-o.x)/o.width;B.y2=(L.y-o.y)/o.height;m=m.cloneNode(true);$(m).attr(B);m.id=Fa();svgedit.utilities.findDefs().appendChild(m);b.setAttribute(n,"url(#"+m.id+")")}}}}var i=svgedit.NS,c={show_outside_canvas:true,selectNew:true,dimensions:[640,480]};J&&$.extend(c,J);var p=c.dimensions,e=this,h=a.ownerDocument,r=h.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+i.SVG+'" xlinkns="'+i.XLINK+'" width="'+p[0]+'" height="'+p[1]+'" x="'+p[0]+'" y="'+
p[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,true);a.appendChild(r);var v=h.createElementNS(i.SVG,"svg");(e.clearSvgContentElement=function(){for(;v.firstChild;)v.removeChild(v.firstChild);$(v).attr({id:"svgcontent",
width:p[0],height:p[1],x:p[0],y:p[1],overflow:c.show_outside_canvas?"visible":"hidden",xmlns:i.SVG,"xmlns:se":i.SE,"xmlns:xlink":i.XLINK}).appendTo(r);var b=h.createComment(" Created with SVG-edit - http://svg-edit.googlecode.com/ ");v.appendChild(b)})();var D="svg_";e.setIdPrefix=function(b){D=b};e.current_drawing_=new svgedit.draw.Drawing(v,D);var C=e.getCurrentDrawing=function(){return e.current_drawing_},s=1,q=null,z={shape:{fill:(c.initFill.color=="none"?"":"#")+c.initFill.color,fill_paint:null,
fill_opacity:c.initFill.opacity,stroke:"#"+c.initStroke.color,stroke_paint:null,stroke_opacity:c.initStroke.opacity,stroke_width:c.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:c.initOpacity}};z.text=$.extend(true,{},z.shape);$.extend(z.text,{fill:"#000000",stroke_width:0,font_size:24,font_family:"serif"});var t=z.shape,j=Array(1),I=this.addSvgElementFromJson=function(b){var f=svgedit.utilities.getElem(b.attr.id),d=C().getCurrentLayer();if(f&&b.element!=
f.tagName){d.removeChild(f);f=null}if(!f){f=h.createElementNS(i.SVG,b.element);if(d)(q||d).appendChild(f)}b.curStyles&&svgedit.utilities.assignAttributes(f,{fill:t.fill,stroke:t.stroke,"stroke-width":t.stroke_width,"stroke-dasharray":t.stroke_dasharray,"stroke-linejoin":t.stroke_linejoin,"stroke-linecap":t.stroke_linecap,"stroke-opacity":t.stroke_opacity,"fill-opacity":t.fill_opacity,opacity:t.opacity/2,style:"pointer-events:inherit"},100);svgedit.utilities.assignAttributes(f,b.attr,100);svgedit.utilities.cleanupElement(f);
return f};e.getTransformList=svgedit.transformlist.getTransformList;var T=svgedit.math.transformPoint,aa=e.matrixMultiply=svgedit.math.matrixMultiply,oa=e.hasMatrixTransform=svgedit.math.hasMatrixTransform,ea=e.transformListToTransform=svgedit.math.transformListToTransform;svgedit.units.init({getBaseUnit:function(){return c.baseUnit},getElement:svgedit.utilities.getElem,getHeight:function(){return v.getAttribute("height")/s},getWidth:function(){return v.getAttribute("width")/s},getRoundDigits:function(){return la.round_digits}});
e.convertToNum=svgedit.units.convertToNum;svgedit.utilities.init({getDOMDocument:function(){return h},getDOMContainer:function(){return a},getSVGRoot:function(){return r},getSelectedElements:function(){return j},getSVGContent:function(){return v},getBaseUnit:function(){return c.baseUnit},getStepSize:function(){return c.stepSize}});var fa=e.findDefs=svgedit.utilities.findDefs,ka=e.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,Ia=e.getHref=svgedit.utilities.getHref,Ba=e.setHref=svgedit.utilities.setHref,
Ab=svgedit.utilities.getPathBBox;e.getBBox=svgedit.utilities.getBBox;e.getRotationAngle=svgedit.utilities.getRotationAngle;var Bb=e.getElem=svgedit.utilities.getElem;e.getRefElem=svgedit.utilities.getRefElem;var mb=e.assignAttributes=svgedit.utilities.assignAttributes,Ya=this.cleanupElement=svgedit.utilities.cleanupElement;svgedit.coords.init({getDrawing:function(){return C()},getGridSnapping:function(){return c.gridSnapping}});var ya=this.remapElement=svgedit.coords.remapElement;svgedit.recalculate.init({getSVGRoot:function(){return r},
getStartTransform:function(){return hb},setStartTransform:function(b){hb=b}});var Zb=this.recalculateDimensions=svgedit.recalculate.recalculateDimensions,Za=svgedit.getReverseNS(),Kb=e.sanitizeSvg=svgedit.sanitize.sanitizeSvg,Cb=svgedit.history.MoveElementCommand,rb=svgedit.history.InsertElementCommand,Va=svgedit.history.RemoveElementCommand,$a=svgedit.history.ChangeElementCommand,jb=svgedit.history.BatchCommand;e.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(b,f){var d=svgedit.history.HistoryEventTypes;
if(b==d.BEFORE_UNAPPLY||b==d.BEFORE_APPLY)e.clearSelection();else if(b==d.AFTER_APPLY||b==d.AFTER_UNAPPLY){var o=f.elements();e.pathActions.clear();na("changed",o);o=f.type();d=b==d.AFTER_APPLY;if(o==Cb.type())(d?f.newParent:f.oldParent)==v&&e.identifyLayers();else if(o==rb.type()||o==Va.type()){f.parent==v&&e.identifyLayers();if(o==rb.type())d&&sb(f.elem);else d||sb(f.elem);f.elem.tagName==="use"&&Db(f.elem)}else if(o==$a.type()){f.elem.tagName=="title"&&f.elem.parentNode.parentNode==v&&e.identifyLayers();
d=d?f.newValues:f.oldValues;d.stdDeviation&&e.setBlurOffsets(f.elem.parentNode,d.stdDeviation)}}}});var sa=function(b){e.undoMgr.addCommandToHistory(b)};svgedit.select.init(c,{createSVGElement:function(b){return e.addSvgElementFromJson(b)},svgRoot:function(){return r},svgContent:function(){return v},currentZoom:function(){return s},getStrokedBBox:function(b){return e.getStrokedBBox([b])}});var Z=this.selectorManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return s},
getSVGRoot:function(){return r}});var nb={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},Lb=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],tb=$.data,Mb=document.createElementNS(i.SVG,"animate");$(Mb).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(r);var sb=function(b){var f,
d=$(b).attr(Lb);for(f in d){var o=d[f];if(o&&o.indexOf("url(")===0){o=svgedit.utilities.getUrlFromAttr(o).substr(1);if(!Bb(o)){svgedit.utilities.findDefs().appendChild(ub[o]);delete ub[o]}}}f=b.getElementsByTagName("*");if(f.length){b=0;for(l=f.length;b<l;b++)sb(f[b])}},vb={},Ta=c.imgPath+"logo.png",db=[],la={round_digits:5},ta=false,hb=null,wa="select",Wa="none",ob={},Xa=z.text,Na=t,Nb=null,qa=null,kb=[],Ub={},Vb=null,ub={};e.clipBoard=[];var Qa=this.runExtensions=function(b,f,d){var o=d?[]:false;
$.each(Ub,function(n,m){if(m&&b in m)if(d)o.push(m[b](f));else o=m[b](f)});return o};this.addExtension=function(b,f){var d;if(b in Ub)console.log('Cannot add extension "'+b+'", an extension by that name already exists"');else{d=$.isFunction(f)?f($.extend(e.getPrivateMethods(),{svgroot:r,svgcontent:v,nonce:C().getNonce(),selectorManager:Z})):f;Ub[b]=d;na("extension_added",d)}};var pb=this.round=function(b){return parseInt(b*s,10)/s},Eb=this.getIntersectionList=function(b){if(qa==null)return null;var f=
q||C().getCurrentLayer();kb.length||(kb=eb(f));var d=null;try{d=f.getIntersectionList(b,null)}catch(o){}if(d==null||typeof d.item!="function"){d=[];if(b)b=b;else{b=qa.getBBox();var n;f={};for(n in b)f[n]=b[n]/s;b=f}for(n=kb.length;n--;)b.width&&svgedit.math.rectsIntersect(b,kb[n].bbox)&&d.push(kb[n].elem)}return d};getStrokedBBox=this.getStrokedBBox=function(b){b||(b=Ob());if(!b.length)return false;var f=function(L){try{var G=svgedit.utilities.getBBox(L),E=svgedit.utilities.getRotationAngle(L);if(E&&
E%90||svgedit.math.hasMatrixTransform(svgedit.transformlist.getTransformList(L))){E=false;if(["ellipse","path","line","polyline","polygon"].indexOf(L.tagName)>=0)G=E=e.convertToPath(L,true);else if(L.tagName=="rect"){var X=L.getAttribute("rx"),S=L.getAttribute("ry");if(X||S)G=E=e.convertToPath(L,true)}if(!E){var Q=L.cloneNode(true),U=document.createElementNS(i.SVG,"g"),ca=L.parentNode;ca.appendChild(U);U.appendChild(Q);G=svgedit.utilities.bboxToObj(U.getBBox());ca.removeChild(U)}}return G}catch(V){console.log(L,
V);return null}},d;$.each(b,function(){if(!d)if(this.parentNode)d=f(this)});if(d==null)return null;var o=d.x+d.width,n=d.y+d.height,m=d.x,u=d.y,w=function(L){var G=L.getAttribute("stroke-width"),E=0;if(L.getAttribute("stroke")!="none"&&!isNaN(G))E+=G/2;return E},B=[];$.each(b,function(L,G){var E=f(G);if(E){var X=w(G);m=Math.min(m,E.x-X);u=Math.min(u,E.y-X);B.push(E)}});d.x=m;d.y=u;$.each(b,function(L,G){var E=B[L];if(E&&G.nodeType==1){var X=w(G);o=Math.max(o,E.x+E.width+X);n=Math.max(n,E.y+E.height+
X)}});d.width=o-m;d.height=n-u;return d};var Ob=this.getVisibleElements=function(b){b||(b=$(v).children());var f=[];$(b).children().each(function(d,o){try{o.getBBox()&&f.push(o)}catch(n){}});return f.reverse()},eb=this.getVisibleElementsAndBBoxes=function(b){b||(b=$(v).children());var f=[];$(b).children().each(function(d,o){try{o.getBBox()&&f.push({elem:o,bbox:getStrokedBBox([o])})}catch(n){}});return f.reverse()},Fb=this.groupSvgElem=function(b){var f=document.createElementNS(i.SVG,"g");b.parentNode.replaceChild(f,
b);$(f).append(b).data("gsvg",b)[0].id=Fa()},Oa=function(b){var f=document.createElementNS(b.namespaceURI,b.nodeName);$.each(b.attributes,function(o,n){n.localName!="-moz-math-font-style"&&f.setAttributeNS(n.namespaceURI,n.nodeName,n.nodeValue)});f.removeAttribute("id");f.id=Fa();if(svgedit.browser.isWebkit()&&b.nodeName=="path"){var d=ua.convertPath(b);f.setAttribute("d",d)}$.each(b.childNodes,function(o,n){switch(n.nodeType){case 1:f.appendChild(Oa(n));break;case 3:f.textContent=n.nodeValue}});
if($(b).data("gsvg"))$(f).data("gsvg",f.firstChild);else if($(b).data("symbol")){b=$(b).data("symbol");$(f).data("ref",b).data("symbol",b)}else f.tagName=="image"&&Pb(f);return f},ab,Fa,na,La,ua;(function(b){var f={};ab=b.getId=function(){return C().getId()};Fa=b.getNextId=function(){return C().getNextId()};na=b.call=function(d,o){if(f[d])return f[d](this,o)};b.bind=function(d,o){var n=f[d];f[d]=o;return n}})(e);this.prepareSvg=function(b){this.sanitizeSvg(b.documentElement);var f,d,o=b.getElementsByTagNameNS(i.SVG,
"path");b=0;for(d=o.length;b<d;++b){f=o[b];f.setAttribute("d",ua.convertPath(f));ua.fixEnd(f)}};var Qb=function(b){if(!svgedit.browser.isGecko())return b;var f=b.cloneNode(true);b.parentNode.insertBefore(f,b);b.parentNode.removeChild(b);Z.releaseSelector(b);j[0]=f;Z.requestSelector(f).showGrips(true);return f};this.setRotationAngle=function(b,f){b=parseFloat(b);var d=j[0],o=d.getAttribute("transform"),n=svgedit.utilities.getBBox(d),m=n.x+n.width/2,u=n.y+n.height/2;n=svgedit.transformlist.getTransformList(d);
n.numberOfItems>0&&n.getItem(0).type==4&&n.removeItem(0);if(b!=0){m=svgedit.math.transformPoint(m,u,svgedit.math.transformListToTransform(n).matrix);u=r.createSVGTransform();u.setRotate(b,m.x,m.y);n.numberOfItems?n.insertItemBefore(u,0):n.appendItem(u)}else n.numberOfItems==0&&d.removeAttribute("transform");if(!f){n=d.getAttribute("transform");d.setAttribute("transform",o);Ma("transform",n,j);na("changed",j)}svgedit.utilities.getElem("pathpointgrip_container");d=Z.requestSelector(j[0]);d.resize();
d.updateGripCursors(b)};var wb=this.recalculateAllSelectedDimensions=function(){for(var b=new svgedit.history.BatchCommand(Wa=="none"?"position":"size"),f=j.length;f--;){var d=svgedit.recalculate.recalculateDimensions(j[f]);d&&b.addSubCommand(d)}if(!b.isEmpty()){sa(b);na("changed",j)}},$b=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],Wb=function(b){console.log([b.a,b.b,b.c,b.d,b.e,b.f])},ib=null,Ca=this.clearSelection=function(b){if(j[0]!=null){var f,d,o=j.length;
for(f=0;f<o;++f){d=j[f];if(d==null)break;Z.releaseSelector(d);j[f]=null}}b||na("selected",j)},bb=this.addToSelection=function(b,f){if(b.length!=0){for(var d=0;d<j.length;){if(j[d]==null)break;++d}for(var o=b.length;o--;){var n=b[o];if(n&&svgedit.utilities.getBBox(n)){if(n.tagName==="a"&&n.childNodes.length===1)n=n.firstChild;if(j.indexOf(n)==-1){j[d]=n;d++;n=Z.requestSelector(n);j.length>1&&n.showGrips(false)}}}na("selected",j);f||j.length==1?Z.requestSelector(j[0]).showGrips(true):Z.requestSelector(j[0]).showGrips(false);
for(j.sort(function(m,u){if(m&&u&&m.compareDocumentPosition)return 3-(u.compareDocumentPosition(m)&6);if(m==null)return 1});j[0]==null;)j.shift(0)}},cb=this.selectOnly=function(b,f){Ca(true);bb(b,f)};this.removeFromSelection=function(b){if(j[0]!=null)if(b.length!=0){var f,d=0,o=Array(j.length),n=j.length;for(f=0;f<n;++f){var m=j[f];if(m)if(b.indexOf(m)==-1){o[d]=m;d++}else Z.releaseSelector(m)}j=o}};this.selectAllInCurrentLayer=function(){var b=C().getCurrentLayer();if(b){wa="select";cb($(q||b).children())}};
var qb=this.getMouseTarget=function(b){if(b==null)return null;b=b.target;if(b.correspondingUseElement)b=b.correspondingUseElement;if([i.MATH,i.HTML].indexOf(b.namespaceURI)>=0&&b.id!="svgcanvas")for(;b.nodeName!="foreignObject";){b=b.parentNode;if(!b)return r}var f=C().getCurrentLayer();if([r,a,v,f].indexOf(b)>=0)return r;if($(b).closest("#selectorParentGroup").length)return Z.selectorParentGroup;for(;b.parentNode!==(q||f);)b=b.parentNode;return b};(function(){var b=null,f=null,d=null,o=null,n=null,
m={},u={minx:null,miny:null,maxx:null,maxy:null},w=0,B={x:0,y:0},L={x:0,y:0},G={x:0,y:0},E={x:0,y:0},X,S,Q={x:0,y:0},U={x:0,y:0},ca=function(V){var M={x:0,y:0},K=B,N=L,P=G,ba=E,ha=1/6,ra=V*V,Aa=ra*V,da=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];M.x=ha*((K.x*da[0][0]+N.x*da[0][1]+P.x*da[0][2]+ba.x*da[0][3])*Aa+(K.x*da[1][0]+N.x*da[1][1]+P.x*da[1][2]+ba.x*da[1][3])*ra+(K.x*da[2][0]+N.x*da[2][1]+P.x*da[2][2]+ba.x*da[2][3])*V+(K.x*da[3][0]+N.x*da[3][1]+P.x*da[3][2]+ba.x*da[3][3]));M.y=ha*((K.y*da[0][0]+
N.y*da[0][1]+P.y*da[0][2]+ba.y*da[0][3])*Aa+(K.y*da[1][0]+N.y*da[1][1]+P.y*da[1][2]+ba.y*da[1][3])*ra+(K.y*da[2][0]+N.y*da[2][1]+P.y*da[2][2]+ba.y*da[2][3])*V+(K.y*da[3][0]+N.y*da[3][1]+P.y*da[3][2]+ba.y*da[3][3]));return{x:M.x,y:M.y}};$(a).mousedown(function(V){if(!(e.spaceKey||V.button===1)){var M=V.button===2;V.altKey&&svgCanvas.cloneSelectedElements(0,0);ib=$("#svgcontent g")[0].getScreenCTM().inverse();var K=svgedit.math.transformPoint(V.pageX,V.pageY,ib),N=K.x*s,P=K.y*s;V.preventDefault();if(M){wa=
"select";Vb=K}K=N/s;P=P/s;var ba=qb(V);if(ba.tagName==="a"&&ba.childNodes.length===1)ba=ba.firstChild;o=f=N=K;var ha=P;n=d=P;if(c.gridSnapping){K=svgedit.utilities.snapToGrid(K);P=svgedit.utilities.snapToGrid(P);f=svgedit.utilities.snapToGrid(f);d=svgedit.utilities.snapToGrid(d)}if(ba==Z.selectorParentGroup&&j[0]!=null){ba=V.target;var ra=tb(ba,"type");if(ra=="rotate")wa="rotate";else if(ra=="resize"){wa="resize";Wa=tb(ba,"dir")}ba=j[0]}hb=ba.getAttribute("transform");var Aa;ra=svgedit.transformlist.getTransformList(ba);
switch(wa){case "select":ta=true;Wa="none";if(M)ta=false;if(ba!=r){if(j.indexOf(ba)==-1){V.shiftKey||Ca(true);bb([ba]);Nb=ba;ua.clear()}if(!M)for(M=0;M<j.length;++M)if(j[M]!=null){Aa=svgedit.transformlist.getTransformList(j[M]);Aa.numberOfItems?Aa.insertItemBefore(r.createSVGTransform(),0):Aa.appendItem(r.createSVGTransform())}}else if(!M){Ca();wa="multiselect";if(qa==null)qa=Z.getRubberBandBox();o*=s;n*=s;svgedit.utilities.assignAttributes(qa,{x:o,y:n,width:0,height:0,display:"inline"},100)}break;
case "zoom":ta=true;if(qa==null)qa=Z.getRubberBandBox();svgedit.utilities.assignAttributes(qa,{x:N*s,y:N*s,width:0,height:0,display:"inline"},100);break;case "resize":ta=true;f=K;d=P;m=svgedit.utilities.getBBox($("#selectedBox0")[0]);var da={};$.each(m,function(za,Da){da[za]=Da/s});m=da;M=svgedit.utilities.getRotationAngle(ba)?1:0;if(svgedit.math.hasMatrixTransform(ra)){ra.insertItemBefore(r.createSVGTransform(),M);ra.insertItemBefore(r.createSVGTransform(),M);ra.insertItemBefore(r.createSVGTransform(),
M)}else{ra.appendItem(r.createSVGTransform());ra.appendItem(r.createSVGTransform());ra.appendItem(r.createSVGTransform());if(svgedit.browser.supportsNonScalingStroke()){if(K=svgedit.browser.isWebkit())Aa=function(za){var Da=za.getAttributeNS(null,"stroke");za.removeAttributeNS(null,"stroke");setTimeout(function(){za.setAttributeNS(null,"stroke",Da)},0)};ba.style.vectorEffect="non-scaling-stroke";K&&Aa(ba);P=ba.getElementsByTagName("*");N=P.length;for(M=0;M<N;M++){P[M].style.vectorEffect="non-scaling-stroke";
K&&Aa(P[M])}}}break;case "fhellipse":case "fhrect":case "fhpath":G.x=N;G.y=ha;ta=true;b=N+","+ha+" ";Aa=t.stroke_width==0?1:t.stroke_width;I({element:"polyline",curStyles:true,attr:{points:b,id:Fa(),fill:"none",opacity:t.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}});u.minx=N;u.maxx=N;u.miny=ha;u.maxy=ha;break;case "image":ta=true;Aa=I({element:"image",attr:{x:K,y:P,width:0,height:0,id:Fa(),opacity:t.opacity/2,style:"pointer-events:inherit"}});Ba(Aa,Ta);Pb(Aa);break;case "square":case "rect":ta=
true;f=K;d=P;I({element:"rect",curStyles:true,attr:{x:K,y:P,width:0,height:0,id:Fa(),opacity:t.opacity/2}});break;case "line":ta=true;Aa=t.stroke_width==0?1:t.stroke_width;I({element:"line",curStyles:true,attr:{x1:K,y1:P,x2:K,y2:P,id:Fa(),stroke:t.stroke,"stroke-width":Aa,"stroke-dasharray":t.stroke_dasharray,"stroke-linejoin":t.stroke_linejoin,"stroke-linecap":t.stroke_linecap,"stroke-opacity":t.stroke_opacity,fill:"none",opacity:t.opacity/2,style:"pointer-events:none"}});break;case "circle":ta=
true;I({element:"circle",curStyles:true,attr:{cx:K,cy:P,r:0,id:Fa(),opacity:t.opacity/2}});break;case "ellipse":ta=true;I({element:"ellipse",curStyles:true,attr:{cx:K,cy:P,rx:0,ry:0,id:Fa(),opacity:t.opacity/2}});break;case "text":ta=true;I({element:"text",curStyles:true,attr:{x:K,y:P,id:Fa(),fill:Xa.fill,"stroke-width":Xa.stroke_width,"font-size":Xa.font_size,"font-family":Xa.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:t.opacity}});break;case "path":case "pathedit":f*=s;d*=
s;ua.mouseDown(V,ba,f,d);ta=true;break;case "textedit":f*=s;d*=s;La.mouseDown(V,ba,f,d);ta=true;break;case "rotate":ta=true;e.undoMgr.beginUndoableChange("transform",j)}V=Qa("mouseDown",{event:V,start_x:f,start_y:d,selectedElements:j},true);$.each(V,function(za,Da){if(Da&&Da.started)ta=true})}}).mousemove(function(V){if(ta)if(!(V.button===1||e.spaceKey)){var M,K,N,P,ba,ha=j[0],ra=svgedit.math.transformPoint(V.pageX,V.pageY,ib),Aa=ra.x*s;ra=ra.y*s;var da=svgedit.utilities.getElem(ab());x=K=Aa/s;y=
P=ra/s;if(c.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}V.preventDefault();switch(wa){case "select":if(j[0]!==null){K=x-f;N=y-d;if(c.gridSnapping){K=svgedit.utilities.snapToGrid(K);N=svgedit.utilities.snapToGrid(N)}if(V.shiftKey){M=svgedit.math.snapToAngle(f,d,x,y);x=M.x;y=M.y}if(K!=0||N!=0){P=j.length;for(M=0;M<P;++M){ha=j[M];if(ha==null)break;var za=r.createSVGTransform();da=svgedit.transformlist.getTransformList(ha);za.setTranslate(K,N);da.numberOfItems?da.replaceItem(za,
0):da.appendItem(za);Z.requestSelector(ha).resize()}na("transition",j)}}break;case "multiselect":K*=s;P*=s;svgedit.utilities.assignAttributes(qa,{x:Math.min(o,K),y:Math.min(n,P),width:Math.abs(K-o),height:Math.abs(P-n)},100);da=[];K=[];za=Eb();P=j.length;for(M=0;M<P;++M){N=za.indexOf(j[M]);if(N==-1)da.push(j[M]);else za[N]=null}P=za.length;for(M=0;M<P;++M)za[M]&&K.push(za[M]);da.length>0&&e.removeFromSelection(da);K.length>0&&bb(K);break;case "resize":da=svgedit.transformlist.getTransformList(ha);
N=(M=svgedit.math.hasMatrixTransform(da))?m:svgedit.utilities.getBBox(ha);P=N.x;za=N.y;var Da=N.width,fb=N.height;K=x-f;N=y-d;if(c.gridSnapping){K=svgedit.utilities.snapToGrid(K);N=svgedit.utilities.snapToGrid(N);fb=svgedit.utilities.snapToGrid(fb);Da=svgedit.utilities.snapToGrid(Da)}if(ba=svgedit.utilities.getRotationAngle(ha)){var gb=Math.sqrt(K*K+N*N);N=Math.atan2(N,K)-ba*Math.PI/180;K=gb*Math.cos(N);N=gb*Math.sin(N)}if(Wa.indexOf("n")==-1&&Wa.indexOf("s")==-1)N=0;if(Wa.indexOf("e")==-1&&Wa.indexOf("w")==
-1)K=0;var Gb=gb=0,Rb=fb?(fb+N)/fb:1,Hb=Da?(Da+K)/Da:1;if(Wa.indexOf("n")>=0){Rb=fb?(fb-N)/fb:1;Gb=fb}if(Wa.indexOf("w")>=0){Hb=Da?(Da-K)/Da:1;gb=Da}K=r.createSVGTransform();N=r.createSVGTransform();Da=r.createSVGTransform();if(c.gridSnapping){P=svgedit.utilities.snapToGrid(P);gb=svgedit.utilities.snapToGrid(gb);za=svgedit.utilities.snapToGrid(za);Gb=svgedit.utilities.snapToGrid(Gb)}K.setTranslate(-(P+gb),-(za+Gb));if(V.shiftKey)if(Hb==1)Hb=Rb;else Rb=Hb;N.setScale(Hb,Rb);Da.setTranslate(P+gb,za+
Gb);if(M){M=ba?1:0;da.replaceItem(K,2+M);da.replaceItem(N,1+M);da.replaceItem(Da,Number(M))}else{M=da.numberOfItems;da.replaceItem(Da,M-3);da.replaceItem(N,M-2);da.replaceItem(K,M-1)}Z.requestSelector(ha).resize();na("transition",j);break;case "zoom":K*=s;P*=s;svgedit.utilities.assignAttributes(qa,{x:Math.min(o*s,K),y:Math.min(n*s,P),width:Math.abs(K-o*s),height:Math.abs(P-n*s)},100);break;case "text":svgedit.utilities.assignAttributes(da,{x:x,y:y},1E3);break;case "line":P=null;window.opera||r.suspendRedraw(1E3);
if(c.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}K=x;M=y;if(V.shiftKey){M=svgedit.math.snapToAngle(f,d,K,M);K=M.x;M=M.y}da.setAttributeNS(null,"x2",K);da.setAttributeNS(null,"y2",M);window.opera||r.unsuspendRedraw(P);break;case "foreignObject":case "square":case "rect":case "image":K=Math.abs(x-f);M=Math.abs(y-d);if(wa=="square"||V.shiftKey){K=M=Math.max(K,M);P=f<x?f:f-K;za=d<y?d:d-M}else{P=Math.min(f,x);za=Math.min(d,y)}if(c.gridSnapping){K=svgedit.utilities.snapToGrid(K);
M=svgedit.utilities.snapToGrid(M);P=svgedit.utilities.snapToGrid(P);za=svgedit.utilities.snapToGrid(za)}svgedit.utilities.assignAttributes(da,{width:K,height:M,x:P,y:za},1E3);break;case "circle":M=$(da).attr(["cx","cy"]);K=M.cx;M=M.cy;K=Math.sqrt((x-K)*(x-K)+(y-M)*(y-M));if(c.gridSnapping)K=svgedit.utilities.snapToGrid(K);da.setAttributeNS(null,"r",K);break;case "ellipse":M=$(da).attr(["cx","cy"]);K=M.cx;M=M.cy;P=null;window.opera||r.suspendRedraw(1E3);if(c.gridSnapping){x=svgedit.utilities.snapToGrid(x);
K=svgedit.utilities.snapToGrid(K);y=svgedit.utilities.snapToGrid(y);M=svgedit.utilities.snapToGrid(M)}da.setAttributeNS(null,"rx",Math.abs(x-K));da.setAttributeNS(null,"ry",Math.abs(V.shiftKey?x-K:y-M));window.opera||r.unsuspendRedraw(P);break;case "fhellipse":case "fhrect":u.minx=Math.min(K,u.minx);u.maxx=Math.max(K,u.maxx);u.miny=Math.min(P,u.miny);u.maxy=Math.max(P,u.maxy);case "fhpath":E.x=K;E.y=P;if(B.x&&B.y)for(M=0;M<9;M++){X=M/10;S=(M+1)/10;U=Q=ca(S);Q=ca(X);w+=Math.sqrt((U.x-Q.x)*(U.x-Q.x)+
(U.y-Q.y)*(U.y-Q.y));if(w>0.8){b+=+Q.x+","+Q.y+" ";da.setAttributeNS(null,"points",b);w-=0.8}}B={x:L.x,y:L.y};L={x:G.x,y:G.y};G={x:E.x,y:E.y};break;case "path":case "pathedit":x*=s;y*=s;if(c.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y);f=svgedit.utilities.snapToGrid(f);d=svgedit.utilities.snapToGrid(d)}if(V.shiftKey){console.log("dragging!!");if(M=svgedit.path.path){da=M.dragging?M.dragging[0]:f;M=M.dragging?M.dragging[1]:d}else{da=f;M=d}M=svgedit.math.snapToAngle(da,
M,x,y);x=M.x;y=M.y}if(qa&&qa.getAttribute("display")!=="none"){K*=s;P*=s;svgedit.utilities.assignAttributes(qa,{x:Math.min(o*s,K),y:Math.min(n*s,P),width:Math.abs(K-o*s),height:Math.abs(P-n*s)},100)}ua.mouseMove(x,y);break;case "textedit":x*=s;y*=s;La.mouseMove(Aa,ra);break;case "rotate":N=svgedit.utilities.getBBox(ha);K=N.x+N.width/2;M=N.y+N.height/2;da=svgedit.math.getMatrix(ha);da=svgedit.math.transformPoint(K,M,da);K=da.x;M=da.y;ba=(Math.atan2(M-y,K-x)*(180/Math.PI)-90)%360;if(c.gridSnapping)ba=
svgedit.utilities.snapToGrid(ba);if(V.shiftKey)ba=Math.round(ba/45)*45;e.setRotationAngle(ba<-180?360+ba:ba,true);na("transition",j)}Qa("mouseMove",{event:V,mouse_x:Aa,mouse_y:ra,selected:ha})}}).click(function(V){V.preventDefault();return false}).dblclick(function(V){var M=V.target.parentNode;if(M!==q){var K=qb(V),N=K.tagName;if(N==="text"&&wa!=="textedit"){V=svgedit.math.transformPoint(V.pageX,V.pageY,ib);La.select(K,V.x,V.y)}if((N==="g"||N==="a")&&svgedit.utilities.getRotationAngle(K)){Xb(K);K=
j[0];Ca(true)}q&&Sb();M.tagName!=="g"&&M.tagName!=="a"||M===C().getCurrentLayer()||K===Z.selectorParentGroup||hc(K)}}).mouseup(function(V){if(V.button!==2){var M=Nb;Nb=null;if(ta){var K=svgedit.math.transformPoint(V.pageX,V.pageY,ib),N=K.x*s;K=K.y*s;var P=N/s,ba=K/s,ha=svgedit.utilities.getElem(ab()),ra=false;ta=false;switch(wa){case "resize":case "multiselect":if(qa!=null){qa.setAttribute("display","none");kb=[]}wa="select";case "select":if(j[0]!=null){if(j[1]==null){N=j[0];switch(N.tagName){case "g":case "use":case "image":case "foreignObject":break;
default:Na.fill=N.getAttribute("fill");Na.fill_opacity=N.getAttribute("fill-opacity");Na.stroke=N.getAttribute("stroke");Na.stroke_opacity=N.getAttribute("stroke-opacity");Na.stroke_width=N.getAttribute("stroke-width");Na.stroke_dasharray=N.getAttribute("stroke-dasharray");Na.stroke_linejoin=N.getAttribute("stroke-linejoin");Na.stroke_linecap=N.getAttribute("stroke-linecap")}if(N.tagName=="text"){Xa.font_size=N.getAttribute("font-size");Xa.font_family=N.getAttribute("font-family")}Z.requestSelector(N).showGrips(true)}wb();
if(P!=o||ba!=n){N=j.length;for(V=0;V<N;++V){if(j[V]==null)break;j[V].firstChild||Z.requestSelector(j[V]).resize()}}else{N=V.target;if(j[0].nodeName==="path"&&j[1]==null)ua.select(j[0]);else V.shiftKey&&M!=N&&e.removeFromSelection([N])}if(svgedit.browser.supportsNonScalingStroke())if(V=j[0]){V.removeAttribute("style");svgedit.utilities.walkTree(V,function(za){za.removeAttribute("style")})}}return;case "zoom":qa!=null&&qa.setAttribute("display","none");na("zoomed",{x:Math.min(o,P),y:Math.min(n,ba),
width:Math.abs(P-o),height:Math.abs(ba-n),factor:V.shiftKey?0.5:2});return;case "fhpath":w=0;B={x:0,y:0};L={x:0,y:0};G={x:0,y:0};E={x:0,y:0};M=ha.getAttribute("points");P=M.indexOf(",");if(ra=P>=0?M.indexOf(",",P+1)>=0:M.indexOf(" ",M.indexOf(" ")+1)>=0)ha=ua.smoothPolylineIntoPath(ha);break;case "line":M=$(ha).attr(["x1","x2","y1","y2"]);ra=M.x1!=M.x2||M.y1!=M.y2;break;case "foreignObject":case "square":case "rect":case "image":M=$(ha).attr(["width","height"]);ra=M.width!=0||M.height!=0||wa==="image";
break;case "circle":ra=ha.getAttribute("r")!=0;break;case "ellipse":M=$(ha).attr(["rx","ry"]);ra=M.rx!=null||M.ry!=null;break;case "fhellipse":if(u.maxx-u.minx>0&&u.maxy-u.miny>0){ha=I({element:"ellipse",curStyles:true,attr:{cx:(u.minx+u.maxx)/2,cy:(u.miny+u.maxy)/2,rx:(u.maxx-u.minx)/2,ry:(u.maxy-u.miny)/2,id:ab()}});na("changed",[ha]);ra=true}break;case "fhrect":if(u.maxx-u.minx>0&&u.maxy-u.miny>0){ha=I({element:"rect",curStyles:true,attr:{x:u.minx,y:u.miny,width:u.maxx-u.minx,height:u.maxy-u.miny,
id:ab()}});na("changed",[ha]);ra=true}break;case "text":ra=true;cb([ha]);La.start(ha);break;case "path":ha=null;ta=true;M=ua.mouseUp(V,ha,N,K);ha=M.element;ra=M.keep;break;case "pathedit":ra=true;ha=null;ua.mouseUp(V);break;case "textedit":ra=false;ha=null;La.mouseUp(V,N,K);break;case "rotate":ra=true;ha=null;wa="select";M=e.undoMgr.finishUndoableChange();M.isEmpty()||sa(M);wb();na("changed",j)}N=Qa("mouseUp",{event:V,mouse_x:N,mouse_y:K},true);$.each(N,function(za,Da){if(Da){ra=Da.keep||ra;ha=Da.element;
ta=Da.started||ta}});if(!ra&&ha!=null){C().releaseId(ab());ha.parentNode.removeChild(ha);ha=null;for(N=V.target;N.parentNode.parentNode.tagName=="g";)N=N.parentNode;if((wa!="path"||!drawn_path)&&N.parentNode.id!="selectorParentGroup"&&N.id!="svgcanvas"&&N.id!="svgroot"){e.setMode("select");cb([N],true)}}else if(ha!=null){e.addedNew=true;V=0.2;var Aa;if(Mb.beginElement&&ha.getAttribute("opacity")!=t.opacity){Aa=$(Mb).clone().attr({to:t.opacity,dur:V}).appendTo(ha);try{Aa[0].beginElement()}catch(da){}}else V=
0;setTimeout(function(){Aa&&Aa.remove();ha.setAttribute("opacity",t.opacity);ha.setAttribute("style","pointer-events:inherit");Ya(ha);if(wa==="path")ua.toEditMode(ha);else c.selectNew&&cb([ha],true);sa(new svgedit.history.InsertElementCommand(ha));na("changed",[ha])},V*1E3)}hb=null}}});$(a).bind("mousewheel DOMMouseScroll",function(V){V.preventDefault();V=V.originalEvent;ib=$("#svgcontent g")[0].getScreenCTM().inverse();var M=svgedit.math.transformPoint(V.pageX,V.pageY,ib);M={x:M.x,y:M.y,width:0,
height:0};if(V=V.wheelDelta?V.wheelDelta:V.detail?-V.detail:0){M.factor=Math.max(0.75,Math.min(4/3,V));na("zoomed",M)}})})();var Pb=function(b){$(b).click(function(f){f.preventDefault()})};La=e.textActions=function(){function b(K){var N=L.value==="";$(L).focus();if(!arguments.length)if(N)K=0;else{if(L.selectionEnd!==L.selectionStart)return;K=L.selectionEnd}var P;P=S[K];N||L.setSelectionRange(K,K);G=svgedit.utilities.getElem("text_cursor");if(!G){G=document.createElementNS(i.SVG,"line");svgedit.utilities.assignAttributes(G,
{id:"text_cursor",stroke:"#333","stroke-width":1});G=svgedit.utilities.getElem("selectorParentGroup").appendChild(G)}X||(X=setInterval(function(){var ba=G.getAttribute("display")==="none";G.setAttribute("display",ba?"inline":"none")},600));N=m(P.x,Q.y);P=m(P.x,Q.y+Q.height);svgedit.utilities.assignAttributes(G,{x1:N.x,y1:N.y,x2:P.x,y2:P.y,visibility:"visible",display:"inline"});E&&E.setAttribute("d","")}function f(K,N,P){if(K===N)b(N);else{P||L.setSelectionRange(K,N);E=svgedit.utilities.getElem("text_selectblock");
if(!E){E=document.createElementNS(i.SVG,"path");svgedit.utilities.assignAttributes(E,{id:"text_selectblock",fill:"green",opacity:0.5,style:"pointer-events:none"});svgedit.utilities.getElem("selectorParentGroup").appendChild(E)}K=S[K];var ba=S[N];G.setAttribute("visibility","hidden");N=m(K.x,Q.y);P=m(K.x+(ba.x-K.x),Q.y);var ha=m(K.x,Q.y+Q.height);K=m(K.x+(ba.x-K.x),Q.y+Q.height);svgedit.utilities.assignAttributes(E,{d:"M"+N.x+","+N.y+" L"+P.x+","+P.y+" "+K.x+","+K.y+" "+ha.x+","+ha.y+"z",display:"inline"})}}
function d(K,N){var P=r.createSVGPoint();P.x=K;P.y=N;if(S.length==1)return 0;P=B.getCharNumAtPosition(P);if(P<0){P=S.length-2;if(K<=S[0].x)P=0}else if(P>=S.length-2)P=S.length-2;var ba=S[P];K>ba.x+ba.width/2&&P++;return P}function o(K,N,P){var ba=L.selectionStart;K=d(K,N);f(Math.min(ba,K),Math.max(ba,K),!P)}function n(K,N){var P={x:K,y:N};P.x/=s;P.y/=s;if(U){var ba=svgedit.math.transformPoint(P.x,P.y,U.inverse());P.x=ba.x;P.y=ba.y}return P}function m(K,N){var P={x:K,y:N};if(U){var ba=svgedit.math.transformPoint(P.x,
P.y,U);P.x=ba.x;P.y=ba.y}P.x*=s;P.y*=s;return P}function u(K){f(0,B.textContent.length);$(this).unbind(K)}function w(K){if(M&&B){var N=svgedit.math.transformPoint(K.pageX,K.pageY,ib);N=n(N.x*s,N.y*s);N=d(N.x,N.y);var P=B.textContent,ba=P.substr(0,N).replace(/[a-z0-9]+$/i,"").length;P=P.substr(N).match(/^[a-z0-9]+/i);f(ba,(P?P[0].length:0)+N);$(K.target).click(u);setTimeout(function(){$(K.target).unbind("click",u)},300)}}var B,L,G,E,X,S=[],Q,U,ca,V,M;return{select:function(K,N,P){B=K;La.toEditMode(N,
P)},start:function(K){B=K;La.toEditMode()},mouseDown:function(K,N,P,ba){K=n(P,ba);L.focus();b(d(K.x,K.y));ca=P;V=ba},mouseMove:function(K,N){var P=n(K,N);o(P.x,P.y)},mouseUp:function(K,N,P){var ba=n(N,P);o(ba.x,ba.y,true);K.target!==B&&N<ca+2&&N>ca-2&&P<V+2&&P>V-2&&La.toSelectMode(true)},setCursor:b,toEditMode:function(K,N){M=false;wa="textedit";Z.requestSelector(B).showGrips(false);Z.requestSelector(B);La.init();$(B).css("cursor","text");if(arguments.length){var P=n(K,N);b(d(P.x,P.y))}else b();setTimeout(function(){M=
true},300)},toSelectMode:function(K){wa="select";clearInterval(X);X=null;E&&$(E).attr("display","none");G&&$(G).attr("visibility","hidden");$(B).css("cursor","move");if(K){Ca();$(B).css("cursor","move");na("selected",[B]);bb([B],true)}B&&!B.textContent.length&&e.deleteSelectedElements();$(L).blur();B=false},setInputElem:function(K){L=K},clear:function(){wa=="textedit"&&La.toSelectMode()},init:function(){if(B){var K,N;if(!B.parentNode){B=j[0];Z.requestSelector(B).showGrips(false)}var P=B.textContent.length;
K=B.getAttribute("transform");Q=svgedit.utilities.getBBox(B);U=K?svgedit.math.getMatrix(B):null;S=Array(P);L.focus();$(B).unbind("dblclick",w).dblclick(w);P||(N={x:Q.x+Q.width/2,width:0});for(K=0;K<P;K++){var ba=B.getStartPositionOfChar(K);N=B.getEndPositionOfChar(K);if(!svgedit.browser.supportsGoodTextCharPos()){var ha=e.contentW*s;ba.x-=ha;N.x-=ha;ba.x/=s;N.x/=s}S[K]={x:ba.x,y:Q.y,width:N.x-ba.x,height:Q.height}}S.push({x:N.x,width:0});f(L.selectionStart,L.selectionEnd,true)}}}}();ua=e.pathActions=
function(){var b=false,f,d;svgedit.path.Path.prototype.endChanges=function(m){if(svgedit.browser.isWebkit()){var u=this.elem;u.setAttribute("d",ua.convertPath(u))}m=new svgedit.history.ChangeElementCommand(this.elem,{d:this.last_d},m);sa(m);na("changed",[this.elem])};svgedit.path.Path.prototype.addPtsToSelection=function(m){var u,w;$.isArray(m)||(m=[m]);for(u=0;u<m.length;u++){var B=m[u];w=this.segs[B];w.ptgrip&&this.selected_pts.indexOf(B)==-1&&B>=0&&this.selected_pts.push(B)}this.selected_pts.sort();
u=this.selected_pts.length;for(m=Array(u);u--;){w=this.segs[this.selected_pts[u]];w.select(true);m[u]=w.ptgrip}ua.canDeleteNodes=true;ua.closed_subpath=this.subpathIsClosed(this.selected_pts[0]);na("selected",m)};var o=f=null,n=false;return{mouseDown:function(m,u,w,B){var L;if(wa==="path"){mouse_x=w;mouse_y=B;B=mouse_x/s;u=mouse_y/s;w=svgedit.utilities.getElem("path_stretch_line");if(c.gridSnapping){B=svgedit.utilities.snapToGrid(B);u=svgedit.utilities.snapToGrid(u);mouse_x=svgedit.utilities.snapToGrid(mouse_x);
mouse_y=svgedit.utilities.snapToGrid(mouse_y)}if(!w){w=document.createElementNS(i.SVG,"path");svgedit.utilities.assignAttributes(w,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"});w=svgedit.utilities.getElem("selectorParentGroup").appendChild(w)}w.setAttribute("display","inline");var G=null;if(o){G=o.pathSegList;var E=G.numberOfItems;L=6/s;for(var X=false;E;){E--;var S=G.getItem(E),Q=S.x;S=S.y;if(B>=Q-L&&B<=Q+L&&u>=S-L&&u<=S+L){X=true;break}}L=ab();svgedit.path.removePath_(L);
L=svgedit.utilities.getElem(L);Q=G.numberOfItems;if(X){if(E<=1&&Q>=2){B=G.getItem(0).x;u=G.getItem(0).y;m=w.pathSegList.getItem(1);m=m.pathSegType===4?o.createSVGPathSegLinetoAbs(B,u):o.createSVGPathSegCurvetoCubicAbs(B,u,m.x1/s,m.y1/s,B,u);B=o.createSVGPathSegClosePath();G.appendItem(m);G.appendItem(B)}else if(Q<3)return G=false;$(w).remove();element=L;o=null;ta=false;if(b){svgedit.path.path.matrix&&svgedit.coords.remapElement(L,{},svgedit.path.path.matrix.inverse());w=L.getAttribute("d");m=$(svgedit.path.path.elem).attr("d");
$(svgedit.path.path.elem).attr("d",m+w);$(L).remove();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();svgedit.path.path.init();ua.toEditMode(svgedit.path.path.elem);svgedit.path.path.selectPt();return false}}else{if(!$.contains(a,qb(m))){console.log("Clicked outside canvas");return false}G=o.pathSegList.numberOfItems;E=o.pathSegList.getItem(G-1);L=E.x;E=E.y;if(m.shiftKey){m=svgedit.math.snapToAngle(L,E,B,u);B=m.x;u=m.y}m=w.pathSegList.getItem(1);m=m.pathSegType===4?o.createSVGPathSegLinetoAbs(pb(B),
pb(u)):o.createSVGPathSegCurvetoCubicAbs(pb(B),pb(u),m.x1/s,m.y1/s,m.x2/s,m.y2/s);o.pathSegList.appendItem(m);B*=s;u*=s;w.setAttribute("d",["M",B,u,B,u].join(" "));w=G;if(b)w+=svgedit.path.path.segs.length;svgedit.path.addPointGrip(w,B,u)}}else{d_attr="M"+B+","+u+" ";o=I({element:"path",curStyles:true,attr:{d:d_attr,id:Fa(),opacity:t.opacity/2}});w.setAttribute("d",["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" "));w=b?svgedit.path.path.segs.length:0;svgedit.path.addPointGrip(w,mouse_x,mouse_y)}}else if(svgedit.path.path){svgedit.path.path.storeD();
L=m.target.id;if(L.substr(0,14)=="pathpointgrip_"){u=svgedit.path.path.cur_pt=parseInt(L.substr(14));svgedit.path.path.dragging=[w,B];G=svgedit.path.path.segs[u];if(m.shiftKey)G.selected?svgedit.path.path.removePtFromSelection(u):svgedit.path.path.addPtsToSelection(u);else{if(svgedit.path.path.selected_pts.length<=1||!G.selected)svgedit.path.path.clearSelection();svgedit.path.path.addPtsToSelection(u)}}else if(L.indexOf("ctrlpointgrip_")==0){svgedit.path.path.dragging=[w,B];m=L.split("_")[1].split("c");
u=Number(m[0]);svgedit.path.path.selectPt(u,Number(m[1]))}if(!svgedit.path.path.dragging){if(qa==null)qa=Z.getRubberBandBox();svgedit.utilities.assignAttributes(qa,{x:w*s,y:B*s,width:0,height:0,display:"inline"},100)}}},mouseMove:function(m,u){n=true;if(wa==="path"){if(o){var w=o.pathSegList,B=w.numberOfItems-1,L=svgedit.utilities.getElem("path_stretch_line");if(L){w=w.getItem(B);if(w.pathSegType===6)svgedit.path.replacePathSeg(6,1,[m,u,(w.x+(w.x-w.x2))*s,(w.y+(w.y-w.y2))*s,m,u],L);else d?svgedit.path.replacePathSeg(6,
1,[m,u,d[0],d[1],m,u],L):svgedit.path.replacePathSeg(4,1,[m,u],L)}}}else if(svgedit.path.path.dragging){w=svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},svgedit.path.path);B=svgedit.path.getPointFromGrip({x:m,y:u},svgedit.path.path);L=B.x-w.x;w=B.y-w.y;svgedit.path.path.dragging=[m,u];svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(L,w):svgedit.path.path.movePts(L,w)}else{svgedit.path.path.selected_pts=[];svgedit.path.path.eachSeg(function(){if(this.next||
this.prev){var G=qa.getBBox(),E=svgedit.path.getGripPt(this);G=svgedit.math.rectsIntersect(G,{x:E.x,y:E.y,width:0,height:0});this.select(G);G&&svgedit.path.path.selected_pts.push(this.index)}})}},mouseUp:function(m,u){if(wa==="path"){if(!o){u=svgedit.utilities.getElem(ab());ta=false;d=null}return{keep:true,element:u}}if(svgedit.path.path.dragging){var w=svgedit.path.path.cur_pt;svgedit.path.path.dragging=false;svgedit.path.path.dragctrl=false;svgedit.path.path.update();n&&svgedit.path.path.endChanges("Move path point(s)");
!m.shiftKey&&!n&&svgedit.path.path.selectPt(w)}else if(qa&&qa.getAttribute("display")!="none"){qa.setAttribute("display","none");qa.getAttribute("width")<=2&&qa.getAttribute("height")<=2&&ua.toSelectMode(m.target)}else ua.toSelectMode(m.target);n=false},toEditMode:function(m){svgedit.path.path=svgedit.path.getPath_(m);wa="pathedit";Ca();svgedit.path.path.show(true).update();svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem);b=false},toSelectMode:function(m){var u=m==svgedit.path.path.elem;
wa="select";svgedit.path.path.show(false);f=false;Ca();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();if(u){na("selected",[m]);bb([m],true)}},addSubPath:function(m){if(m){wa="path";b=true}else{ua.clear(true);ua.toEditMode(svgedit.path.path.elem)}},select:function(m){if(f===m){ua.toEditMode(m);wa="pathedit"}else f=m},reorient:function(){var m=j[0];if(m)if(svgedit.utilities.getRotationAngle(m)!=0){var u=new svgedit.history.BatchCommand("Reorient path"),w={d:m.getAttribute("d"),transform:m.getAttribute("transform")};
u.addSubCommand(new svgedit.history.ChangeElementCommand(m,w));Ca();this.resetOrientation(m);sa(u);svgedit.path.getPath_(m).show(false).matrix=null;this.clear();bb([m],true);na("changed",j)}},clear:function(){f=null;if(o){var m=svgedit.utilities.getElem(ab());$(svgedit.utilities.getElem("path_stretch_line")).remove();$(m).remove();$(svgedit.utilities.getElem("pathpointgrip_container")).find("*").attr("display","none");o=d=null;ta=false}else wa=="pathedit"&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(false)},
resetOrientation:function(m){if(m==null||m.nodeName!="path")return false;var u=svgedit.transformlist.getTransformList(m),w=svgedit.math.transformListToTransform(u).matrix;u.clear();m.removeAttribute("transform");u=m.pathSegList;var B=u.numberOfItems,L;for(L=0;L<B;++L){var G=u.getItem(L),E=G.pathSegType;if(E!=1){var X=[];$.each(["",1,2],function(S,Q){var U=G["x"+Q],ca=G["y"+Q];if(U!==undefined&&ca!==undefined){U=svgedit.math.transformPoint(U,ca,w);X.splice(X.length,0,U.x,U.y)}});svgedit.path.replacePathSeg(E,
L,X,m)}}A(m,w)},zoomChange:function(){wa=="pathedit"&&svgedit.path.path.update()},getNodePoint:function(){var m=svgedit.path.path.segs[svgedit.path.path.selected_pts.length?svgedit.path.path.selected_pts[0]:1];return{x:m.item.x,y:m.item.y,type:m.type}},linkControlPoints:function(m){svgedit.path.setLinkControlPoints(m)},clonePathNode:function(){svgedit.path.path.storeD();for(var m=svgedit.path.path.selected_pts,u=m.length,w=[];u--;){var B=m[u];svgedit.path.path.addSeg(B);w.push(B+u);w.push(B+u+1)}svgedit.path.path.init().addPtsToSelection(w);
svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var m=svgedit.path.path.selected_pts;if(m.length===1){var u=svgedit.path.path.elem,w=u.pathSegList,B=m[0],L=null,G=null;svgedit.path.path.eachSeg(function(Q){if(this.type===2&&Q<=B)G=this.item;if(Q<=B)return true;if(this.type===2){L=Q;return false}if(this.type===1)return L=false});if(L==null)L=svgedit.path.path.segs.length-1;if(L!==false){var E=u.createSVGPathSegLinetoAbs(G.x,G.y),X=u.createSVGPathSegClosePath();if(L==
svgedit.path.path.segs.length-1){w.appendItem(E);w.appendItem(X)}else{svgedit.path.insertItemBefore(u,X,L);svgedit.path.insertItemBefore(u,E,L)}svgedit.path.path.init().selectPt(L+1)}else if(svgedit.path.path.segs[B].mate){w.removeItem(B);w.removeItem(B);svgedit.path.path.init().selectPt(B-1)}else{for(m=0;m<w.numberOfItems;m++){var S=w.getItem(m);if(S.pathSegType===2)E=m;else if(m===B)w.removeItem(E);else if(S.pathSegType===1&&B<m){X=m-1;w.removeItem(m);break}}for(m=B-E-1;m--;)svgedit.path.insertItemBefore(u,
w.getItem(E),X);u=w.getItem(E);svgedit.path.replacePathSeg(2,E,[u.x,u.y]);m=B;svgedit.path.path.init().selectPt(0)}}},deletePathNode:function(){if(ua.canDeleteNodes){svgedit.path.path.storeD();for(var m=svgedit.path.path.selected_pts,u=m.length;u--;)svgedit.path.path.deleteSeg(m[u]);var w=function(){var B=svgedit.path.path.elem.pathSegList,L=B.numberOfItems,G=function(S,Q){for(;Q--;)B.removeItem(S)};if(L<=1)return true;for(;L--;){var E=B.getItem(L);if(E.pathSegType===1){E=B.getItem(L-1);var X=B.getItem(L-
2);if(E.pathSegType===2){G(L-1,2);w();break}else if(X.pathSegType===2){G(L-2,3);w();break}}else if(E.pathSegType===2)if(L>0){E=B.getItem(L-1).pathSegType;if(E===2){G(L-1,1);w();break}else if(E===1&&B.numberOfItems-1===L){G(L,1);w();break}}}return false};w();if(svgedit.path.path.elem.pathSegList.numberOfItems<=1){ua.toSelectMode(svgedit.path.path.elem);e.deleteSelectedElements()}else{svgedit.path.path.init();svgedit.path.path.clearSelection();if(window.opera){m=$(svgedit.path.path.elem);m.attr("d",
m.attr("d"))}svgedit.path.path.endChanges("Delete path node(s)")}}},smoothPolylineIntoPath:function(m){var u=m.points,w=u.numberOfItems;if(w>=4){var B=u.getItem(0),L=null,G=[];G.push(["M",B.x,",",B.y," C"].join(""));for(m=1;m<=w-4;m+=3){var E=u.getItem(m),X=u.getItem(m+1),S=u.getItem(m+2);if(L)if((B=svgedit.path.smoothControlPoints(L,E,B))&&B.length==2){E=G[G.length-1].split(",");E[2]=B[0].x;E[3]=B[0].y;G[G.length-1]=E.join(",");E=B[1]}G.push([E.x,E.y,X.x,X.y,S.x,S.y].join(","));B=S;L=X}for(G.push("L");m<
w;){X=u.getItem(m);G.push([X.x,X.y].join(","));m++}G=G.join(" ");m=I({element:"path",curStyles:true,attr:{id:ab(),d:G,fill:"none"}})}return m},setSegType:function(m){svgedit.path.path.setSegType(m)},moveNode:function(m,u){var w=svgedit.path.path.selected_pts;if(w.length){svgedit.path.path.storeD();w=svgedit.path.path.segs[w[0]];var B={x:0,y:0};B[m]=u-w.item[m];w.move(B.x,B.y);svgedit.path.path.endChanges("Move path point")}},fixEnd:function(m){var u=m.pathSegList,w=u.numberOfItems,B,L;for(B=0;B<w;++B){var G=
u.getItem(B);if(G.pathSegType===2)L=G;if(G.pathSegType===1){G=u.getItem(B-1);if(G.x!=L.x||G.y!=L.y){u=m.createSVGPathSegLinetoAbs(L.x,L.y);svgedit.path.insertItemBefore(m,u,B);ua.fixEnd(m);break}}}svgedit.browser.isWebkit()&&m.setAttribute("d",ua.convertPath(m))},convertPath:function(m,u){var w,B=m.pathSegList,L=B.numberOfItems,G=0,E=0,X="",S=null;for(w=0;w<L;++w){var Q=B.getItem(w),U=Q.x||0,ca=Q.y||0,V=Q.x1||0,M=Q.y1||0,K=Q.x2||0,N=Q.y2||0,P=Q.pathSegType,ba=$b[P]["to"+(u?"Lower":"Upper")+"Case"](),
ha=function(ra,Aa,da){Aa=Aa?" "+Aa.join(" "):"";da=da?" "+svgedit.units.shortFloat(da):"";$.each(ra,function(za,Da){ra[za]=svgedit.units.shortFloat(Da)});X+=ba+ra.join(" ")+Aa+da};switch(P){case 1:X+="z";break;case 12:U-=G;case 13:if(u){G+=U;ba="l"}else{U+=G;G=U;ba="L"}ha([[U,E]]);break;case 14:ca-=E;case 15:if(u){E+=ca;ba="l"}else{ca+=E;E=ca;ba="L"}ha([[G,ca]]);break;case 2:case 4:case 18:U-=G;ca-=E;case 5:case 3:if(S&&B.getItem(w-1).pathSegType===1&&!u){G=S[0];E=S[1]}case 19:if(u){G+=U;E+=ca}else{U+=
G;ca+=E;G=U;E=ca}if(P===3)S=[G,E];ha([[U,ca]]);break;case 6:U-=G;V-=G;K-=G;ca-=E;M-=E;N-=E;case 7:if(u){G+=U;E+=ca}else{U+=G;V+=G;K+=G;ca+=E;M+=E;N+=E;G=U;E=ca}ha([[V,M],[K,N],[U,ca]]);break;case 8:U-=G;V-=G;ca-=E;M-=E;case 9:if(u){G+=U;E+=ca}else{U+=G;V+=G;ca+=E;M+=E;G=U;E=ca}ha([[V,M],[U,ca]]);break;case 10:U-=G;ca-=E;case 11:if(u){G+=U;E+=ca}else{U+=G;ca+=E;G=U;E=ca}ha([[Q.r1,Q.r2]],[Q.angle,Q.largeArcFlag?1:0,Q.sweepFlag?1:0],[U,ca]);break;case 16:U-=G;K-=G;ca-=E;N-=E;case 17:if(u){G+=U;E+=ca}else{U+=
G;K+=G;ca+=E;N+=E;G=U;E=ca}ha([[K,N],[U,ca]])}}return X}}}();var xb=this.removeUnusedDefElems=function(){var b=v.getElementsByTagNameNS(i.SVG,"defs");if(!b||!b.length)return 0;var f=[],d=0,o=["fill","stroke","filter","marker-start","marker-mid","marker-end"],n=o.length,m=v.getElementsByTagNameNS(i.SVG,"*"),u=m.length,w,B;for(w=0;w<u;w++){var L=m[w];for(B=0;B<n;B++){var G=svgedit.utilities.getUrlFromAttr(L.getAttribute(o[B]));G&&f.push(G.substr(1))}(B=Ia(L))&&B.indexOf("#")===0&&f.push(B.substr(1))}b=
$(b).find("linearGradient, radialGradient, filter, marker, svg, symbol");for(w=b.length;w--;){o=b[w];n=o.id;if(f.indexOf(n)<0){ub[n]=o;o.parentNode.removeChild(o);d++}}return d};this.svgCanvasToString=function(){for(;xb()>0;);ua.clear(true);$.each(v.childNodes,function(d,o){d&&o.nodeType===8&&o.data.indexOf("Created with")>=0&&v.insertBefore(o,v.firstChild)});if(q){Sb();cb([q])}var b=[];$(v).find("g:data(gsvg)").each(function(){var d=this.attributes,o=d.length,n;for(n=0;n<o;n++)if(d[n].nodeName==
"id"||d[n].nodeName=="style")o--;if(o<=0){d=this.firstChild;b.push(d);$(this).replaceWith(d)}});var f=this.svgToString(v,0);b.length&&$(b).each(function(){Fb(this)});return f};this.svgToString=function(b,f){var d=[],o=svgedit.utilities.toXml,n=c.baseUnit,m=RegExp("^-?[\\d\\.]+"+n+"$");if(b){Ya(b);var u=b.attributes,w,B,L=b.childNodes;for(B=0;B<f;B++)d.push(" ");d.push("<");d.push(b.nodeName);if(b.id==="svgcontent"){B=yb();if(n!=="px"){B.w=svgedit.units.convertUnit(B.w,n)+n;B.h=svgedit.units.convertUnit(B.h,
n)+n}d.push(' width="'+B.w+'" height="'+B.h+'" xmlns="'+i.SVG+'"');var G={};$(b).find("*").andSelf().each(function(){var Q=this.namespaceURI;if(Q&&!G[Q]&&Za[Q]&&Za[Q]!=="xmlns"&&Za[Q]!=="xml"){G[Q]=true;d.push(" xmlns:"+Za[Q]+'="'+Q+'"')}$.each(this.attributes,function(U,ca){var V=ca.namespaceURI;if(V&&!G[V]&&Za[V]!=="xmlns"&&Za[V]!=="xml"){G[V]=true;d.push(" xmlns:"+Za[V]+'="'+V+'"')}})});B=u.length;for(n=["width","height","xmlns","x","y","viewBox","id","overflow"];B--;){w=u.item(B);var E=o(w.nodeValue);
if(w.nodeName.indexOf("xmlns:")!==0)if(E!=""&&n.indexOf(w.localName)==-1)if(!w.namespaceURI||Za[w.namespaceURI]){d.push(" ");d.push(w.nodeName);d.push('="');d.push(E);d.push('"')}}}else{if(b.nodeName==="defs"&&!b.firstChild)return;var X=["-moz-math-font-style","_moz-math-font-style"];for(B=u.length-1;B>=0;B--){w=u.item(B);E=o(w.nodeValue);if(!(X.indexOf(w.localName)>=0))if(E!="")if(E.indexOf("pointer-events")!==0)if(!(w.localName==="class"&&E.indexOf("se_")===0)){d.push(" ");if(w.localName==="d")E=
ua.convertPath(b,true);if(isNaN(E)){if(m.test(E))E=svgedit.units.shortFloat(E)+n}else E=svgedit.units.shortFloat(E);if(la.apply&&b.nodeName==="image"&&w.localName==="href"&&la.images&&la.images==="embed"){var S=vb[E];if(S)E=S}if(!w.namespaceURI||w.namespaceURI==i.SVG||Za[w.namespaceURI]){d.push(w.nodeName);d.push('="');d.push(E);d.push('"')}}}}if(b.hasChildNodes()){d.push(">");f++;u=false;for(B=0;B<L.length;B++){n=L.item(B);switch(n.nodeType){case 1:d.push("\n");d.push(this.svgToString(L.item(B),
f));break;case 3:n=n.nodeValue.replace(/^\s+|\s+$/g,"");if(n!=""){u=true;d.push(String(o(n)))}break;case 4:d.push("\n");d.push(Array(f+1).join(" "));d.push("<![CDATA[");d.push(n.nodeValue);d.push("]]\>");break;case 8:d.push("\n");d.push(Array(f+1).join(" "));d.push("<!--");d.push(n.data);d.push("--\>")}}f--;if(!u){d.push("\n");for(B=0;B<f;B++)d.push(" ")}d.push("</");d.push(b.nodeName);d.push(">")}else d.push("/>")}return d.join("")};this.svgCanvasToAtlasString=function(){return this.svgToAtlasString(v,
0)};this.svgToAtlasString=function(b){if(b&&b.id==="svgcontent"){var f=b.childNodes,d=null;for(b=0;b<f.length;b++){var o=f.item(b);switch(o.nodeType){case 1:d=o;break;case 3:console.log(o);break;case 4:console.log(o);break;case 8:console.log(o)}}f=d.childNodes;var n;d=[];for(b=0;b<f.length;b++){var m=f.item(b);if(m.nodeType===1){var u=m.nodeName;o=m.getAttribute("sid");var w=m.getAttribute("class");if(!(u!=="path"&&u!=="rect")){u=w.indexOf("floor")>=0;var B=w.indexOf("shop")>=0;if(u||B){for(var L=
m.nodeName,G=L==="path",E=L==="rect",X={},S=0;S<m.attributes.length;S++)X[m.attributes.item(S).name]=m.attributes.item(S).value;m={type:L,shape:function(Q){var U;if(G)U=Q.d;else if(E){U=[];for(var ca in Q)if(ca==="x"||ca==="y"||ca==="width"||ca==="height")U.push(ca+'="'+Q[ca]+'"');U=U.join(" ")}return U}(X),style:function(Q){var U=[],ca;for(ca in Q)G&&/^(d|class|id)$/.test(ca)||E&&/^(id|class|x|y|(?!stroke-)width|height)$/.test(ca)||U.push(ca+'="'+Q[ca]+'"');Q=U.join(" ");console.log(Q);return Q}(X)};
if(o)m.sid=o;if(u)n=m;else if(B){m.shapeType=1;if(w.indexOf("not-accessible")>=0)m.shapeType=0;d.push(m)}}}}}return{floor:n,shops:d}}return""};this.embedImage=function(b,f){$(new Image).load(function(){var d=document.createElement("canvas");d.width=this.width;d.height=this.height;d.getContext("2d").drawImage(this,0,0);try{var o=";svgedit_url="+encodeURIComponent(b);o=d.toDataURL().replace(";base64",o+";base64");vb[b]=o}catch(n){vb[b]=false}Ta=b;f&&f(vb[b])}).attr("src",b)};this.setGoodImage=function(b){Ta=b};this.open=
function(){};this.save=function(b){Ca();b&&$.extend(la,b);la.apply=true;b=this.svgCanvasToString();na("saved",b)};this.rasterExport=function(b,f){var d="image/"+b.toLowerCase();Ca();var o=[],n={feGaussianBlur:nb.exportNoBlur,foreignObject:nb.exportNoforeignObject,"[stroke-dasharray]":nb.exportNoDashArray},m=$(v);if(!("font"in $("<canvas>")[0].getContext("2d")))n.text=nb.exportNoText;$.each(n,function(u,w){m.find(u).length&&o.push(w)});n=this.svgCanvasToString();na("exported",{svg:n,issues:o,type:b,
mimeType:d,quality:f})};this.getSvgString=function(){la.apply=false;return this.svgCanvasToString()};this.randomizeIds=function(b){arguments.length>0&&b==false?svgedit.draw.randomizeIds(false,C()):svgedit.draw.randomizeIds(true,C())};var Ib=this.uniquifyElems=function(b){var f={},d=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];svgedit.utilities.walkTree(b,function(w){if(w.nodeType==1){if(w.id){w.id in f||(f[w.id]={elem:null,attrs:[],hrefs:[]});f[w.id].elem=w}$.each(Lb,
function(L,G){var E=w.getAttributeNode(G);if(E){var X=svgedit.utilities.getUrlFromAttr(E.value);if(X=X?X.substr(1):null){X in f||(f[X]={elem:null,attrs:[],hrefs:[]});f[X].attrs.push(E)}}});var B=svgedit.utilities.getHref(w);if(B&&d.indexOf(w.nodeName)>=0)if(B=B.substr(1)){B in f||(f[B]={elem:null,attrs:[],hrefs:[]});f[B].hrefs.push(w)}}});for(var o in f)if(o){var n=f[o].elem;if(n){b=Fa();n.id=b;n=f[o].attrs;for(var m=n.length;m--;){var u=n[m];u.ownerElement.setAttribute(u.name,"url(#"+b+")")}n=f[o].hrefs;
for(m=n.length;m--;)svgedit.utilities.setHref(n[m],"#"+b)}}},Db=this.setUseData=function(b){var f=$(b);if(b.tagName!=="use")f=f.find("use");f.each(function(){var d=Ia(this).substr(1);if(d=svgedit.utilities.getElem(d)){$(this).data("ref",d);if(d.tagName=="symbol"||d.tagName=="svg")$(this).data("symbol",d).data("ref",d)}})},Jb=this.convertGradients=function(b){var f=$(b).find("linearGradient, radialGradient");if(!f.length&&svgedit.browser.isWebkit())f=$(b).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=
0});f.each(function(){if($(this).attr("gradientUnits")==="userSpaceOnUse"){var d=$(v).find('[fill="url(#'+this.id+')"],[stroke="url(#'+this.id+')"]');if(d.length)if(d=svgedit.utilities.getBBox(d[0]))if(this.tagName==="linearGradient"){var o=$(this).attr(["x1","y1","x2","y2"]),n=this.gradientTransform.baseVal;if(n&&n.numberOfItems>0){var m=svgedit.math.transformListToTransform(n).matrix;n=svgedit.math.transformPoint(o.x1,o.y1,m);m=svgedit.math.transformPoint(o.x2,o.y2,m);o.x1=n.x;o.y1=n.y;o.x2=m.x;
o.y2=m.y;this.removeAttribute("gradientTransform")}$(this).attr({x1:(o.x1-d.x)/d.width,y1:(o.y1-d.y)/d.height,x2:(o.x2-d.x)/d.width,y2:(o.y2-d.y)/d.height});this.removeAttribute("gradientUnits")}}})},Yb=this.convertToGroup=function(b){b||(b=j[0]);var f=$(b),d=new svgedit.history.BatchCommand,o;if(f.data("gsvg")){d=$(b.firstChild).attr(["x","y"]);$(b.firstChild.firstChild).unwrap();$(b).removeData("gsvg");o=svgedit.transformlist.getTransformList(b);var n=r.createSVGTransform();n.setTranslate(d.x,d.y);
o.appendItem(n);svgedit.recalculate.recalculateDimensions(b);na("selected",[b])}else if(f.data("symbol")){b=f.data("symbol");o=f.attr("transform");n=f.attr(["x","y"]);var m=b.getAttribute("viewBox");if(m){m=m.split(" ");n.x-=+m[0];n.y-=+m[1]}o+=" translate("+(n.x||0)+","+(n.y||0)+")";n=f.prev();d.addSubCommand(new svgedit.history.RemoveElementCommand(f[0],f[0].nextSibling,f[0].parentNode));f.remove();m=$(v).find("use:data(symbol)").length;f=h.createElementNS(i.SVG,"g");var u=b.childNodes,w;for(w=
0;w<u.length;w++)f.appendChild(u[w].cloneNode(true));if(svgedit.browser.isGecko()){u=$(svgedit.utilities.findDefs()).children("linearGradient,radialGradient,pattern").clone();$(f).append(u)}o&&f.setAttribute("transform",o);o=b.parentNode;Ib(f);svgedit.browser.isGecko()&&$(fa()).append($(f).find("linearGradient,radialGradient,pattern"));f.id=Fa();n.after(f);if(o){if(!m){n=b.nextSibling;o.removeChild(b);d.addSubCommand(new svgedit.history.RemoveElementCommand(b,n,o))}d.addSubCommand(new svgedit.history.InsertElementCommand(f))}Db(f);
svgedit.browser.isGecko()?Jb(svgedit.utilities.findDefs()):Jb(f);svgedit.utilities.walkTreePost(f,function(B){try{svgedit.recalculate.recalculateDimensions(B)}catch(L){console.log(L)}});$(f).find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=Fa()});cb([f]);(b=Xb(f,true))&&d.addSubCommand(b);sa(d)}else console.log("Unexpected element to ungroup:",b)};this.setSvgString=function(b){try{var f=svgedit.utilities.text2xml(b);
this.prepareSvg(f);var d=new svgedit.history.BatchCommand("Change Source"),o=v.nextSibling,n=r.removeChild(v);d.addSubCommand(new svgedit.history.RemoveElementCommand(n,o,r));v=h.adoptNode?h.adoptNode(f.documentElement):h.importNode(f.documentElement,true);r.appendChild(v);var m=$(v);e.current_drawing_=new svgedit.draw.Drawing(v,D);var u=C().getNonce();u?na("setnonce",u):na("unsetnonce");m.find("image").each(function(){var S=this;Pb(S);var Q=Ia(this);if(Q){if(Q.indexOf("data:")===0){var U=Q.match(/svgedit_url=(.*?);/);
if(U){var ca=decodeURIComponent(U[1]);$(new Image).load(function(){S.setAttributeNS(i.XLINK,"xlink:href",ca)}).attr("src",ca)}}e.embedImage(Q)}});m.find("svg").each(function(){if(!$(this).closest("defs").length){Ib(this);var S=this.parentNode;if(S.childNodes.length===1&&S.nodeName==="g"){$(S).data("gsvg",this);S.id=S.id||Fa()}else Fb(this)}});svgedit.browser.isGecko()&&m.find("linearGradient, radialGradient, pattern").appendTo(svgedit.utilities.findDefs());Db(m);Jb(m[0]);svgedit.utilities.walkTreePost(v,
function(S){try{svgedit.recalculate.recalculateDimensions(S)}catch(Q){console.log(Q)}});var w={id:"svgcontent",overflow:c.show_outside_canvas?"visible":"hidden"},B=false;if(m.attr("viewBox")){var L=m.attr("viewBox").split(" ");w.width=L[2];w.height=L[3]}else $.each(["width","height"],function(S,Q){var U=m.attr(Q);U||(U="100%");if(String(U).substr(-1)==="%")B=true;else w[Q]=svgedit.units.convertToNum(Q,U)});lb();m.children().find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=
Fa()});if(B){var G=getStrokedBBox();w.width=G.width+G.x;w.height=G.height+G.y}if(w.width<=0)w.width=100;if(w.height<=0)w.height=100;m.attr(w);this.contentW=w.width;this.contentH=w.height;d.addSubCommand(new svgedit.history.InsertElementCommand(v));var E=m.attr(["width","height"]);d.addSubCommand(new svgedit.history.ChangeElementCommand(r,E));s=1;svgedit.transformlist.resetListMap();Ca();svgedit.path.clearData();r.appendChild(Z.selectorParentGroup);sa(d);na("changed",[v])}catch(X){console.log(X);return false}return true};
this.importAtlasSvgString=function(b){try{b=b.replace(/(<(\?)xml.+(\?)>)|(<!--.*--\>)/gi,"");var f=svgedit.utilities.text2xml(b);this.prepareSvg(f);var d=h.importNode(f.documentElement,true);Ib(d);var o=svgedit.units.convertToNum("width",d.getAttribute("width")),n=svgedit.units.convertToNum("height",d.getAttribute("height"));svgCanvas.setResolution(o,n);for(var m=d.firstChild;m.firstChild;){var u=m.firstChild;u.id=Fa();var w=svgEditor.curConfig.initFloor,B=svgEditor.curConfig.initShop,L=svgEditor.curConfig.initDisable,
G=B.fill,E=B.stroke,X=B.stroke_width;if(u.getAttribute("class").indexOf("not-accessible")>=0){G=L.fill;E=L.stroke}if(u.getAttribute("class").indexOf("floor")>=0){G=w.fill;E=w.stroke;u.getAttribute("fill-opacity")||u.setAttribute("fill-opacity",w.fill_opacity);X=w.stroke_width}u.getAttribute("fill")||u.setAttribute("fill",G);u.getAttribute("stroke")||u.setAttribute("stroke",E);u.getAttribute("stroke-width")||u.setAttribute("stroke-width",X);C().getCurrentLayer().appendChild(m.firstChild)}Ca();na("changed",
[v])}catch(S){console.log(S);return false}return true};this.importSvgString=function(b){var f,d;try{var o=svgedit.utilities.encode64(b.length+b).substr(0,32),n=false;if(ob[o])if($(ob[o].symbol).parents("#svgroot").length)n=true;var m=new svgedit.history.BatchCommand("Import SVG"),u;if(n){u=ob[o].symbol;d=ob[o].xform}else{var w=svgedit.utilities.text2xml(b);this.prepareSvg(w);var B;B=h.adoptNode?h.adoptNode(w.documentElement):h.importNode(w.documentElement,true);Ib(B);var L=svgedit.units.convertToNum("width",
B.getAttribute("width")),G=svgedit.units.convertToNum("height",B.getAttribute("height")),E=B.getAttribute("viewBox"),X=E?E.split(" "):[0,0,L,G];for(f=0;f<4;++f)X[f]=+X[f];v.getAttribute("width");var S=+v.getAttribute("height");d=G>L?"scale("+S/3/X[3]+")":"scale("+S/3/X[2]+")";d="translate(0) "+d+" translate(0)";u=h.createElementNS(i.SVG,"symbol");var Q=svgedit.utilities.findDefs();for(svgedit.browser.isGecko()&&$(B).find("linearGradient, radialGradient, pattern").appendTo(Q);B.firstChild;)u.appendChild(B.firstChild);
var U=B.attributes,ca;for(ca=0;ca<U.length;ca++){var V=U[ca];u.setAttribute(V.nodeName,V.nodeValue)}u.id=Fa();ob[o]={symbol:u,xform:d};svgedit.utilities.findDefs().appendChild(u);m.addSubCommand(new svgedit.history.InsertElementCommand(u))}var M=h.createElementNS(i.SVG,"use");M.id=Fa();Ba(M,"#"+u.id);(q||C().getCurrentLayer()).appendChild(M);m.addSubCommand(new svgedit.history.InsertElementCommand(M));Ca();M.setAttribute("transform",d);svgedit.recalculate.recalculateDimensions(M);$(M).data("symbol",
u).data("ref",u);bb([M]);sa(m);na("changed",[v])}catch(K){console.log(K);return false}return true};var lb=e.identifyLayers=function(){Sb();C().identifyLayers()};this.createLayer=function(b){var f=new svgedit.history.BatchCommand("Create Layer");b=C().createLayer(b);f.addSubCommand(new svgedit.history.InsertElementCommand(b));sa(f);Ca();na("changed",[b])};this.cloneLayer=function(b){var f=new svgedit.history.BatchCommand("Duplicate Layer"),d=h.createElementNS(i.SVG,"g"),o=h.createElementNS(i.SVG,"title");
o.textContent=b;d.appendChild(o);o=C().getCurrentLayer();$(o).after(d);o=o.childNodes;var n;for(n=0;n<o.length;n++){var m=o[n];m.localName!="title"&&d.appendChild(Oa(m))}Ca();lb();f.addSubCommand(new svgedit.history.InsertElementCommand(d));sa(f);e.setCurrentLayer(b);na("changed",[d])};this.deleteCurrentLayer=function(){var b=C().getCurrentLayer(),f=b.nextSibling,d=b.parentNode;if(b=C().deleteCurrentLayer()){var o=new svgedit.history.BatchCommand("Delete Layer");o.addSubCommand(new svgedit.history.RemoveElementCommand(b,
f,d));sa(o);Ca();na("changed",[d]);return true}return false};this.setCurrentLayer=function(b){(b=C().setCurrentLayer(svgedit.utilities.toXml(b)))&&Ca();return b};this.renameCurrentLayer=function(b){var f,d=C();if(d.current_layer){var o=d.current_layer;if(!e.setCurrentLayer(b)){var n=new svgedit.history.BatchCommand("Rename Layer");for(f=0;f<d.getNumLayers();++f)if(d.all_layers[f][1]==o)break;var m=d.getLayerName(f);d.all_layers[f][0]=svgedit.utilities.toXml(b);var u=o.childNodes.length;for(f=0;f<
u;++f){var w=o.childNodes.item(f);if(w&&w.tagName=="title"){for(;w.firstChild;)w.removeChild(w.firstChild);w.textContent=b;n.addSubCommand(new svgedit.history.ChangeElementCommand(w,{"#text":m}));sa(n);na("changed",[o]);return true}}}d.current_layer=o}return false};this.setCurrentLayerPosition=function(b){var f,d=C();if(d.current_layer&&b>=0&&b<d.getNumLayers()){for(f=0;f<d.getNumLayers();++f)if(d.all_layers[f][1]==d.current_layer)break;if(f==d.getNumLayers())return false;if(f!=b){var o=null,n=d.current_layer.nextSibling;
if(b>f){if(b<d.getNumLayers()-1)o=d.all_layers[b+1][1]}else o=d.all_layers[b][1];v.insertBefore(d.current_layer,o);sa(new svgedit.history.MoveElementCommand(d.current_layer,n,v));lb();e.setCurrentLayer(d.getLayerName(b));return true}}return false};this.setLayerVisibility=function(b,f){var d=C(),o=d.getLayerVisibility(b),n=d.setLayerVisibility(b,f);if(n)sa(new svgedit.history.ChangeElementCommand(n,{display:o?"inline":"none"},"Layer Visibility"));else return false;if(n==d.getCurrentLayer()){Ca();ua.clear()}return true};
this.moveSelectedToLayer=function(b){var f,d=null,o=C();for(f=0;f<o.getNumLayers();++f)if(o.getLayerName(f)==b){d=o.all_layers[f][1];break}if(!d)return false;b=new svgedit.history.BatchCommand("Move Elements to Layer");o=j;for(f=o.length;f--;){var n=o[f];if(n){var m=n.nextSibling,u=n.parentNode;d.appendChild(n);b.addSubCommand(new svgedit.history.MoveElementCommand(n,m,u))}}sa(b);return true};this.mergeLayer=function(b){var f=new svgedit.history.BatchCommand("Merge Layer"),d=C(),o=$(d.current_layer).prev()[0];
if(o){for(f.addSubCommand(new svgedit.history.RemoveElementCommand(d.current_layer,d.current_layer.nextSibling,v));d.current_layer.firstChild;){var n=d.current_layer.firstChild;if(n.localName=="title"){f.addSubCommand(new svgedit.history.RemoveElementCommand(n,n.nextSibling,d.current_layer));d.current_layer.removeChild(n)}else{var m=n.nextSibling;o.appendChild(n);f.addSubCommand(new svgedit.history.MoveElementCommand(n,m,d.current_layer))}}v.removeChild(d.current_layer);if(!b){Ca();lb();na("changed",
[v]);sa(f)}d.current_layer=o;return f}};this.mergeAllLayers=function(){var b=new svgedit.history.BatchCommand("Merge all Layers"),f=C();for(f.current_layer=f.all_layers[f.getNumLayers()-1][1];$(v).children("g").length>1;)b.addSubCommand(e.mergeLayer(true));Ca();lb();na("changed",[v]);sa(b)};var Sb=this.leaveContext=function(){var b,f=db.length;if(f){for(b=0;b<f;b++){var d=db[b],o=tb(d,"orig_opac");o!==1?d.setAttribute("opacity",o):d.removeAttribute("opacity");d.setAttribute("style","pointer-events: inherit")}db=
[];Ca(true);na("contextset",null)}q=null},hc=this.setContext=function(b){Sb();if(typeof b==="string")b=svgedit.utilities.getElem(b);q=b;$(b).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var f=this.getAttribute("opacity")||1;tb(this,"orig_opac",f);this.setAttribute("opacity",f*0.33);this.setAttribute("style","pointer-events: none");db.push(this)});Ca();na("contextset",q)};this.clear=function(){ua.clear();Ca();e.clearSvgContentElement();e.current_drawing_=new svgedit.draw.Drawing(v);
e.createLayer("Layer 1");e.undoMgr.resetUndoStack();Z.initGroup();qa=Z.getRubberBandBox();na("cleared")};this.linkControlPoints=ua.linkControlPoints;this.getContentElem=function(){return v};this.getRootElem=function(){return r};this.getSelectedElems=function(){return j};var yb=this.getResolution=function(){var b=v.getAttribute("width")/s,f=v.getAttribute("height")/s;return{w:b,h:f,zoom:s}};this.getZoom=function(){return s};this.getVersion=function(){return"svgcanvas.js ($Rev: 2705 $)"};this.setUiStrings=
function(b){$.extend(nb,b.notification)};this.setConfig=function(b){$.extend(c,b)};this.getTitle=function(b){if(b=b||j[0]){b=$(b).data("gsvg")||$(b).data("symbol")||b;var f=b.childNodes;for(b=0;b<f.length;b++)if(f[b].nodeName=="title")return f[b].textContent;return""}};this.setGroupTitle=function(b){var f=j[0];f=$(f).data("gsvg")||f;var d=$(f).children("title"),o=new svgedit.history.BatchCommand("Set Label");if(b.length)if(d.length){d=d[0];o.addSubCommand(new svgedit.history.ChangeElementCommand(d,
{"#text":d.textContent}));d.textContent=b}else{d=h.createElementNS(i.SVG,"title");d.textContent=b;$(f).prepend(d);o.addSubCommand(new svgedit.history.InsertElementCommand(d))}else{o.addSubCommand(new svgedit.history.RemoveElementCommand(d[0],d.nextSibling,f));d.remove()}sa(o)};this.getDocumentTitle=function(){return e.getTitle(v)};this.setDocumentTitle=function(b){var f,d=v.childNodes,o=false,n="",m=new svgedit.history.BatchCommand("Change Image Title");for(f=0;f<d.length;f++)if(d[f].nodeName=="title"){o=
d[f];n=o.textContent;break}if(!o){o=h.createElementNS(i.SVG,"title");v.insertBefore(o,v.firstChild)}if(b.length)o.textContent=b;else o.parentNode.removeChild(o);m.addSubCommand(new svgedit.history.ChangeElementCommand(o,{"#text":n}));sa(m)};this.getEditorNS=function(b){b&&v.setAttribute("xmlns:se",i.SE);return i.SE};this.setResolution=function(b,f,d){var o=yb(),n=o.w;o=o.h;var m;if(d){v.setAttribute("width",b);v.setAttribute("height",f);console.log("-- injected --");return false}if(b=="fit"){var u=
getStrokedBBox();if(u){m=new svgedit.history.BatchCommand("Fit Canvas to Content");b=Ob();bb(b);var w=[],B=[];$.each(b,function(){w.push(u.x*-1);B.push(u.y*-1)});b=e.moveSelectedElements(w,B,true);m.addSubCommand(b);Ca();b=Math.round(u.width);f=Math.round(u.height)}else return false}if(b!=n||f!=o){d=r.suspendRedraw(1E3);m||(m=new svgedit.history.BatchCommand("Change Image Dimensions"));b=svgedit.units.convertToNum("width",b);f=svgedit.units.convertToNum("height",f);v.setAttribute("width",b);v.setAttribute("height",
f);this.contentW=b;this.contentH=f;m.addSubCommand(new svgedit.history.ChangeElementCommand(v,{width:n,height:o}));v.setAttribute("viewBox",[0,0,b/s,f/s].join(" "));m.addSubCommand(new svgedit.history.ChangeElementCommand(v,{viewBox:["0 0",n,o].join(" ")}));sa(m);r.unsuspendRedraw(d);na("changed",[v])}return true};this.getOffset=function(){return $(v).attr(["x","y"])};this.setBBoxZoom=function(b,f,d){var o=0.85,n=function(m){if(!m)return false;var u=Math.min(Math.round(f/m.width*100*o)/100,Math.round(d/
m.height*100*o)/100);e.setZoom(u);return{zoom:u,bbox:m}};if(typeof b=="object"){b=b;if(b.width==0||b.height==0){e.setZoom(b.zoom?b.zoom:s*b.factor);return{zoom:s,bbox:b}}return n(b)}switch(b){case "selection":if(!j[0])return;b=$.map(j,function(m){if(m)return m});b=getStrokedBBox(b);break;case "canvas":b=yb();o=0.95;b={width:b.w,height:b.h,x:0,y:0};break;case "content":b=getStrokedBBox();break;case "layer":b=getStrokedBBox(Ob(C().getCurrentLayer()));break;default:return}return n(b)};this.setZoom=function(b){var f=
yb();v.setAttribute("viewBox","0 0 "+f.w/b+" "+f.h/b);s=b;$.each(j,function(d,o){o&&Z.requestSelector(o).resize()});ua.zoomChange();Qa("zoomChanged",b)};this.getMode=function(){return wa};this.setMode=function(b){ua.clear(true);La.clear();Na=j[0]&&j[0].nodeName=="text"?Xa:t;wa=b};this.getColor=function(b){return Na[b]};this.setColor=function(b,f,d){function o(w){w.nodeName!="g"&&n.push(w)}t[b]=f;Na[b+"_paint"]={type:"solidColor"};for(var n=[],m=j.length;m--;){var u=j[m];if(u)if(u.tagName=="g")svgedit.utilities.walkTree(u,
o);else if(b=="fill")u.tagName!="polyline"&&u.tagName!="line"&&n.push(u);else n.push(u)}if(n.length>0)if(d)zb(b,f,n);else{Ma(b,f,n);na("changed",n)}};var bc=this.setGradient=function(b){if(!(!Na[b+"_paint"]||Na[b+"_paint"].type=="solidColor")){var f=e[b+"Grad"],d=ac(f),o=svgedit.utilities.findDefs();if(d)f=d;else{f=o.appendChild(h.importNode(f,true));f.id=Fa()}e.setColor(b,"url(#"+f.id+")")}},ac=function(b){var f=svgedit.utilities.findDefs();f=$(f).find("linearGradient, radialGradient");for(var d=
f.length,o=["r","cx","cy","fx","fy"];d--;){var n=f[d];if(b.tagName=="linearGradient"){if(b.getAttribute("x1")!=n.getAttribute("x1")||b.getAttribute("y1")!=n.getAttribute("y1")||b.getAttribute("x2")!=n.getAttribute("x2")||b.getAttribute("y2")!=n.getAttribute("y2"))continue}else{var m=$(b).attr(o),u=$(n).attr(o),w=false;$.each(o,function(S,Q){if(m[Q]!=u[Q])w=true});if(w)continue}var B=b.getElementsByTagNameNS(i.SVG,"stop"),L=n.getElementsByTagNameNS(i.SVG,"stop");if(B.length==L.length){for(var G=B.length;G--;){var E=
B[G],X=L[G];if(E.getAttribute("offset")!=X.getAttribute("offset")||E.getAttribute("stop-opacity")!=X.getAttribute("stop-opacity")||E.getAttribute("stop-color")!=X.getAttribute("stop-color"))break}if(G==-1)return n}}return null};this.setPaint=function(b,f){var d=new $.jGraduate.Paint(f);this.setPaintOpacity(b,d.alpha/100,true);Na[b+"_paint"]=d;switch(d.type){case "solidColor":this.setColor(b,d.solidColor!="none"?"#"+d.solidColor:"none");break;case "linearGradient":case "radialGradient":e[b+"Grad"]=
d[d.type];bc(b)}};this.setStrokePaint=function(b){this.setPaint("stroke",b)};this.setFillPaint=function(b){this.setPaint("fill",b)};this.getStrokeWidth=function(){return Na.stroke_width};this.setStrokeWidth=function(b){function f(m){m.nodeName!="g"&&d.push(m)}if(b==0&&["line","path"].indexOf(wa)>=0)e.setStrokeWidth(1);else{Na.stroke_width=b;for(var d=[],o=j.length;o--;){var n=j[o];if(n)n.tagName=="g"?svgedit.utilities.walkTree(n,f):d.push(n)}if(d.length>0){Ma("stroke-width",b,d);na("changed",j)}}};
this.setStrokeAttr=function(b,f){t[b.replace("-","_")]=f;for(var d=[],o=j.length;o--;){var n=j[o];if(n)n.tagName=="g"?svgedit.utilities.walkTree(n,function(m){m.nodeName!="g"&&d.push(m)}):d.push(n)}if(d.length>0){Ma(b,f,d);na("changed",j)}};this.getStyle=function(){return t};this.getOpacity=function(){return t.opacity};this.setOpacity=function(b){t.opacity=b;Ma("opacity",b)};this.getFillOpacity=function(){return t.fill_opacity};this.getStrokeOpacity=function(){return t.stroke_opacity};this.setPaintOpacity=
function(b,f,d){t[b+"_opacity"]=f;d?zb(b+"-opacity",f):Ma(b+"-opacity",f)};this.getPaintOpacity=function(b){return b==="fill"?this.getFillOpacity():this.getStrokeOpacity()};this.getBlur=function(b){var f=0;if(b)if(b.getAttribute("filter"))if(b=svgedit.utilities.getElem(b.id+"_blur"))f=b.firstChild.getAttribute("stdDeviation");return f};(function(){function b(){var n=e.undoMgr.finishUndoableChange();f.addSubCommand(n);sa(f);d=f=null}var f=null,d=null,o=false;e.setBlurNoUndo=function(n){if(d)if(n===
0){zb("filter","");o=true}else{var m=j[0];o&&zb("filter","url(#"+m.id+"_blur)");if(svgedit.browser.isWebkit()){console.log("e",m);m.removeAttribute("filter");m.setAttribute("filter","url(#"+m.id+"_blur)")}zb("stdDeviation",n,[d.firstChild]);e.setBlurOffsets(d,n)}else e.setBlur(n)};e.setBlurOffsets=function(n,m){if(m>3)svgedit.utilities.assignAttributes(n,{x:"-50%",y:"-50%",width:"200%",height:"200%"},100);else if(!svgedit.browser.isWebkit()){n.removeAttribute("x");n.removeAttribute("y");n.removeAttribute("width");
n.removeAttribute("height")}};e.setBlur=function(n,m){if(f)b();else{var u=j[0],w=u.id;d=svgedit.utilities.getElem(w+"_blur");n-=0;var B=new svgedit.history.BatchCommand;if(d){if(n===0)d=null}else{var L=I({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:n}});d=I({element:"filter",attr:{id:w+"_blur"}});d.appendChild(L);svgedit.utilities.findDefs().appendChild(d);B.addSubCommand(new svgedit.history.InsertElementCommand(d))}L={filter:u.getAttribute("filter")};if(n===0){u.removeAttribute("filter");
B.addSubCommand(new svgedit.history.ChangeElementCommand(u,L))}else{Ma("filter","url(#"+w+"_blur)");B.addSubCommand(new svgedit.history.ChangeElementCommand(u,L));e.setBlurOffsets(d,n);f=B;e.undoMgr.beginUndoableChange("stdDeviation",[d?d.firstChild:null]);if(m){e.setBlurNoUndo(n);b()}}}}})();this.getBold=function(){var b=j[0];if(b!=null&&b.tagName=="text"&&j[1]==null)return b.getAttribute("font-weight")=="bold";return false};this.setBold=function(b){var f=j[0];if(f!=null&&f.tagName=="text"&&j[1]==
null)Ma("font-weight",b?"bold":"normal");j[0].textContent||La.setCursor()};this.getItalic=function(){var b=j[0];if(b!=null&&b.tagName=="text"&&j[1]==null)return b.getAttribute("font-style")=="italic";return false};this.setItalic=function(b){var f=j[0];if(f!=null&&f.tagName=="text"&&j[1]==null)Ma("font-style",b?"italic":"normal");j[0].textContent||La.setCursor()};this.getFontFamily=function(){return Xa.font_family};this.setFontFamily=function(b){Xa.font_family=b;Ma("font-family",b);j[0]&&!j[0].textContent&&
La.setCursor()};this.setFontColor=function(b){Xa.fill=b;Ma("fill",b)};this.getFontColor=function(){return Xa.fill};this.getFontSize=function(){return Xa.font_size};this.setFontSize=function(b){Xa.font_size=b;Ma("font-size",b);j[0].textContent||La.setCursor()};this.getText=function(){var b=j[0];if(b==null)return"";return b.textContent};this.setTextContent=function(b){Ma("#text",b);La.init(b);La.setCursor()};this.setImageURL=function(b){var f=j[0];if(f){var d=$(f).attr(["width","height"]);d=!d.width||
!d.height;var o=Ia(f);if(o!==b)d=true;else if(!d)return;var n=new svgedit.history.BatchCommand("Change Image URL");Ba(f,b);n.addSubCommand(new svgedit.history.ChangeElementCommand(f,{"#href":o}));d?$(new Image).load(function(){var m=$(f).attr(["width","height"]);$(f).attr({width:this.width,height:this.height});Z.requestSelector(f).resize();n.addSubCommand(new svgedit.history.ChangeElementCommand(f,m));sa(n);na("changed",[f])}).attr("src",b):sa(n)}};this.setLinkURL=function(b){var f=j[0];if(f){if(f.tagName!==
"a"){f=$(f).parents("a");if(f.length)f=f[0];else return}var d=Ia(f);if(d!==b){var o=new svgedit.history.BatchCommand("Change Link URL");Ba(f,b);o.addSubCommand(new svgedit.history.ChangeElementCommand(f,{"#href":d}));sa(o)}}};this.setRectRadius=function(b){var f=j[0];if(f!=null&&f.tagName=="rect"){var d=f.getAttribute("rx");if(d!=b){f.setAttribute("rx",b);f.setAttribute("ry",b);sa(new svgedit.history.ChangeElementCommand(f,{rx:d,ry:d},"Radius"));na("changed",[f])}}};this.makeHyperlink=function(b){e.groupSelectedElements("a",
b)};this.removeHyperlink=function(){e.ungroupSelectedElement()};this.setSegType=function(b){ua.setSegType(b)};this.convertToPath=function(b,f){if(b==null)$.each(j,function(V,M){M&&e.convertToPath(M)});else{if(!f)var d=new svgedit.history.BatchCommand("Convert element to Path");var o=f?{}:{fill:t.fill,"fill-opacity":t.fill_opacity,stroke:t.stroke,"stroke-width":t.stroke_width,"stroke-dasharray":t.stroke_dasharray,"stroke-linejoin":t.stroke_linejoin,"stroke-linecap":t.stroke_linecap,"stroke-opacity":t.stroke_opacity,
opacity:t.opacity,visibility:"hidden"};$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){if(b.getAttribute(this))o[this]=b.getAttribute(this)});var n=I({element:"path",attr:o}),m=b.getAttribute("transform");m&&n.setAttribute("transform",m);var u=b.id,w=b.parentNode;b.nextSibling?w.insertBefore(n,b):w.appendChild(n);var B="",L=function(V){$.each(V,function(M,K){var N,P=K[1];B+=K[0];for(N=0;N<P.length;N+=2)B+=P[N]+","+P[N+1]+" "})},G=1.81,E,X;switch(b.tagName){case "ellipse":case "circle":E=
$(b).attr(["rx","ry","cx","cy"]);var S=E.cx,Q=E.cy;X=E.rx;ry=E.ry;if(b.tagName=="circle")X=ry=$(b).attr("r");L([["M",[S-X,Q]],["C",[S-X,Q-ry/G,S-X/G,Q-ry,S,Q-ry]],["C",[S+X/G,Q-ry,S+X,Q-ry/G,S+X,Q]],["C",[S+X,Q+ry/G,S+X/G,Q+ry,S,Q+ry]],["C",[S-X/G,Q+ry,S-X,Q+ry/G,S-X,Q]],["Z",[]]]);break;case "path":B=b.getAttribute("d");break;case "line":E=$(b).attr(["x1","y1","x2","y2"]);B="M"+E.x1+","+E.y1+"L"+E.x2+","+E.y2;break;case "polyline":case "polygon":B="M"+b.getAttribute("points");break;case "rect":E=
$(b).attr(["rx","ry"]);X=E.rx;ry=E.ry;var U=b.getBBox();E=U.x;S=U.y;Q=U.width;U=U.height;G=4-G;!X&&!ry?L([["M",[E,S]],["L",[E+Q,S]],["L",[E+Q,S+U]],["L",[E,S+U]],["L",[E,S]],["Z",[]]]):L([["M",[E,S+ry]],["C",[E,S+ry/G,E+X/G,S,E+X,S]],["L",[E+Q-X,S]],["C",[E+Q-X/G,S,E+Q,S+ry/G,E+Q,S+ry]],["L",[E+Q,S+U-ry]],["C",[E+Q,S+U-ry/G,E+Q-X/G,S+U,E+Q-X,S+U]],["L",[E+X,S+U]],["C",[E+X/G,S+U,E,S+U-ry/G,E,S+U-ry]],["L",[E,S+ry]],["Z",[]]]);break;default:n.parentNode.removeChild(n)}B&&n.setAttribute("d",B);if(f){ua.resetOrientation(n);
d=false;try{d=n.getBBox()}catch(ca){console.log("firefox fails ?")}n.parentNode.removeChild(n);return d}else{if(m){m=svgedit.transformlist.getTransformList(n);svgedit.math.hasMatrixTransform(m)&&ua.resetOrientation(n)}d.addSubCommand(new svgedit.history.RemoveElementCommand(b,b.nextSibling,w));d.addSubCommand(new svgedit.history.InsertElementCommand(n));Ca();b.parentNode.removeChild(b);n.setAttribute("id",u);n.removeAttribute("visibility");bb([n],true);sa(d)}}};var zb=function(b,f,d){var o=r.suspendRedraw(1E3);
wa=="pathedit"&&ua.moveNode(b,f);d=d||j;for(var n=d.length,m=["g","polyline","path"],u=["transform","opacity","filter"];n--;){var w=d[n];if(w!=null)if((b==="x"||b==="y")&&m.indexOf(w.tagName)>=0){var B=getStrokedBBox([w]);e.moveSelectedElements((b==="x"?f-B.x:0)*s,(b==="y"?f-B.y:0)*s,true)}else{w.tagName==="g"&&u.indexOf(b);B=b==="#text"?w.textContent:w.getAttribute(b);if(B==null)B="";if(B!==String(f)){if(b=="#text"){svgedit.utilities.getBBox(w);w.textContent=f;if(/rotate/.test(w.getAttribute("transform")))w=
Qb(w)}else b=="#href"?Ba(w,f):w.setAttribute(b,f);wa==="textedit"&&b!=="#text"&&w.textContent.length&&La.toSelectMode(w);if(svgedit.browser.isGecko()&&w.nodeName==="text"&&/rotate/.test(w.getAttribute("transform")))if(String(f).indexOf("url")===0||["font-size","font-family","x","y"].indexOf(b)>=0&&w.textContent)w=Qb(w);j.indexOf(w)>=0&&setTimeout(function(){w.parentNode&&Z.requestSelector(w).resize()},0);B=svgedit.utilities.getRotationAngle(w);if(B!=0&&b!="transform")for(var L=svgedit.transformlist.getTransformList(w),
G=L.numberOfItems;G--;)if(L.getItem(G).type==4){L.removeItem(G);var E=svgedit.utilities.getBBox(w),X=svgedit.math.transformPoint(E.x+E.width/2,E.y+E.height/2,svgedit.math.transformListToTransform(L).matrix);E=X.x;X=X.y;var S=r.createSVGTransform();S.setRotate(B,E,X);L.insertItemBefore(S,G);break}}}}r.unsuspendRedraw(o)},Ma=this.changeSelectedAttribute=function(b,f,d){d=d||j;e.undoMgr.beginUndoableChange(b,d);zb(b,f,d);b=e.undoMgr.finishUndoableChange();b.isEmpty()||sa(b)};this.deleteSelectedElements=
function(){var b,f=new svgedit.history.BatchCommand("Delete Elements"),d=j.length,o=[];for(b=0;b<d;++b){var n=j[b];if(n==null)break;var m=n.parentNode,u=n;Z.releaseSelector(u);svgedit.path.removePath_(u.id);if(m.tagName==="a"&&m.childNodes.length===1){u=m;m=m.parentNode}var w=u.nextSibling;u=m.removeChild(u);o.push(n);j[b]=null;f.addSubCommand(new Va(u,w,m))}f.isEmpty()||sa(f);na("changed",o);Ca()};this.cutSelectedElements=function(){var b,f=new svgedit.history.BatchCommand("Cut Elements"),d=j.length,
o=[];for(b=0;b<d;++b){var n=j[b];if(n==null)break;var m=n.parentNode,u=n;Z.releaseSelector(u);svgedit.path.removePath_(u.id);var w=u.nextSibling;u=m.removeChild(u);o.push(n);j[b]=null;f.addSubCommand(new Va(u,w,m))}f.isEmpty()||sa(f);na("changed",o);Ca();e.clipBoard=o};this.copySelectedElements=function(){e.clipBoard=$.merge([],j)};this.pasteElements=function(b,f,d){var o=e.clipBoard,n=o.length;if(n){for(var m=[],u=new svgedit.history.BatchCommand("Paste elements");n--;){var w=o[n];if(w){var B=Oa(w);
if(!svgedit.utilities.getElem(w.id))B.id=w.id;m.push(B);(q||C().getCurrentLayer()).appendChild(B);u.addSubCommand(new svgedit.history.InsertElementCommand(B))}}cb(m);if(b!=="in_place"){var L,G;if(b){if(b==="point"){L=f;G=d}}else{L=Vb.x;G=Vb.y}b=getStrokedBBox(m);var E=L-(b.x+b.width/2),X=G-(b.y+b.height/2),S=[],Q=[];$.each(m,function(){S.push(E);Q.push(X)});L=e.moveSelectedElements(S,Q,false);u.addSubCommand(L)}sa(u);na("changed",m)}};this.groupSelectedElements=function(b,f){b||(b="g");var d="";switch(b){case "a":d=
"Make hyperlink";var o="";if(arguments.length>1)o=f;break;default:b="g";d="Group Elements"}d=new svgedit.history.BatchCommand(d);var n=I({element:b,attr:{id:Fa()}});b==="a"&&Ba(n,o);d.addSubCommand(new svgedit.history.InsertElementCommand(n));for(o=j.length;o--;){var m=j[o];if(m!=null){if(m.parentNode.tagName==="a"&&m.parentNode.childNodes.length===1)m=m.parentNode;var u=m.nextSibling,w=m.parentNode;n.appendChild(m);d.addSubCommand(new svgedit.history.MoveElementCommand(m,u,w))}}d.isEmpty()||sa(d);
cb([n],true)};var Xb=this.pushGroupProperties=function(b,f){var d=b.childNodes,o=d.length,n=b.getAttribute("transform"),m=svgedit.transformlist.getTransformList(b),u=svgedit.math.transformListToTransform(m).matrix,w=new svgedit.history.BatchCommand("Push group properties"),B=0,L=svgedit.utilities.getRotationAngle(b),G=$(b).attr(["filter","opacity"]),E,X,S;for(B=0;B<o;B++){var Q=d[B];if(Q.nodeType===1){if(G.opacity!==null&&G.opacity!==1){Q.getAttribute("opacity");var U=Math.round((Q.getAttribute("opacity")||
1)*G.opacity*100)/100;Ma("opacity",U,[Q])}if(G.filter){S=U=this.getBlur(Q);X||(X=this.getBlur(b));if(U)U=Number(X)+Number(U);else if(U===0)U=X;if(S)E=svgedit.utilities.getRefElem(Q.getAttribute("filter"));else if(E){E=Oa(E);svgedit.utilities.findDefs().appendChild(E)}else E=svgedit.utilities.getRefElem(G.filter);E.id=Q.id+"_"+(E.firstChild.tagName==="feGaussianBlur"?"blur":"filter");Ma("filter","url(#"+E.id+")",[Q]);if(U){Ma("stdDeviation",U,[E.firstChild]);e.setBlurOffsets(E,U)}}U=svgedit.transformlist.getTransformList(Q);
if(~Q.tagName.indexOf("Gradient"))U=null;if(U)if(Q.tagName!=="defs")if(m.numberOfItems){if(L&&m.numberOfItems==1){var ca=m.getItem(0).matrix,V=r.createSVGMatrix();if(S=svgedit.utilities.getRotationAngle(Q))V=U.getItem(0).matrix;var M=svgedit.utilities.getBBox(Q),K=svgedit.math.transformListToTransform(U).matrix,N=svgedit.math.transformPoint(M.x+M.width/2,M.y+M.height/2,K);M=L+S;K=r.createSVGTransform();K.setRotate(M,N.x,N.y);ca=svgedit.math.matrixMultiply(ca,V,K.matrix.inverse());S&&U.removeItem(0);
if(M)U.numberOfItems?U.insertItemBefore(K,0):U.appendItem(K);if(ca.e||ca.f){S=r.createSVGTransform();S.setTranslate(ca.e,ca.f);U.numberOfItems?U.insertItemBefore(S,0):U.appendItem(S)}}else{ca=Q.getAttribute("transform");S={};S.transform=ca||"";S=r.createSVGTransform();ca=svgedit.math.transformListToTransform(U).matrix;V=ca.inverse();ca=svgedit.math.matrixMultiply(V,u,ca);S.setMatrix(ca);U.appendItem(S)}(Q=svgedit.recalculate.recalculateDimensions(Q))&&w.addSubCommand(Q)}}}if(n){S={};S.transform=n;
b.setAttribute("transform","");b.removeAttribute("transform");w.addSubCommand(new svgedit.history.ChangeElementCommand(b,S))}if(f&&!w.isEmpty())return w};this.ungroupSelectedElement=function(){var b=j[0];if($(b).data("gsvg")||$(b).data("symbol"))Yb(b);else if(b.tagName&&b.tagName==="use"){var f=svgedit.utilities.getElem(Ia(b).substr(1));$(b).data("symbol",f).data("ref",f);Yb(b)}else{f=$(b).parents("a");if(f.length)b=f[0];if(b.tagName==="g"||b.tagName==="a"){f=new svgedit.history.BatchCommand("Ungroup Elements");
var d=Xb(b,true);d&&f.addSubCommand(d);d=b.parentNode;for(var o=b.nextSibling,n=Array(b.childNodes.length),m=0;b.firstChild;){var u=b.firstChild,w=u.nextSibling,B=u.parentNode;if(u.tagName==="title"){f.addSubCommand(new svgedit.history.RemoveElementCommand(u,u.nextSibling,B));B.removeChild(u)}else{n[m++]=u=d.insertBefore(u,o);f.addSubCommand(new svgedit.history.MoveElementCommand(u,w,B))}}Ca();o=b.nextSibling;b=d.removeChild(b);f.addSubCommand(new svgedit.history.RemoveElementCommand(b,o,d));f.isEmpty()||
sa(f);bb(n)}}};this.moveToTopSelectedElement=function(){var b=j[0];if(b!=null){b=b;var f=b.parentNode,d=b.nextSibling;b=b.parentNode.appendChild(b);if(d!=b.nextSibling){sa(new svgedit.history.MoveElementCommand(b,d,f,"top"));na("changed",[b])}}};this.moveToBottomSelectedElement=function(){var b=j[0];if(b!=null){b=b;var f=b.parentNode,d=b.nextSibling,o=b.parentNode.firstChild;if(o.tagName=="title")o=o.nextSibling;if(o.tagName=="defs")o=o.nextSibling;b=b.parentNode.insertBefore(b,o);if(d!=b.nextSibling){sa(new svgedit.history.MoveElementCommand(b,
d,f,"bottom"));na("changed",[b])}}};this.moveUpDownSelected=function(b){var f=j[0];if(f){kb=[];var d,o,n=$(Eb(getStrokedBBox([f]))).toArray();b=="Down"&&n.reverse();$.each(n,function(){if(o){d=this;return false}else if(this==f)o=true});if(d){n=f.parentNode;var m=f.nextSibling;$(d)[b=="Down"?"before":"after"](f);if(m!=f.nextSibling){sa(new svgedit.history.MoveElementCommand(f,m,n,"Move "+b));na("changed",[f])}}}};this.moveSelectedElements=function(b,f,d){if(b.constructor!=Array){b/=s;f/=s}d=d||true;
for(var o=new svgedit.history.BatchCommand("position"),n=j.length;n--;){var m=j[n];if(m!=null){var u=r.createSVGTransform(),w=svgedit.transformlist.getTransformList(m);b.constructor==Array?u.setTranslate(b[n],f[n]):u.setTranslate(b,f);w.numberOfItems?w.insertItemBefore(u,0):w.appendItem(u);(u=svgedit.recalculate.recalculateDimensions(m))&&o.addSubCommand(u);Z.requestSelector(m).resize()}}if(!o.isEmpty()){d&&sa(o);na("changed",j);return o}};this.cloneSelectedElements=function(b,f){var d,o,n=new svgedit.history.BatchCommand("Clone Elements"),
m=j.length;j.sort(function(u,w){return $(w).index()-$(u).index()});for(d=0;d<m;++d){o=j[d];if(o==null)break}m=j.slice(0,d);this.clearSelection(true);for(d=m.length;d--;){o=m[d]=Oa(m[d]);(q||C().getCurrentLayer()).appendChild(o);n.addSubCommand(new svgedit.history.InsertElementCommand(o))}if(!n.isEmpty()){bb(m.reverse());this.moveSelectedElements(b,f,false);sa(n)}};this.alignSelectedElements=function(b,f){var d,o,n=[],m=Number.MAX_VALUE,u=Number.MIN_VALUE,w=Number.MAX_VALUE,B=Number.MIN_VALUE,L=Number.MIN_VALUE,
G=Number.MIN_VALUE,E=j.length;if(E){for(d=0;d<E;++d){if(j[d]==null)break;o=j[d];n[d]=getStrokedBBox([o]);switch(f){case "smallest":if((b=="l"||b=="c"||b=="r")&&(L==Number.MIN_VALUE||L>n[d].width)||(b=="t"||b=="m"||b=="b")&&(G==Number.MIN_VALUE||G>n[d].height)){m=n[d].x;w=n[d].y;u=n[d].x+n[d].width;B=n[d].y+n[d].height;L=n[d].width;G=n[d].height}break;case "largest":if((b=="l"||b=="c"||b=="r")&&(L==Number.MIN_VALUE||L<n[d].width)||(b=="t"||b=="m"||b=="b")&&(G==Number.MIN_VALUE||G<n[d].height)){m=n[d].x;
w=n[d].y;u=n[d].x+n[d].width;B=n[d].y+n[d].height;L=n[d].width;G=n[d].height}break;default:if(n[d].x<m)m=n[d].x;if(n[d].y<w)w=n[d].y;if(n[d].x+n[d].width>u)u=n[d].x+n[d].width;if(n[d].y+n[d].height>B)B=n[d].y+n[d].height}}if(f=="page"){w=m=0;u=e.contentW;B=e.contentH}o=Array(E);L=Array(E);for(d=0;d<E;++d){if(j[d]==null)break;G=n[d];o[d]=0;L[d]=0;switch(b){case "l":o[d]=m-G.x;break;case "c":o[d]=(m+u)/2-(G.x+G.width/2);break;case "r":o[d]=u-(G.x+G.width);break;case "t":L[d]=w-G.y;break;case "m":L[d]=
(w+B)/2-(G.y+G.height/2);break;case "b":L[d]=B-(G.y+G.height)}}this.moveSelectedElements(o,L)}};this.contentW=yb().w;this.contentH=yb().h;this.updateCanvas=function(b,f){r.setAttribute("width",b);r.setAttribute("height",f);var d=$("#canvasBackground")[0],o=v.getAttribute("x"),n=v.getAttribute("y"),m=b/2-this.contentW*s/2,u=f/2-this.contentH*s/2;svgedit.utilities.assignAttributes(v,{width:this.contentW*s,height:this.contentH*s,x:m,y:u,viewBox:"0 0 "+this.contentW+" "+this.contentH});svgedit.utilities.assignAttributes(d,
{width:v.getAttribute("width"),height:v.getAttribute("height"),x:m,y:u});(d=svgedit.utilities.getElem("background_image"))&&svgedit.utilities.assignAttributes(d,{width:"100%",height:"100%"});Z.selectorParentGroup.setAttribute("transform","translate("+m+","+u+")");Qa("canvasUpdated",{new_x:m,new_y:u,old_x:o,old_y:n,d_x:m-o,d_y:u-n});return{x:m,y:u,old_x:o,old_y:n,d_x:m-o,d_y:u-n}};this.setBackground=function(b,f){var d=svgedit.utilities.getElem("canvasBackground"),o=$(d).find("rect")[0],n=svgedit.utilities.getElem("background_image");
o.setAttribute("fill",b);if(f){if(!n){n=h.createElementNS(i.SVG,"image");svgedit.utilities.assignAttributes(n,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})}Ba(n,f);d.appendChild(n)}else n&&n.parentNode.removeChild(n)};this.setAtlasBackground=function(b,f){var d=svgedit.utilities.getElem("canvasBackground"),o=$(d).find("rect")[0],n=svgedit.utilities.getElem("background_image");o.setAttribute("fill",b);n&&n.parentNode.removeChild(n);n=
h.createElementNS(i.SVG,"image");svgedit.utilities.assignAttributes(n,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"});Ba(n,f.src);d.appendChild(n);this.zoomChanged(window,"canvas")};this.cycleElement=function(b){var f=j[0],d=false,o=Ob(q||C().getCurrentLayer());if(o.length){if(f==null){b=b?o.length-1:0;d=o[b]}else for(var n=o.length;n--;)if(o[n]==f){b=b?n-1:n+1;if(b>=o.length)b=0;else if(b<0)b=o.length-1;d=o[b];break}cb([d],true);na("selected",
j)}};this.clear();this.getPrivateMethods=function(){return{addCommandToHistory:sa,setGradient:bc,addSvgElementFromJson:I,assignAttributes:mb,BatchCommand:jb,call:na,ChangeElementCommand:$a,copyElem:Oa,ffClone:Qb,findDefs:fa,findDuplicateGradient:ac,getElem:Bb,getId:ab,getIntersectionList:Eb,getMouseTarget:qb,getNextId:Fa,getPathBBox:Ab,getUrlFromAttr:ka,hasMatrixTransform:oa,identifyLayers:lb,InsertElementCommand:rb,isIdentity:svgedit.math.isIdentity,logMatrix:Wb,matrixMultiply:aa,MoveElementCommand:Cb,
preventClickDefault:Pb,recalculateAllSelectedDimensions:wb,recalculateDimensions:Zb,remapElement:ya,RemoveElementCommand:Va,removeUnusedDefElems:xb,round:pb,runExtensions:Qa,sanitizeSvg:Kb,SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,transformBox:svgedit.math.transformBox,transformListToTransform:ea,transformPoint:T,walkTree:svgedit.utilities.walkTree}}};(function(){if(!window.svgEditor){window.svgEditor=function(a){function J(j,I){var T=c.setSvgString(j)!==false;I=I||a.noop;T?I(true):a.alert(t.notification.errorLoadingSVG,function(){I(false)})}function A(j,I){var T=c.importAtlasSvgString(j)!==false;I=I||a.noop;T?I(true):a.alert(t.notification.errorLoadingSVG,function(){I(false)})}var i={};i.tool_scale=1;i.langChanged=false;i.showSaveWarning=false;i.storagePromptClosed=false;var c,p,e=svgedit.utilities,h=false,r=[],v={},D={lang:"",iconsize:"",bkgd_color:"#FFF",
bkgd_url:"",img_save:"embed",save_notice_done:false,export_notice_done:false},C={},s={extensions:[],allowedOrigins:[]},q=["ext-overview_window.js","ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-imagelib.js","ext-grid.js","ext-polygon.js","ext-star.js","ext-panning.js","ext-storage.js"],z={canvasName:"default",canvas_expansion:3,initFill:{color:"FF0000",opacity:1},initStroke:{width:5,color:"000000",opacity:1},initOpacity:1,colorPickerCSS:null,initTool:"select",wireframe:false,
showlayers:false,no_save_warning:false,imgPath:"images/",langPath:"locale/",extPath:"extensions/",jGraduatePath:"jgraduate/images/",dimensions:[640,480],gridSnapping:false,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:true,preventAllURLConfig:false,preventURLContentLoading:false,lockExtensions:false,noDefaultExtensions:false,showGrid:false,noStorageOnLoad:false,forceStorage:false,emptyStorageOnDecline:false,pid:null,initShop:null,initFloor:null,initDisable:null},t=i.uiStrings={common:{ok:"OK",
cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:"Move selected elements to layer '%s'?",QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",
QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",
saveFromBrowser:"Select 'Save As...' in your browser to save this image as a %s file.",noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:"Retrieving '%s' ...",elemImport:"Do you want to import a new SVG?\nThis will clear everything!"}};a.pref=function(j,I){if(I){C[j]=I;i.curPrefs=C}else return j in C?C[j]:D[j]};
i.loadContentAndPrefs=function(){if(!(!s.forceStorage&&(s.noStorageOnLoad||!document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)))){if(i.storage&&(s.forceStorage||!s.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=prefsAndContent/))){var j=i.storage.getItem("svgedit-"+s.canvasName);j&&i.loadFromString(j)}for(var I in D)if(D.hasOwnProperty(I)){j="svg-edit-"+I;if(i.storage){if(j=i.storage.getItem(j))D[I]=String(j)}else if(window.widget)D[I]=widget.preferenceForKey(j);else{j=
document.cookie.match(RegExp("(?:^|;\\s*)"+e.preg_quote(encodeURIComponent(j))+"=([^;]+)"));D[I]=j?decodeURIComponent(j[1]):""}}}};i.setConfig=function(j,I){function T(aa,oa,ea){if(aa[oa]&&typeof aa[oa]==="object")a.extend(true,aa[oa],ea);else aa[oa]=ea}I=I||{};a.each(j,function(aa,oa){if(j.hasOwnProperty(aa))if(D.hasOwnProperty(aa)){if(!(I.overwrite===false&&(s.preventAllURLConfig||C.hasOwnProperty(aa))))if(I.allowInitialUserOverride===true)D[aa]=oa;else a.pref(aa,oa)}else if(["extensions","allowedOrigins"].indexOf(aa)>
-1)I.overwrite===false&&(s.preventAllURLConfig||aa==="allowedOrigins"||aa==="extensions"&&s.lockExtensions)||(s[aa]=s[aa].concat(oa));else if(z.hasOwnProperty(aa))if(!(I.overwrite===false&&(s.preventAllURLConfig||s.hasOwnProperty(aa))))if(s.hasOwnProperty(aa))I.overwrite!==false&&T(s,aa,oa);else if(I.allowInitialUserOverride===true)T(z,aa,oa);else if(z[aa]&&typeof z[aa]==="object"){s[aa]={};a.extend(true,s[aa],oa)}else s[aa]=oa});i.curConfig=s};i.setCustomHandlers=function(j){i.ready(function(){if(j.open){a('#tool_open > input[type="file"]').remove();
a("#tool_open").show();c.open=j.open}if(j.save){i.showSaveWarning=false;c.bind("saved",j.save)}if(j.exportImage||j.pngsave)c.bind("exported",j.exportImage||j.pngsave);v=j})};i.randomizeIds=function(){c.randomizeIds(arguments)};i.init=function(){function j(){s=a.extend(true,{},z,s);if(!s.noDefaultExtensions)s.extensions=s.extensions.concat(q);a.each(["extensions","allowedOrigins"],function(g,k){s[k]=a.grep(s[k],function(H,F){return F===s[k].indexOf(H)})});i.curConfig=s}function I(g,k){var H=g.id,F=
H.split("_"),O=F[0];F=F[1];k&&c.setStrokeAttr("stroke-"+O,F);ub();Ya("#cur_"+O,H,20);a(g).addClass("current").siblings().removeClass("current")}function T(g,k){a.pref("bkgd_color",g);a.pref("bkgd_url",k);c.setBackground(g,k)}function aa(){var g=c.getHref(la);g=g.indexOf("data:")===0?"":g;a.prompt(t.notification.enterNewImgURL,g,function(k){k&&Eb(k)})}function oa(g,k){k||(k=c.getZoom());g||(g=a("#svgcanvas"));var H,F,O=c.getContentElem(),R=svgedit.units.getTypeMap()[s.baseUnit];for(H=0;H<2;H++){var Y=
H===0,ga=Y?"x":"y",ja=Y?"width":"height",ma=Number(O.getAttribute(ga));ga=a("#ruler_"+ga+" canvas:first");var ia=ga.clone();ga.replaceWith(ia);var pa=ia[0];var va=ga=g[ja]();pa.parentNode.style[ja]=va+"px";var Ha=0,W=pa.getContext("2d"),Ea,xa,Ja;W.fillStyle="rgb(200,0,0)";W.fillRect(0,0,pa.width,pa.height);ia.siblings().remove();if(ga>=3E4){Ja=parseInt(ga/3E4,10)+1;Ea=[];Ea[0]=W;var Ra;for(F=1;F<Ja;F++){pa[ja]=3E4;Ra=pa.cloneNode(true);pa.parentNode.appendChild(Ra);Ea[F]=Ra.getContext("2d")}Ra[ja]=
ga%3E4;ga=3E4}pa[ja]=ga;ja=R*k;pa=50/ja;ia=1;for(F=0;F<Na.length;F++){ia=xa=Na[F];if(pa<=xa)break}pa=ia*ja;W.font="9px sans-serif";for(var Ga=ma/ja%ia*ja,Sa=Ga-pa;Ga<va;){Sa+=pa;F=Math.round(Ga)+0.5;if(Y){W.moveTo(F,15);W.lineTo(F,0)}else{W.moveTo(15,F);W.lineTo(0,F)}xa=(Sa-ma)/ja;if(ia>=1)F=Math.round(xa);else{F=String(ia).split(".")[1].length;F=xa.toFixed(F)}if(F!==0&&F!==1E3&&F%1E3===0)F=F/1E3+"K";if(Y)W.fillText(F,Ga+2,8);else{xa=String(F).split("");for(F=0;F<xa.length;F++)W.fillText(xa[F],1,
Ga+9+F*9)}xa=pa/10;for(F=1;F<10;F++){var Pa=Math.round(Ga+xa*F)+0.5;if(Ea&&Pa>ga){Ha++;W.stroke();if(Ha>=Ja){F=10;Ga=va;continue}W=Ea[Ha];Ga-=3E4;Pa=Math.round(Ga+xa*F)+0.5}var Ka=F%2?12:10;if(Y){W.moveTo(Pa,15);W.lineTo(Pa,Ka)}else{W.moveTo(15,Pa);W.lineTo(Ka,Pa)}}Ga+=pa}W.strokeStyle="#000";W.stroke()}}function ea(){if(c.deleteCurrentLayer()){Oa();qa();a("#layerlist tr.layer").removeClass("layersel");a("#layerlist tr.layer:first").addClass("layersel")}}function fa(){var g=c.getCurrentDrawing().getCurrentLayerName()+
" copy";a.prompt(t.notification.enterUniqueLayerName,g,function(k){if(k)if(c.getCurrentDrawing().hasLayer(k))a.alert(t.notification.dupeLayerName);else{c.cloneLayer(k);Oa();qa()}})}function ka(g){var k=a("#layerlist tr.layersel").index(),H=c.getCurrentDrawing().getNumLayers();if(k>0||k<H-1){k+=g;c.setCurrentLayerPosition(H-k-1);qa()}}function Ia(g){g.stopPropagation();g.preventDefault()}function Ba(g){g.stopPropagation();g.preventDefault()}function Ab(g){g.stopPropagation();g.preventDefault()}try{if("localStorage"in
window)i.storage=localStorage}catch(Bb){}var mb=[];a("#lang_select option").each(function(){mb.push(this.value)});(function(){var g,k;p=a.deparam.querystring(true);if(a.isEmptyObject(p)){j();i.loadContentAndPrefs()}else{if(p.dimensions)p.dimensions=p.dimensions.split(",");if(p.bkgd_color)p.bkgd_color="#"+p.bkgd_color;if(p.extensions)p.extensions=p.extensions.match(/[:\/\\]/)?"":p.extensions.split(",");a.each(["extPath","imgPath","langPath","jGraduatePath"],function(H){p[H]&&delete p[H]});i.setConfig(p,
{overwrite:false});j();if(!s.preventURLContentLoading){g=p.source;k=a.param.querystring();if(!g)if(k.indexOf("source=data:")>=0)g=k.match(/source=(data:[^&]*)/)[1];if(g){if(g.indexOf("data:")===0){g=g.replace(/ /g,"+");i.loadFromDataURI(g)}else i.loadFromString(g);return}if(k.indexOf("paramurl=")!==-1){i.loadFromURL(k.substr(9));return}if(p.url){i.loadFromURL(p.url);return}}if(!p.noStorageOnLoad||s.forceStorage)i.loadContentAndPrefs()}C=a.extend(true,{},D,C);i.curPrefs=C})();(function(){var g,k=window.opener;
if(k)try{g=k.document.createEvent("Event");g.initEvent("svgEditorReady",true,true);k.document.documentElement.dispatchEvent(g)}catch(H){}})();var Ya=i.setIcon=function(g,k){var H=typeof k==="string"?a.getSvgIcon(k,true):k.clone();H?a(g).empty().append(H):console.log("NOTE: Icon image missing: "+k)},ya=function(){a.each(s.extensions,function(){var g=this;g.match(/^ext-.*\.js/)&&a.getScript(s.extPath+g,function(k){if(!k){k=document.createElement("script");k.src=s.extPath+g;document.querySelector("head").appendChild(k)}})});
i.putLocale(null,mb)};document.location.protocol==="file:"?setTimeout(ya,100):ya();a.svgIcons(s.imgPath+"svg_edit_icons.svg",{w:24,h:24,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback_path:s.imgPath,fallback:{new_image:"clear.png",save:"save.png",update:"update.png",open:"open.png",source:"source.png",docprops:"document-properties.png",wireframe:"wireframe.png",undo:"undo.png",redo:"redo.png",select:"select.png",select_node:"select_node.png",pencil:"fhpath.png",pen:"line.png",square:"square.png",
rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",path:"path.png",text:"text.png",image:"image.png",zoom:"zoom.png",clone:"clone.png",node_clone:"node_clone.png","delete":"delete.png",node_delete:"node_delete.png",group:"shape_group_elements.png",ungroup:"shape_ungroup.png",move_top:"move_top.png",move_bottom:"move_bottom.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",align_left:"align-left.png",
align_center:"align-center.png",align_right:"align-right.png",align_top:"align-top.png",align_middle:"align-middle.png",align_bottom:"align-bottom.png",go_up:"go-up.png",go_down:"go-down.png",ok:"save.png",cancel:"cancel.png",arrow_right:"flyouth.png",arrow_down:"dropdown.gif"},placement:{"#logo":"logo","#tool_clear div,#layer_new":"new_image","#tool_save div":"save","#tool_export div":"export","#tool_open div div":"open","#tool_import div div":"import","#tool_import_bg div div":"import","#tool_source":"source",
"#tool_update":"update","#tool_docprops > div":"docprops","#tool_wireframe":"wireframe","#tool_undo":"undo","#tool_redo":"redo","#tool_select":"select","#tool_fhpath":"pencil","#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path","#tool_text,#layer_rename":"text","#tool_image":"image","#tool_zoom":"zoom","#tool_clone,#tool_clone_multi":"clone",
"#tool_node_clone":"node_clone","#layer_delete,#tool_delete,#tool_delete_multi":"delete","#tool_node_delete":"node_delete","#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_move_top":"move_top","#tool_move_bottom":"move_bottom","#tool_topath":"to_path","#tool_node_link":"link_controls","#tool_reorient":"reorient","#tool_group_elements":"group_elements","#tool_ungroup":"ungroup","#tool_unlink_use":"unlink_use","#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center",
"#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square","#linejoin_miter,#cur_linejoin":"linejoin_miter","#linejoin_round":"linejoin_round","#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down",
"#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#cornerRadiusLabel span":"c_radius","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link","#zoomLabel":"zoom","#tool_fill label":"fill","#tool_stroke .icon_label":"stroke","#group_opacityLabel":"opacity",
"#blurLabel":"blur","#font_sizeLabel":"fontsize",".flyout_arrow_horiz":"arrow_right",".dropdown button, #main_button .dropdown":"arrow_down","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},resize:{"#logo .svg_icon":28,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,".dropdown button .svg_icon":7,"#main_button .dropdown .svg_icon":9,".palette_item:first .svg_icon":15,"#fill_bg .svg_icon, #stroke_bg .svg_icon":16,".toolbar_button button .svg_icon":16,
".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18},callback:function(){a(".toolbar_button button > svg, .toolbar_button button > img").each(function(){a(this).parent().prepend(this)});var g,k=a("#tools_left");if(k.length!==0)g=k.offset().top+k.outerHeight();k=a.pref("iconsize");i.setIconSize(k||(a(window).height()<g?"s":"m"));a(".tools_flyout").each(function(){var H=a("#"+this.id+"_show"),F=H.attr("data-curopt");if(!H.children("svg, img").length){F=a(F).children().clone();if(F.length){F[0].removeAttribute("style");
H.append(F)}}});i.runCallbacks();setTimeout(function(){a(".flyout_arrow_horiz:empty").each(function(){a(this).append(a.getSvgIcon("arrow_right").width(5).height(5))})},1)}});i.canvas=c=new a.SvgCanvas(document.getElementById("svgcanvas"),s);var Zb,Za,Kb,Cb,rb,Va=svgedit.browser.isMac()?"meta+":"ctrl+",$a=c.pathActions,jb=c.undoMgr,sa=s.imgPath+"logo.png",Z=a("#workarea"),nb=a("#cmenu_canvas"),Lb=null,tb="crosshair",Mb="crosshair",sb="toolbars",vb="",Ta={fill:null,stroke:null};(function(){a("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",
containment:"window"});var g=a("#dialog_box"),k=a("#dialog_buttons"),H=a("#dialog_content"),F=function(O,R,Y,ga,ja,ma,ia){var pa,va,Ha;H.html("<p>"+R.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt",O=="prompt");k.empty();pa=a('<input type="button" value="'+t.common.ok+'">').appendTo(k);O!=="alert"&&a('<input type="button" value="'+t.common.cancel+'">').appendTo(k).click(function(){g.hide();Y(false)});if(O==="prompt"){va=a('<input type="text">').prependTo(k);va.val(ga||"");va.bind("keydown",
"return",function(){pa.click()})}else if(O==="select"){R=a('<div style="text-align:center;">');va=a("<select>").appendTo(R);if(ia){var W=a("<label>").text(ia.label);Ha=a('<input type="checkbox">').appendTo(W);Ha.val(ia.value);ia.tooltip&&W.attr("title",ia.tooltip);Ha.prop("checked",!!ia.checked);R.append(a("<div>").append(W))}a.each(ja||[],function(Ea,xa){typeof xa==="object"?va.append(a("<option>").val(xa.value).html(xa.text)):va.append(a("<option>").html(xa))});H.append(R);ga&&va.val(ga);ma&&va.bind("change",
"return",ma);va.bind("keydown","return",function(){pa.click()})}O==="process"&&pa.hide();g.show();pa.click(function(){g.hide();var Ea=O==="prompt"||O==="select"?va.val():true;if(Y)Ha?Y(Ea,Ha.prop("checked")):Y(Ea)}).focus();if(O==="prompt"||O==="select")va.focus()};a.alert=function(O,R){F("alert",O,R)};a.confirm=function(O,R){F("confirm",O,R)};a.process_cancel=function(O,R){F("process",O,R)};a.prompt=function(O,R,Y){F("prompt",O,Y,R)};a.select=function(O,R,Y,ga,ja,ma){F("select",O,Y,ja,R,ga,ma)}})();
var db=function(){var g=a(".tool_button_current");if(g.length&&g[0].id!=="tool_select"){g.removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")}c.setMode("select");Z.css("cursor","auto")},la=null,ta=false,hb=false,wa=false,Wa=false,ob="",Xa=a("title:first").text(),Na=[];for(ya=0.1;ya<1E5;ya*=10){Na.push(ya);Na.push(2*
ya);Na.push(5*ya)}var Nb=function(g){var k,H=[],F=c.getCurrentDrawing().getNumLayers();for(k=0;k<F;k++)H[k]=c.getCurrentDrawing().getLayerName(k);if(g)for(k=0;k<F;++k)H[k]!=g&&c.getCurrentDrawing().setLayerOpacity(H[k],0.5);else for(k=0;k<F;++k)c.getCurrentDrawing().setLayerOpacity(H[k],1)},qa=function(){c.clearSelection();for(var g=a("#layerlist tbody").empty(),k=a("#selLayerNames").empty(),H=c.getCurrentDrawing(),F=H.getCurrentLayerName(),O=c.getCurrentDrawing().getNumLayers(),R=a.getSvgIcon("eye");O--;){var Y=
H.getLayerName(O),ga=a('<tr class="layer">').toggleClass("layersel",Y===F),ja=a('<td class="layervis">').toggleClass("layerinvis",!H.getLayerVisibility(Y)),ma=a('<td class="layername">'+Y+"</td>");g.append(ga.append(ja,ma));k.append('<option value="'+Y+'">'+Y+"</option>")}if(R!==undefined){k=R.clone();a("td.layervis",g).append(k);a.resizeSvgIcons({"td.layervis .svg_icon":14})}a("#layerlist td.layername").mouseup(function(ia){a("#layerlist tr.layer").removeClass("layersel");a(this.parentNode).addClass("layersel");
c.setCurrentLayer(this.textContent);ia.preventDefault()}).mouseover(function(){Nb(this.textContent)}).mouseout(function(){Nb()});a("#layerlist td.layervis").click(function(){var ia=a(this.parentNode).prevAll().length;ia=a("#layerlist tr.layer:eq("+ia+") td.layername").text();var pa=a(this).hasClass("layerinvis");c.setLayerVisibility(ia,pa);a(this).toggleClass("layerinvis")});for(k=5-a("#layerlist tr.layer").size();k-- >0;)g.append('<tr><td style="color:white">_</td><td/></tr>')},kb=function(g,k){if(!hb){hb=
true;vb=c.getSvgString();a("#save_output_btns").toggle(!!k);a("#tool_source_back").toggle(!k);a("#svg_source_textarea").val(vb);a("#svg_source_editor").fadeIn();a("#svg_source_textarea").focus()}},Ub=function(){var g=c.svgCanvasToAtlasString();console.log(g);var k=i.curConfig.pid;if(!k)return alert("poi_id not found !!");a.ajax({url:ATLAS_POI_CONFIG.EDITOR_POST_URL+"/"+k,dataType:"json",type:"POST",data:g,success:function(H){console.log(H);alert("save content successfully .")},error:function(){alert("failed to save content ..")}})},
Vb=function(g,k){a("#path_node_panel").toggle(g);a("#tools_bottom_2,#tools_bottom_3").toggle(!g);if(g){a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");Ya("#tool_select","select_node");ta=false;if(k.length)la=k[0]}else setTimeout(function(){Ya("#tool_select","select")},1E3)},ub=function(){window.opera&&a("<p/>").hide().appendTo("body").remove()},Qa=i.toolButtonClick=function(g,k){if(a(g).hasClass("disabled"))return false;
if(a(g).parent().hasClass("tools_flyout"))return true;k||a(".tools_flyout").fadeOut("normal");a("#styleoverrides").text("");Z.css("cursor","auto");a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a(g).addClass("tool_button_current").removeClass("tool_button");return true},pb=i.clickSelect=function(){if(Qa("#tool_select")){c.setMode("select");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}")}},Eb=i.setImageURL=
function(g){g||(g=sa);c.setImageURL(g);a("#image_url").val(g);if(g.indexOf("data:")===0){a("#image_url").hide();a("#change_image_url").show()}else{c.embedImage(g,function(k){a("#url_notice").toggle(!k);sa=g});a("#image_url").show();a("#change_image_url").hide()}},Ob=function(g){var k=Math.min(Math.max(12+g.value.length*6,50),300);a(g).width(k)},eb=i.updateCanvas=function(g,k){var H=Z.width(),F=Z.height(),O=H,R=F,Y=c.getZoom(),ga=a("#svgcanvas"),ja={x:Z[0].scrollLeft+O/2,y:Z[0].scrollTop+R/2},ma=s.canvas_expansion;
H=Math.max(O,c.contentW*Y*ma);F=Math.max(R,c.contentH*Y*ma);H==O&&F==R?Z.css("overflow","hidden"):Z.css("overflow","scroll");ma=ga.height()/2;var ia=ga.width()/2;ga.width(H).height(F);var pa=F/2,va=H/2,Ha=c.updateCanvas(H,F),W=va/ia;H=H/2-O/2;F=F/2-R/2;if(k){k.x+=Ha.x;k.y+=Ha.y}else k={x:va+(ja.x-ia)*W,y:pa+(ja.y-ma)*W};if(g)if(c.contentW>Z.width()){Z[0].scrollLeft=Ha.x-10;Z[0].scrollTop=Ha.y-10}else{Z[0].scrollLeft=H;Z[0].scrollTop=F}else{Z[0].scrollLeft=k.x-O/2;Z[0].scrollTop=k.y-R/2}if(s.showRulers){oa(ga,
Y);Z.scroll()}p.storagePrompt!==true&&!i.storagePromptClosed&&a("#dialog_box").hide()},Fb=function(){var g,k,H=c.getColor("fill")=="none",F=c.getColor("stroke")=="none",O=["#tool_fhpath","#tool_line"],R=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];if(F)for(g in O){k=O[g];a(k).hasClass("tool_button_current")&&pb();a(k).addClass("disabled")}else for(g in O){k=O[g];a(k).removeClass("disabled")}if(F&&H)for(g in R){k=R[g];a(k).hasClass("tool_button_current")&&pb();
a(k).addClass("disabled")}else for(g in R){k=R[g];a(k).removeClass("disabled")}c.runExtensions("toolButtonStateUpdate",{nofill:H,nostroke:F});a(".tools_flyout").each(function(){var Y=a("#"+this.id+"_show"),ga=false;a(this).children().each(function(){a(this).hasClass("disabled")||(ga=true)});Y.toggleClass("disabled",!ga)});ub()};a("#tool_class_assign").change(function(){var g="";switch(a(this).val()){case "floor":g="floor";break;case "shop":g="shop";break;case "not-accessible":g="shop not-accessible";
break;default:g=null}g&&la.setAttribute("class",g)});a("#tool_sid_assign").blur(function(){var g=a(this).val();console.log("-- on blur, %s --",g);la&&la.setAttribute("sid",(g+"").trim())});a("#tool_sid_assign").on("input propertychange",function(){var g=a(this).val();console.log("-- on blur, %s --",g);la&&la.setAttribute("sid",(g+"").trim())});var Oa=function(){var g=la;if(g!=null&&!g.parentNode)g=null;var k=c.getCurrentDrawing().getCurrentLayerName(),H=c.getMode(),F=s.baseUnit!=="px"?s.baseUnit:
null,O=H=="pathedit",R=a("#cmenu_canvas li");a("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide();if(g!=null){var Y=g.nodeName,ga=c.getRotationAngle(g);a("#angle").val(ga);var ja=c.getBlur(g);a("#blur").val(ja);a("#blur_slider").slider("option","value",ja);c.addedNew&&Y==="image"&&c.getHref(g).indexOf("data:")!==0&&aa();if(!O&&H!="pathedit"){a("#selected_panel").show();
if(["line","circle","ellipse"].indexOf(Y)>=0)a("#xy_panel").hide();else{var ma,ia;if(["g","polyline","path"].indexOf(Y)>=0){if(H=c.getStrokedBBox([g])){ma=H.x;ia=H.y}}else{ma=g.getAttribute("x");ia=g.getAttribute("y")}if(F){ma=svgedit.units.convertUnit(ma);ia=svgedit.units.convertUnit(ia)}a("#selected_x").val(ma||0);a("#selected_y").val(ia||0);a("#xy_panel").show()}F=["image","text","path","g","use"].indexOf(Y)==-1;a("#tool_topath").toggle(F);a("#tool_reorient").toggle(Y==="path");a("#tool_reorient").toggleClass("disabled",
ga===0)}else{k=$a.getNodePoint();a("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button");a("#tool_node_delete").toggleClass("disabled",!$a.canDeleteNodes);Ya("#tool_openclose_path",$a.closed_subpath?"open_path":"close_path");if(k){O=a("#seg_type");if(F){k.x=svgedit.units.convertUnit(k.x);k.y=svgedit.units.convertUnit(k.y)}a("#path_node_x").val(k.x);a("#path_node_y").val(k.y);k.type?O.val(k.type).removeAttr("disabled"):O.val(4).attr("disabled","disabled")}return}F={g:[],a:[],
rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]};var pa=g.tagName;Y=null;if(pa==="a"){Y=c.getHref(g);a("#g_panel").show()}if(g.parentNode.tagName==="a")if(!a(g).siblings().length){a("#a_panel").show();Y=c.getHref(g.parentNode)}a("#tool_make_link, #tool_make_link").toggle(!Y);Y&&a("#link_url").val(Y);if(F[pa]){F=F[pa];a("#"+pa+"_panel").show();a.each(F,function(va,Ha){var W=g.getAttribute(Ha);if(s.baseUnit!==
"px"&&g[Ha])W=svgedit.units.convertUnit(g[Ha].baseVal.value);a("#"+pa+"_"+Ha).val(W||0)});if(pa=="text"){a("#text_panel").css("display","inline");c.getItalic()?a("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_italic").removeClass("push_button_pressed").addClass("tool_button");c.getBold()?a("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_bold").removeClass("push_button_pressed").addClass("tool_button");a("#font_family").val(g.getAttribute("font-family"));
a("#font_size").val(g.getAttribute("font-size"));a("#text").val(g.textContent);c.addedNew&&setTimeout(function(){a("#text").focus().select()},100)}else if(pa=="image")Eb(c.getHref(g));else if(pa==="g"||pa==="use"){a("#container_panel").show();F=c.getTitle();Y=a("#g_title")[0];Y.value=F;Ob(Y);a("#g_title").prop("disabled",pa=="use")}}R[(pa==="g"?"en":"dis")+"ableContextMenuItems"]("#ungroup");R[(pa==="g"||!ta?"dis":"en")+"ableContextMenuItems"]("#group")}else if(ta){a("#multiselected_panel").show();
R.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")}else R.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");a("#tool_undo").toggleClass("disabled",jb.getUndoStackSize()===0);a("#tool_redo").toggleClass("disabled",jb.getRedoStackSize()===0);c.addedNew=false;if(g&&!O||ta){a("#selLayerNames").removeAttr("disabled").val(k);nb.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")}else a("#selLayerNames").attr("disabled",
"disabled")},ab=function(){if(!Zb){var g="#workarea.wireframe #svgcontent * { stroke-width: "+1/c.getZoom()+"px; }";a("#wireframe_rules").text(Z.hasClass("wireframe")?g:"")}},Fa=function(g){g=g||c.getDocumentTitle();g=Xa+(g?": "+g:"");a("title:first").text(g)},na=c.zoomChanged=function(g,k,H){if(k=c.setBBoxZoom(k,Z.width()-15,Z.height()-15)){g=k.zoom;k=k.bbox;if(g<0.001)Kb({value:0.1});else{a("#zoom").val((g*100).toFixed(1));H?eb():eb(false,{x:k.x*g+k.width*g/2,y:k.y*g+k.height*g/2});c.getMode()==
"zoom"&&k.width&&db();ab()}}};Kb=function(g){var k=g.value/100;if(k<0.001)g.value=0.1;else{g=c.getZoom();na(window,{width:0,height:0,x:(Z[0].scrollLeft+Z.width()/2)/g,y:(Z[0].scrollTop+Z.height()/2)/g,zoom:k},true)}};a("#cur_context_panel").delegate("a","click",function(){var g=a(this);g.attr("data-root")?c.leaveContext():c.setContext(g.text());c.clearSelection();return false});var La=function(){Ta.fill.prep();Ta.stroke.prep()},ua={},Qb=function(){a(".tools_flyout").each(function(){var g=a("#"+this.id+
"_show");if(!g.data("isLibrary")){var k=[];a(this).children().each(function(){k.push(this.title)});g[0].title=k.join(" / ")}})},wb=function(){a(".tools_flyout").each(function(){var g=a("#"+this.id+"_show"),k=g.offset();g=g.outerWidth();a(this).css({left:(k.left+g)*i.tool_scale,top:k.top})})},$b=function(g){a.each(g,function(k,H){var F=a(k).children(),O=k+"_show",R=a(O),Y=false;F.addClass("tool_button").unbind("click mousedown mouseup").each(function(ma){var ia=H[ma];ua[ia.sel]=ia.fn;if(ia.isDefault)Y=
ma;ma=function(pa){var va=ia;if(pa.type==="keydown"){var Ha=a(va.parent+"_show").hasClass("tool_button_current"),W=a(va.parent+"_show").attr("data-curopt");a.each(g[ia.parent],function(xa,Ja){if(Ja.sel==W)va=!pa.shiftKey||!Ha?Ja:g[ia.parent][xa+1]||g[ia.parent][0]})}if(a(this).hasClass("disabled"))return false;Qa(O)&&va.fn();var Ea;Ea=va.icon?a.getSvgIcon(va.icon,true):a(va.sel).children().eq(0).clone();Ea[0].setAttribute("width",R.width());Ea[0].setAttribute("height",R.height());R.children(":not(.flyout_arrow_horiz)").remove();
R.append(Ea).attr("data-curopt",va.sel)};a(this).mouseup(ma);ia.key&&a(document).bind("keydown",ia.key[0]+" shift+"+ia.key[0],ma)});if(Y)R.attr("data-curopt",H[Y].sel);else R.attr("data-curopt")||R.attr("data-curopt",H[0].sel);var ga,ja=a(O).position();R.mousedown(function(ma){if(R.hasClass("disabled"))return false;var ia=a(k),pa=ja.left+34,va=ia.width()*-1,Ha=ia.data("shown_popop")?200:0;ga=setTimeout(function(){R.data("isLibrary")?ia.css("left",pa).show():ia.css("left",va).show().animate({left:pa},
150);ia.data("shown_popop",true)},Ha);ma.preventDefault()}).mouseup(function(){clearTimeout(ga);var ma=a(this).attr("data-curopt");if(R.data("isLibrary")&&a(O.replace("_show","")).is(":visible"))Qa(O,true);else Qa(O)&&ua[ma]&&ua[ma]()})});Qb();wb()},Wb=function(g,k){return a("<div>",{"class":"tools_flyout",id:g}).appendTo("#svg_editor").append(k)},ib=function(){var g,k=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,H=document.getElementsByTagName("script")[0];for(g in H.style)if(k.test(g))return g.match(k)[0];
if("WebkitOpacity"in H.style)return"Webkit";if("KhtmlOpacity"in H.style)return"Khtml";return""}(),Ca=function(g,k){var H=["top","left","bottom","right"];g.each(function(){var F,O=a(this),R=O.outerWidth()*(k-1),Y=O.outerHeight()*(k-1);for(F=0;F<4;F++){var ga=H[F],ja=O.data("orig_margin-"+ga);if(ja==null){ja=parseInt(O.css("margin-"+ga),10);O.data("orig_margin-"+ga,ja)}ja=ja*k;if(ga==="right")ja+=R;else if(ga==="bottom")ja+=Y;O.css("margin-"+ga,ja)}})},bb=i.setIconSize=function(g){var k=a("#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout"),
H=1;H=typeof g==="number"?g:{s:0.75,m:1,l:1.25,xl:1.5}[g];i.tool_scale=H;wb();var F=k.parents(":hidden");F.css("visibility","hidden").show();Ca(k,H);F.css("visibility","visible").hide();a.pref("iconsize",g);a("#iconsize").val(g);F={"#tools_top":{left:50,height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}};k=a("#tool_size_rules");if(k.length)k.empty();else k=a('<style id="tool_size_rules"></style>').appendTo("head");if(g!=="m"){var O="";a.each(F,function(R,Y){R="#svg_editor "+
R.replace(/,/g,", #svg_editor");O+=R+"{";a.each(Y,function(ga,ja){var ma;if(typeof ja==="number")ma=ja*H+"px";else if(ja[g]||ja.all)ma=ja[g]||ja.all;O+=ga+":"+ma+";"});O+="}"});F="-"+ib.toLowerCase()+"-";O+="#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout{"+F+"transform: scale("+H+");} #svg_editor div.toolset .toolset {"+F+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+
F+"transform: scale("+1/H+");}";k.text(O)}wb()},cb=function(g,k,H,F){var O=a(g);k=a(k);var R=false,Y=F.dropUp;Y&&a(g).addClass("dropup");k.find("li").bind("mouseup",function(){if(F.seticon){Ya("#cur_"+O[0].id,a(this).children());a(this).addClass("current").siblings().removeClass("current")}H.apply(this,arguments)});a(window).mouseup(function(){if(!R){O.removeClass("down");k.hide();k.css({top:0,left:0})}R=false});O.bind("mousedown",function(){var ga=O.offset();if(Y){ga.top-=k.height();ga.left+=8}else ga.top+=
O.height();k.offset(ga);if(O.hasClass("down")){k.hide();k.css({top:0,left:0})}else{k.show();R=true}O.toggleClass("down")}).hover(function(){R=true}).mouseout(function(){R=false});F.multiclick&&k.mousedown(function(){R=true})},qb=[],Pb=function(g,k,H){k={alpha:k};if(g.indexOf("url(#")===0){g=(g=c.getRefElem(g))?g.cloneNode(true):a("#"+H+"_color defs *")[0];k[g.tagName]=g}else k.solidColor=g.indexOf("#")===0?g.substr(1):"none";return new a.jGraduate.Paint(k)};a("#text").focus(function(){});a("#text").blur(function(){});
c.bind("selected",function(g,k){var H=c.getMode();H==="select"&&db();H=H=="pathedit";la=k.length===1||k[1]==null?k[0]:null;ta=k.length>=2&&k[1]!=null;if(la!=null)if(!H){var F,O;if(la!=null)switch(la.tagName){case "use":case "image":case "foreignObject":break;case "g":case "a":var R=null,Y=la.getElementsByTagName("*");F=0;for(O=Y.length;F<O;F++){var ga=Y[F].getAttribute("stroke-width");if(F===0)R=ga;else if(R!==ga)R=null}a("#stroke_width").val(R===null?"":R);Ta.fill.update(true);Ta.stroke.update(true);
break;default:Ta.fill.update(true);Ta.stroke.update(true);a("#stroke_width").val(la.getAttribute("stroke-width")||1);a("#stroke_style").val(la.getAttribute("stroke-dasharray")||"none");F=la.getAttribute("stroke-linejoin")||"miter";a("#linejoin_"+F).length!=0&&I(a("#linejoin_"+F)[0]);F=la.getAttribute("stroke-linecap")||"butt";a("#linecap_"+F).length!=0&&I(a("#linecap_"+F)[0])}if(la!=null){F=(la.getAttribute("opacity")||1)*100;a("#group_opacity").val(F);a("#opac_slider").slider("option","value",F);
a("#elem_id").val(la.id)}if(la!=null){F=a("#tool_class_assign");O=a("#tool_sid_assign");if(la.tagName==="path"){F.prop("disabled",false);R=la.getAttribute("class");Y=la.getAttribute("sid");switch(R){case "floor":F.val("floor");break;case "shop":F.val("shop");break;case "shop not-accessible":F.val("not-accessible");break;default:F.val("nothing")}O.val(Y)}else F.prop("disabled",true)}Fb()}Vb(H,k);Oa();c.runExtensions("selectedChanged",{elems:k,selectedElement:la,multiselected:ta})});c.bind("transition",
function(g,k){var H=c.getMode(),F=k[0];if(F){ta=k.length>=2&&k[1]!=null;if(!ta)switch(H){case "rotate":H=c.getRotationAngle(F);a("#angle").val(H);a("#tool_reorient").toggleClass("disabled",H===0)}c.runExtensions("elementTransition",{elems:k})}});c.bind("changed",function(g,k){var H,F=c.getMode();F==="select"&&db();for(H=0;H<k.length;++H){var O=k[H];if(O&&O.tagName==="svg"){qa();eb()}else if(O&&la&&la.parentNode==null)la=O}i.showSaveWarning=true;Oa();if(la&&F==="select"){Ta.fill.update();Ta.stroke.update()}c.runExtensions("elementChanged",
{elems:k})});c.bind("saved",function(g,k){i.showSaveWarning=false;k='<?xml version="1.0"?>\n'+k;if(svgedit.browser.isIE())kb(0,true);else{var H=g.open("data:image/svg+xml;base64,"+e.encode64(k)),F=a.pref("save_notice_done");if(F!=="all"){var O=t.notification.saveFromBrowser.replace("%s","SVG");if(svgedit.browser.isGecko())if(k.indexOf("<defs")!==-1){O+="\n\n"+t.notification.defsFailOnSave;a.pref("save_notice_done","all");F="all"}else a.pref("save_notice_done","part");else a.pref("save_notice_done",
"all");F!=="part"&&H.alert(O)}}});c.bind("exported",function(g,k){var H=k.issues,F=k.type||"PNG",O=(F==="ICO"?"BMP":F).toLowerCase();a("#export_canvas").length||a("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var R=a("#export_canvas")[0];R.width=c.contentW;R.height=c.contentH;canvg(R,k.svg,{renderCallback:function(){var Y=k.quality?R.toDataURL("image/"+O,k.quality):R.toDataURL("image/"+O);Lb.location.href=Y;if(a.pref("export_notice_done")!=="all"){Y=t.notification.saveFromBrowser.replace("%s",
F);if(H.length)Y+="\n\n"+t.notification.noteTheseIssues+"\n \u2022 "+H.join("\n \u2022 ");a.pref("export_notice_done","all");Lb.alert(Y)}}})});c.bind("zoomed",na);c.bind("contextset",function(g,k){var H="";if(k){var F="";H='<a href="#" data-root="y">'+c.getCurrentDrawing().getCurrentLayerName()+"</a>";a(k).parentsUntil("#svgcontent > g").andSelf().each(function(){if(this.id){F+=" > "+this.id;H+=this!==k?' > <a href="#">'+this.id+"</a>":" > "+this.id}});ob=F}else ob=null;a("#cur_context_panel").toggle(!!k).html(H);
Fa()});c.bind("extension_added",function(g,k){function H(){if(Za){clearTimeout(Za);Za=null}O||(Za=setTimeout(function(){O=true;bb(a.pref("iconsize"))},50))}if(k){var F=false,O=false,R=true;if(k.langReady)if(i.langChanged){var Y=a.pref("lang");k.langReady({lang:Y,uiStrings:t})}else qb.push(k);var ga=function(){if(k.callback&&!F&&R){F=true;k.callback()}},ja=[];k.context_tools&&a.each(k.context_tools,function(Ha,W){var Ea,xa=W.container_id?' id="'+W.container_id+'"':"",Ja=a("#"+W.panel);Ja.length||(Ja=
a("<div>",{id:W.panel}).appendTo("#tools_top"));switch(W.type){case "tool_button":Ea='<div class="tool_button">'+W.id+"</div>";var Ra=a(Ea).appendTo(Ja);W.events&&a.each(W.events,function(Pa,Ka){a(Ra).bind(Pa,Ka)});break;case "select":Ea="<label"+xa+'><select id="'+W.id+'">';a.each(W.options,function(Pa,Ka){Ea+='<option value="'+Pa+'"'+(Pa==W.defval?" selected":"")+">"+Ka+"</option>"});Ea+="</select></label>";var Ga=a(Ea).appendTo(Ja).find("select");a.each(W.events,function(Pa,Ka){a(Ga).bind(Pa,Ka)});
break;case "button-select":Ea='<div id="'+W.id+'" class="dropdown toolset" title="'+W.title+'"><div id="cur_'+W.id+'" class="icon_label"></div><button></button></div>';xa=a('<ul id="'+W.id+'_opts"></ul>').appendTo("#option_lists");W.colnum&&xa.addClass("optcols"+W.colnum);a(Ea).appendTo(Ja).children();ja.push({elem:"#"+W.id,list:"#"+W.id+"_opts",title:W.title,callback:W.events.change,cur:"#cur_"+W.id});break;case "input":Ea="<label"+xa+'><span id="'+W.id+'_label">'+W.label+':</span><input id="'+W.id+
'" title="'+W.title+'" size="'+(W.size||"4")+'" value="'+(W.defval||"")+'" type="text"/></label>';var Sa=a(Ea).appendTo(Ja).find("input");W.spindata&&Sa.SpinButton(W.spindata);W.events&&a.each(W.events,function(Pa,Ka){Sa.bind(Pa,Ka)})}});if(k.buttons){var ma={},ia={},pa=k.svgicons,va={};a.each(k.buttons,function(Ha,W){var Ea,xa,Ja,Ra=W.id;for(xa=Ha;a("#"+Ra).length;)Ra=W.id+"_"+ ++xa;if(pa){ma[Ra]=W.icon;xa=W.svgicon||W.id;if(W.type=="app_menu")ia["#"+Ra+" > div"]=xa;else ia["#"+Ra]=xa}else Ea=a('<img src="'+
W.icon+'">');var Ga,Sa;switch(W.type){case "mode_flyout":case "mode":Ga="tool_button";Sa="#tools_left";break;case "context":Ga="tool_button";Sa="#"+W.panel;a(Sa).length||a("<div>",{id:W.panel}).appendTo("#tools_top");break;case "app_menu":Ga="";Sa="#main_menu ul"}var Pa,Ka,Ua=a(W.list||W.type=="app_menu"?"<li/>":"<div/>").attr("id",Ra).attr("title",W.title).addClass(Ga);if(!W.includeWith&&!W.list){if("position"in W)a(Sa).children().eq(W.position).length?a(Sa).children().eq(W.position).before(Ua):
a(Sa).children().last().before(Ua);else Ua.appendTo(Sa);if(W.type=="mode_flyout"){Ka=a(Ua);Ga=Ka.parent();if(!Ka.parent().hasClass("tools_flyout")){Ja=Ka[0].id.replace("tool_","tools_");xa=Ka.clone().attr("id",Ja+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));Ka.before(xa);Ga=Wb(Ja,Ka);Ga.data("isLibrary",true);xa.data("isLibrary",true)}ia["#"+Ja+"_show"]=W.id;Ja=va["#"+Ga[0].id]=[{sel:"#"+Ra,fn:W.events.click,icon:W.id,isDefault:true},Pa]}else W.type=="app_menu"&&Ua.append("<div>").append(W.title)}else if(W.list){Ua.addClass("push_button");
a("#"+W.list+"_opts").append(Ua);if(W.isDefault){a("#cur_"+W.list).append(Ua.children().clone());xa=W.svgicon||W.id;ia["#cur_"+W.list]=xa}}else if(W.includeWith){Sa=W.includeWith;Ka=a(Sa.button);Ga=Ka.parent();if(!Ka.parent().hasClass("tools_flyout")){Ja=Ka[0].id.replace("tool_","tools_");xa=Ka.clone().attr("id",Ja+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));Ka.before(xa);Ga=Wb(Ja,Ka)}Pa=Cb.getButtonData(Sa.button);if(Sa.isDefault)ia["#"+Ja+"_show"]=W.id;Ja=va["#"+Ga[0].id]=[{sel:"#"+
Ra,fn:W.events.click,icon:W.id,key:W.key,isDefault:W.includeWith?W.includeWith.isDefault:0},Pa];Ra="position"in Sa?Sa.position:"last";Pa=Ga.children().length;if(!isNaN(Ra)&&Ra>=0&&Ra<Pa)Ga.children().eq(Ra).before(Ua);else{Ga.append(Ua);Ja.reverse()}}pa||Ua.append(Ea);W.list||a.each(W.events,function(cc,dc){if(cc=="click"&&W.type=="mode"){W.includeWith?Ua.bind(cc,dc):Ua.bind(cc,function(){Qa(Ua)&&dc()});if(W.key){a(document).bind("keydown",W.key,dc);W.title&&Ua.attr("title",W.title+" ["+W.key+"]")}}else Ua.bind(cc,
dc)});$b(va)});a.each(ja,function(){cb(this.elem,this.list,this.callback,{seticon:true})});if(pa)R=false;a.svgIcons(pa,{w:24,h:24,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback:ma,placement:ia,callback:function(){a.pref("iconsize")!=="m"&&H();R=true;ga()}})}ga()}});c.textActions.setInputElem(a("#text")[0]);var xb='<div class="palette_item" data-rgb="none"></div>';a.each(["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff",
"#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],function(g,k){xb+='<div class="palette_item" style="background-color: '+k+';" data-rgb="'+k+'"></div>'});a("#palette").append(xb);xb="";a.each(["#FFF","#888","#000"],function(){xb+='<div class="color_block" style="background-color:'+
this+';"></div>'});a("#bg_blocks").append(xb);var Ib=a("#bg_blocks div");Ib.each(function(){a(this).click(function(){Ib.removeClass("cur_background");a(this).addClass("cur_background")})});T(a.pref("bkgd_color"),a.pref("bkgd_url"));a("#image_save_opts input").val([a.pref("img_save")]);var Db=function(g,k){if(k==null)k=g.value;a("#group_opacity").val(k);if(!g||!g.handle)a("#opac_slider").slider("option","value",k);c.setOpacity(k/100)},Jb=function(g,k,H){if(k==null)k=g.value;a("#blur").val(k);var F=
false;if(!g||!g.handle){a("#blur_slider").slider("option","value",k);F=true}H?c.setBlurNoUndo(k):c.setBlur(k,F)};a("#stroke_style").change(function(){c.setStrokeAttr("stroke-dasharray",a(this).val());ub()});a("#stroke_linejoin").change(function(){c.setStrokeAttr("stroke-linejoin",a(this).val());ub()});a("select").change(function(){a(this).blur()});var Yb=false;a("#selLayerNames").change(function(){var g=this.options[this.selectedIndex].value,k=t.notification.QmoveElemsToLayer.replace("%s",g),H=function(F){if(F){Yb=
true;c.moveSelectedToLayer(g);c.clearSelection();qa()}};if(g)Yb?H(true):a.confirm(k,H)});a("#font_family").change(function(){c.setFontFamily(this.value)});a("#seg_type").change(function(){c.setSegType(a(this).val())});a("#text").keyup(function(){c.setTextContent(this.value)});a("#image_url").change(function(){Eb(this.value)});a("#link_url").change(function(){this.value.length?c.setLinkURL(this.value):c.removeHyperlink()});a("#g_title").change(function(){c.setGroupTitle(this.value)});a(".attr_changer").change(function(){var g=
this.getAttribute("data-attr"),k=this.value;if(!svgedit.units.isValidUnit(g,k,la)){a.alert(t.notification.invalidAttrValGiven);this.value=la.getAttribute(g);return false}if(g!=="id")if(isNaN(k))k=c.convertToNum(g,k);else if(s.baseUnit!=="px"){var H=svgedit.units.getTypeMap();if(la[g]||c.getMode()==="pathedit"||g==="x"||g==="y")k*=H[s.baseUnit]}if(g==="id"){g=la;c.clearSelection();g.id=k;c.addToSelection([g],true)}else c.changeSelectedAttribute(g,k);this.blur()});a("#palette").mouseover(function(){var g=
a('<input type="hidden">');a(this).append(g);g.focus().remove()});a(".palette_item").mousedown(function(g){g=g.shiftKey||g.button===2?"stroke":"fill";var k=a(this).data("rgb"),H;if(k==="none"||k==="transparent"||k==="initial"){k="none";H=new a.jGraduate.Paint}else H=new a.jGraduate.Paint({alpha:100,solidColor:k.substr(1)});Ta[g].setPaint(H);c.setColor(g,k);k!=="none"&&c.getPaintOpacity(g)!==1&&c.setPaintOpacity(g,1);Fb()}).bind("contextmenu",function(g){g.preventDefault()});a("#toggle_stroke_tools").on("click",
function(){a("#tools_bottom").toggleClass("expanded")});(function(){var g=null,k=null,H=Z[0],F=false,O=false;a("#svgcanvas").bind("mousemove mouseup",function(R){if(F!==false){H.scrollLeft-=R.clientX-g;H.scrollTop-=R.clientY-k;g=R.clientX;k=R.clientY;if(R.type==="mouseup")F=false;return false}}).mousedown(function(R){if(R.button===1||O===true){F=true;g=R.clientX;k=R.clientY;return false}});a(window).mouseup(function(){F=false});a(document).bind("keydown","space",function(R){c.spaceKey=O=true;R.preventDefault()}).bind("keyup",
"space",function(R){R.preventDefault();c.spaceKey=O=false}).bind("keydown","shift",function(){c.getMode()==="zoom"&&Z.css("cursor",Mb)}).bind("keyup","shift",function(){c.getMode()==="zoom"&&Z.css("cursor",tb)});i.setPanning=function(R){c.spaceKey=O=R}})();(function(){var g=a("#main_icon"),k=a("#main_icon span"),H=a("#main_menu"),F=false,O=0,R=true,Y=false;a(window).mouseup(function(ja){if(!F){g.removeClass("buttondown");if(ja.target.tagName!="INPUT")H.fadeOut(200);else if(!Y){Y=true;a(ja.target).click(function(){H.css("margin-left",
"-9999px").show()})}}F=false}).mousedown(function(ja){a(ja.target).closest("div.tools_flyout, .contextMenu").length||a(".tools_flyout:visible,.contextMenu").fadeOut(250)});k.bind("mousedown",function(){if(g.hasClass("buttondown"))H.fadeOut(200);else{H.css("margin-left",0).show();O||(O=H.height());H.css("height",0).animate({height:O},200);F=true}g.toggleClass("buttondown buttonup")}).hover(function(){F=true}).mouseout(function(){F=false});var ga=a("#main_menu li");ga.mouseover(function(){R=a(this).css("background-color")==
"rgba(0, 0, 0, 0)";ga.unbind("mouseover");R&&ga.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){this.style.backgroundColor="transparent";return true})})})();i.addDropDown=function(g,k,H){if(a(g).length!=0){var F=a(g).find("button"),O=a(g).find("ul").attr("id",a(g)[0].id+"-list"),R=false;H?a(g).addClass("dropup"):a("#option_lists").append(O);O.find("li").bind("mouseup",k);a(window).mouseup(function(){if(!R){F.removeClass("down");O.hide()}R=false});F.bind("mousedown",function(){if(F.hasClass("down"))O.hide();
else{if(!H){var Y=a(g).position();O.css({top:Y.top+24,left:Y.left-10})}O.show();R=true}F.toggleClass("down")}).hover(function(){R=true}).mouseout(function(){R=false})}};i.addDropDown("#font_family_dropdown",function(){a("#font_family").val(a(this).text()).change()});i.addDropDown("#opacity_dropdown",function(){if(!a(this).find("div").length){var g=parseInt(a(this).text().split("%")[0],10);Db(false,g)}},true);a("#opac_slider").slider({start:function(){a("#opacity_dropdown li:not(.special)").hide()},
stop:function(){a("#opacity_dropdown li").show();a(window).mouseup()},slide:function(g,k){Db(k)}});i.addDropDown("#blur_dropdown",a.noop);var lb=false;a("#blur_slider").slider({max:10,step:0.1,stop:function(g,k){lb=false;Jb(k);a("#blur_dropdown li").show();a(window).mouseup()},start:function(){lb=true},slide:function(g,k){Jb(k,null,lb)}});i.addDropDown("#zoom_dropdown",function(){var g=a(this),k=g.data("val");k?na(window,k):Kb({value:parseFloat(g.text())})},true);cb("#stroke_linecap","#linecap_opts",
function(){I(this,true)},{dropUp:true});cb("#stroke_linejoin","#linejoin_opts",function(){I(this,true)},{dropUp:true});cb("#tool_position","#position_opts",function(){var g=this.id.replace("tool_pos","").charAt(0);c.alignSelectedElements(g,"page")},{multiclick:true});(function(){var g,k=function(){a(g).blur()};a("#svg_editor").find("button, select, input:not(#text)").focus(function(){g=this;sb="toolbars";Z.mousedown(k)}).blur(function(){sb="canvas";Z.unbind("mousedown",k);c.getMode()=="textedit"&&
a("#text").focus()})})();var Sb=function(){Qa("#tool_square")&&c.setMode("square")},hc=function(){Qa("#tool_fhrect")&&c.setMode("fhrect")},yb=function(){Qa("#tool_circle")&&c.setMode("circle")},bc=function(){Qa("#tool_fhellipse")&&c.setMode("fhellipse")},ac=function(){Qa("#tool_image")&&c.setMode("image")},zb=function(){if(Qa("#tool_zoom")){c.setMode("zoom");Z.css("cursor",tb)}},Ma=function(g){var k=c.getResolution();g=g?k.zoom*g:1;a("#zoom").val(g*100);c.setZoom(g);ab();eb(true)},Xb=function(){if(Qa("#tool_zoom")){Ma();
db()}},b=function(){Qa("#tool_path")&&c.setMode("path")},f=function(){if(la!=null||ta)c.deleteSelectedElements()},d=function(){if(la!=null||ta)c.cutSelectedElements()},o=function(){if(la!=null||ta)c.copySelectedElements()},n=function(){var g=c.getZoom(),k=(Z[0].scrollLeft+Z.width()/2)/g-c.contentW;g=(Z[0].scrollTop+Z.height()/2)/g-c.contentH;c.pasteElements("point",k,g)},m=function(){la!=null&&c.moveToTopSelectedElement()},u=function(){la!=null&&c.moveToBottomSelectedElement()},w=function(g){la!=
null&&c.moveUpDownSelected(g)},B=function(){la!=null&&c.convertToPath()},L=function(){la!=null&&$a.reorient()},G=function(){if(la!=null||ta)a.prompt(t.notification.enterNewLinkURL,"http://",function(g){g&&c.makeHyperlink(g)})},E=function(g,k){if(la!=null||ta){if(s.gridSnapping){var H=c.getZoom()*s.snappingStep;g*=H;k*=H}c.moveSelectedElements(g,k)}},X=function(){a("#tool_node_link").toggleClass("push_button_pressed tool_button");var g=a("#tool_node_link").hasClass("push_button_pressed");$a.linkControlPoints(g)},
S=function(){$a.getNodePoint()&&$a.clonePathNode()},Q=function(){$a.getNodePoint()&&$a.deletePathNode()},U=function(){var g=a("#tool_add_subpath"),k=!g.hasClass("push_button_pressed");g.toggleClass("push_button_pressed tool_button");$a.addSubPath(k)},ca=function(){$a.opencloseSubPath()},V=function(){c.cycleElement(1)},M=function(){c.cycleElement(0)},K=function(g,k){if(!(la==null||ta)){g||(k*=-1);var H=parseFloat(a("#angle").val())+k;c.setRotationAngle(H);Oa()}},N=function(){},P=function(){var g=s.dimensions;
a.confirm(t.notification.QwantToClear,function(k){if(k){db();c.clear();c.setResolution(g[0],g[1]);eb(true);Ma();qa();Oa();La();c.runExtensions("onNewDocument")}})},ba=function(){c.setBold(!c.getBold());Oa();return false},ha=function(){c.setItalic(!c.getItalic());Oa();return false},ra=function(){a.select("Select an image type for export: ",["PNG","JPEG","BMP","WEBP"],function(g){if(g){if(!v.exportImage&&!v.pngsave){var k=t.notification.loadingImage;Lb=window.open("data:text/html;charset=utf-8,<title>"+
k+"</title><h1>"+k+"</h1>")}var H=parseInt(a("#image-slider").val(),10)/100;window.canvg?c.rasterExport(g,H):a.getScript("canvg/rgbcolor.js",function(){a.getScript("canvg/canvg.js",function(){c.rasterExport(g,H)})})}},function(){var g=a(this);if(g.val()==="JPEG"||g.val()==="WEBP")a("#image-slider").length||a('<div><label>Quality: <input id="image-slider" type="range" min="1" max="100" value="92" /></label></div>').appendTo(g.parent());else a("#image-slider").parent().remove()})},Aa=function(){c.open()},
da=function(){},za=function(){},Da=function(){if(jb.getUndoStackSize()>0){jb.undo();qa()}},fb=function(){if(jb.getRedoStackSize()>0){jb.redo();qa()}},gb=function(){if(ta)c.groupSelectedElements();else la&&c.ungroupSelectedElement()},Gb=function(){c.cloneSelectedElements(20,20)},Rb=function(){var g=this.id.replace("tool_align","").charAt(0);c.alignSelectedElements(g,a("#align_relative_to").val())};a("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"});
var Hb=function(){if(!wa){wa=true;a("#image_save_opts input").val([a.pref("img_save")]);var g=c.getResolution();if(s.baseUnit!=="px"){g.w=svgedit.units.convertUnit(g.w)+s.baseUnit;g.h=svgedit.units.convertUnit(g.h)+s.baseUnit}a("#canvas_width").val(g.w);a("#canvas_height").val(g.h);a("#canvas_title").val(c.getDocumentTitle());a("#svg_docprops").show()}},wc=function(){if(!Wa){Wa=true;a("#main_menu").hide();var g=a("#bg_blocks div"),k=C.bkgd_color,H=a.pref("bkgd_url");g.each(function(){var F=a(this),
O=F.css("background-color")==k;F.toggleClass("cur_background",O);O&&a("#canvas_bg_url").removeClass("cur_background")});k||g.eq(0).addClass("cur_background");H&&a("#canvas_bg_url").val(H);a("#grid_snapping_on").prop("checked",s.gridSnapping);a("#grid_snapping_step").attr("value",s.snappingStep);a("#grid_color").attr("value",s.gridColor);a("#svg_prefs").show()}},ic=function(){a("#svg_source_editor").hide();hb=false;a("#svg_source_textarea").blur()},xc=function(){if(hb){var g=function(){c.clearSelection();
ic();Ma();qa();Fa();La()};c.setSvgString(a("#svg_source_textarea").val())?g():a.confirm(t.notification.QerrorsRevertToSource,function(k){if(!k)return false;g()});db()}},nc=function(){a("#svg_docprops").hide();a("#canvas_width,#canvas_height").removeAttr("disabled");a("#resolution")[0].selectedIndex=0;a("#image_save_opts input").val([a.pref("img_save")]);wa=false},oc=function(){a("#svg_prefs").hide();Wa=false},yc=function(){var g=a("#canvas_title").val();Fa(g);c.setDocumentTitle(g);g=a("#canvas_width");
var k=g.val(),H=a("#canvas_height"),F=H.val();if(k!="fit"&&!svgedit.units.isValidUnit("width",k)){a.alert(t.notification.invalidAttrValGiven);g.parent().addClass("error");return false}g.parent().removeClass("error");if(F!="fit"&&!svgedit.units.isValidUnit("height",F)){a.alert(t.notification.invalidAttrValGiven);H.parent().addClass("error");return false}H.parent().removeClass("error");if(!c.setResolution(k,F)){a.alert(t.notification.noContentToFitTo);return false}a.pref("img_save",a("#image_save_opts :checked").val());
eb();nc()},zc=i.savePreferences=function(){var g=a("#bg_blocks div.cur_background").css("background-color")||"#FFF";T(g,a("#canvas_bg_url").val());g=a("#lang_select").val();g!==a.pref("lang")&&i.putLocale(g,mb);bb(a("#iconsize").val());s.gridSnapping=a("#grid_snapping_on")[0].checked;s.snappingStep=a("#grid_snapping_step").val();s.gridColor=a("#grid_color").val();s.showRulers=a("#show_rulers")[0].checked;a("#rulers").toggle(s.showRulers);s.showRulers&&oa();s.baseUnit=a("#base_unit").val();c.setConfig(s);
eb();oc()},ec=a.noop,pc=function(){a("#dialog_box").hide();if(!hb&&!wa&&!Wa)ob&&c.leaveContext();else{if(hb)vb!==a("#svg_source_textarea").val()?a.confirm(t.notification.QignoreSourceChanges,function(g){g&&ic()}):ic();else if(wa)nc();else Wa&&oc();ec()}},qc={width:a(window).width(),height:a(window).height()};svgedit.browser.isIE()&&function(){ec=function(){if(Z[0].scrollLeft===0&&Z[0].scrollTop===0){Z[0].scrollLeft=rb.left;Z[0].scrollTop=rb.top}};rb={left:Z[0].scrollLeft,top:Z[0].scrollTop};a(window).resize(ec);
i.ready(function(){setTimeout(function(){ec()},500)});Z.scroll(function(){rb={left:Z[0].scrollLeft,top:Z[0].scrollTop}})}();a(window).resize(function(){a.each(qc,function(g,k){var H=a(window)[g]();Z[0]["scroll"+(g==="width"?"Left":"Top")]-=(H-k)/2;qc[g]=H});wb()});(function(){Z.scroll(function(){if(a("#ruler_x").length!=0)a("#ruler_x")[0].scrollLeft=Z[0].scrollLeft;if(a("#ruler_y").length!=0)a("#ruler_y")[0].scrollTop=Z[0].scrollTop})})();a("#url_notice").click(function(){a.alert(this.title)});a("#change_image_url").click(aa);
(function(){var g=["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],k="";a.each(g,function(H,F){k+="#tool_"+F+(H==g.length-1?",":"")});a(k).mousedown(function(){a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")});a("#tool_undo, #tool_redo").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")})})();
if(svgedit.browser.isMac()&&!window.opera){var fc=["tool_bg_img","tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(ya=fc.length;ya--;){var jc=document.getElementById(fc[ya]);if(jc){var kc=jc.title,rc=kc.indexOf("Ctrl+");jc.title=[kc.substr(0,rc),"Cmd+",kc.substr(rc+5)].join("")}}}var sc=function(g){var k=g.attr("id")=="stroke_color"?"stroke":"fill",H=Ta[k].paint,F=k=="stroke"?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity";g=g.offset();a("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",
containment:"window"}).css(s.colorPickerCSS||{left:g.left-140,bottom:40}).jGraduate({paint:H,window:{pickerTitle:F},images:{clientPath:s.jGraduatePath},newstop:"inverse"},function(O){H=new a.jGraduate.Paint(O);Ta[k].setPaint(H);c.setPaint(k,H);a("#color_picker").hide()},function(){a("#color_picker").hide()})};ya=function(g,k){var H,F,O=s[k==="fill"?"initFill":"initStroke"],R=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="16.5" height="16.5"\t\t\t\t\tfill="#'+
O.color+'" opacity="'+O.opacity+'"/>\t\t\t\t\t<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml").documentElement;R=a(g)[0].appendChild(document.importNode(R,true));R.setAttribute("width",16.5);this.rect=R.firstChild;this.defs=R.getElementsByTagName("defs")[0];this.grad=this.defs.firstChild;this.paint=new a.jGraduate.Paint({solidColor:O.color});this.type=k;this.setPaint=function(Y,ga){this.paint=Y;var ja="none",ma=Y.type,ia=Y.alpha/100;switch(ma){case "solidColor":ja=Y[ma]!="none"?"#"+
Y[ma]:Y[ma];break;case "linearGradient":case "radialGradient":this.defs.removeChild(this.grad);this.grad=this.defs.appendChild(Y[ma]);ja="url(#"+(this.grad.id="gradbox_"+this.type)+")"}this.rect.setAttribute("fill",ja);this.rect.setAttribute("opacity",ia);if(ga){c.setColor(this.type,H,true);c.setPaintOpacity(this.type,F,true)}};this.update=function(Y){if(la){var ga,ja,ma=this.type;switch(la.tagName){case "use":case "image":case "foreignObject":return;case "g":case "a":var ia=null,pa=la.getElementsByTagName("*");
ga=0;for(ja=pa.length;ga<ja;ga++){var va=pa[ga].getAttribute(ma);if(ga===0)ia=va;else if(ia!==va){ia=null;break}}if(ia===null){H=null;return}H=ia;F=1;break;default:F=parseFloat(la.getAttribute(ma+"-opacity"));if(isNaN(F))F=1;ga=ma==="fill"?"black":"none";H=la.getAttribute(ma)||ga}if(Y){c.setColor(ma,H,true);c.setPaintOpacity(ma,F,true)}F*=100;this.setPaint(Pb(H,F,ma))}};this.prep=function(){switch(this.paint.type){case "linearGradient":case "radialGradient":var Y=new a.jGraduate.Paint({copy:this.paint});
c.setPaint(k,Y)}}};Ta.fill=new ya("#fill_color","fill");Ta.stroke=new ya("#stroke_color","stroke");a("#stroke_width").val(s.initStroke.width);a("#group_opacity").val(s.initOpacity*100);ya=Ta.fill.rect.cloneNode(false);ya.setAttribute("style","vector-effect:non-scaling-stroke");Zb=ya.style.vectorEffect==="non-scaling-stroke";ya.removeAttribute("style");ya=Ta.fill.rect.ownerDocument.createElementNS(svgedit.NS.SVG,"feGaussianBlur");ya.stdDeviationX===undefined&&a("#tool_blur").hide();a(ya).remove();
(function(){var g="-"+ib.toLowerCase()+"-zoom-",k=g+"in";Z.css("cursor",k);if(Z.css("cursor")===k){tb=k;Mb=g+"out"}Z.css("cursor","auto")})();setTimeout(function(){c.embedImage("images/logo.png",function(g){if(!g){a("#image_save_opts [value=embed]").attr("disabled","disabled");a("#image_save_opts input").val(["ref"]);a.pref("img_save","ref");a("#image_opt_embed").css("color","#666").attr("title",t.notification.featNotSupported)}})},1E3);a("#fill_color, #tool_fill .icon_label").click(function(){sc(a("#fill_color"));
Fb()});a("#stroke_color, #tool_stroke .icon_label").click(function(){sc(a("#stroke_color"));Fb()});a("#group_opacityLabel").click(function(){a("#opacity_dropdown button").mousedown();a(window).mouseup()});a("#zoomLabel").click(function(){a("#zoom_dropdown button").mousedown();a(window).mouseup()});a("#tool_move_top").mousedown(function(g){a("#tools_stacking").show();g.preventDefault()});a(".layer_button").mousedown(function(){a(this).addClass("layer_buttonpressed")}).mouseout(function(){a(this).removeClass("layer_buttonpressed")}).mouseup(function(){a(this).removeClass("layer_buttonpressed")});
a(".push_button").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){a(this).removeClass("push_button_pressed").addClass("push_button")});a("#layer_new").click(function(){var g,k=c.getCurrentDrawing().getNumLayers();do g=t.layers.layer+" "+ ++k;while(c.getCurrentDrawing().hasLayer(g));a.prompt(t.notification.enterUniqueLayerName,
g,function(H){if(H)if(c.getCurrentDrawing().hasLayer(H))a.alert(t.notification.dupeLayerName);else{c.createLayer(H);Oa();qa()}})});a("#layer_delete").click(ea);a("#layer_up").click(function(){ka(-1)});a("#layer_down").click(function(){ka(1)});a("#layer_rename").click(function(){var g=a("#layerlist tr.layersel td.layername").text();a.prompt(t.notification.enterNewLayerName,"",function(k){if(k)if(g==k||c.getCurrentDrawing().hasLayer(k))a.alert(t.notification.layerHasThatName);else{c.renameCurrentLayer(k);
qa()}})});var Tb=-1,gc=false,lc=false,tc=function(g){var k=a("#ruler_x");a("#sidepanels").width("+="+g);a("#layerpanel").width("+="+g);k.css("right",parseInt(k.css("right"),10)+g);Z.css("right",parseInt(Z.css("right"),10)+g);c.runExtensions("workareaResized")},uc=function(g){if(lc)if(Tb!=-1){gc=true;g=Tb-g.pageX;var k=a("#sidepanels").width();if(k+g>300)g=300-k;else if(k+g<2)g=2-k;if(g!=0){Tb-=g;tc(g)}}},mc=function(g){var k=a("#sidepanels").width();tc((k>2||g?2:150)-k)};a("#sidepanel_handle").mousedown(function(g){Tb=
g.pageX;a(window).mousemove(uc);lc=false;setTimeout(function(){lc=true},20)}).mouseup(function(){gc||mc();Tb=-1;gc=false});a(window).mouseup(function(){Tb=-1;gc=false;a("#svg_editor").unbind("mousemove",uc)});qa();a(window).bind("load resize",function(){Z.css("line-height",Z.height()+"px")});a("#resolution").change(function(){var g=a("#canvas_width,#canvas_height");if(this.selectedIndex)if(this.value=="content")g.val("fit").attr("disabled","disabled");else{var k=this.value.split("x");a("#canvas_width").val(k[0]);
a("#canvas_height").val(k[1]);g.removeAttr("disabled")}else a("#canvas_width").val()=="fit"&&g.removeAttr("disabled").val(100)});a("input,select").attr("autocomplete","off");Cb=function(){var g=[{sel:"#tool_select",fn:pb,evt:"click",key:["V",true]},{sel:"#tool_square",fn:Sb,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:hc,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_circle",fn:yb,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",
fn:bc,evt:"mouseup",parent:"#tools_ellipse",icon:"fh_ellipse"},{sel:"#tool_path",fn:b,evt:"click",key:["P",true]},{sel:"#tool_image",fn:ac,evt:"mouseup"},{sel:"#tool_zoom",fn:zb,evt:"mouseup",key:["Z",true]},{sel:"#tool_clear",fn:P,evt:"mouseup",key:["N",true]},{sel:"#tool_bg_img",fn:N,evt:"mouseup"},{sel:"#tool_update",fn:Ub,evt:"mouseup",key:["S",true]},{sel:"#tool_export",fn:ra,evt:"mouseup"},{sel:"#tool_open",fn:Aa,evt:"mouseup",key:["O",true]},{sel:"#tool_import",fn:da,evt:"mouseup"},{sel:"#tool_import_bg",
fn:za,evt:"mouseup"},{sel:"#tool_source",fn:kb,evt:"click",key:["U",true]},{sel:"#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:pc,evt:"click",key:["esc",false,false],hidekey:true},{sel:"#tool_source_save",fn:xc,evt:"click"},{sel:"#tool_docprops_save",fn:yc,evt:"click"},{sel:"#tool_docprops",fn:Hb,evt:"mouseup"},{sel:"#tool_prefs_save",fn:zc,evt:"click"},{sel:"#tool_prefs_option",fn:function(){wc();return false},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:f,
evt:"click",key:["del/backspace",true]},{sel:"#tool_reorient",fn:L,evt:"click"},{sel:"#tool_node_link",fn:X,evt:"click"},{sel:"#tool_node_clone",fn:S,evt:"click"},{sel:"#tool_node_delete",fn:Q,evt:"click"},{sel:"#tool_openclose_path",fn:ca,evt:"click"},{sel:"#tool_add_subpath",fn:U,evt:"click"},{sel:"#tool_move_top",fn:m,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:u,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",fn:B,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:G,
evt:"click"},{sel:"#tool_undo",fn:Da,evt:"click",key:["Z",true]},{sel:"#tool_redo",fn:fb,evt:"click",key:["Y",true]},{sel:"#tool_clone,#tool_clone_multi",fn:Gb,evt:"click",key:["D",true]},{sel:"#tool_group_elements",fn:gb,evt:"click",key:["G",true]},{sel:"#tool_ungroup",fn:gb,evt:"click"},{sel:"#tool_unlink_use",fn:gb,evt:"click"},{sel:"[id^=tool_align]",fn:Rb,evt:"click"},{sel:"#tool_bold",fn:ba,evt:"mousedown"},{sel:"#tool_italic",fn:ha,evt:"mousedown"},{sel:"#sidepanel_handle",fn:mc,key:["X"]},
{sel:"#copy_save_done",fn:pc,evt:"click"},{key:"ctrl+left",fn:function(){K(0,1)}},{key:"ctrl+right",fn:function(){K(1,1)}},{key:"ctrl+shift+left",fn:function(){K(0,5)}},{key:"ctrl+shift+right",fn:function(){K(1,5)}},{key:"shift+O",fn:M},{key:"shift+P",fn:V},{key:[Va+"up",true],fn:function(){Ma(2)}},{key:[Va+"down",true],fn:function(){Ma(0.5)}},{key:[Va+"]",true],fn:function(){w("Up")}},{key:[Va+"[",true],fn:function(){w("Down")}},{key:["up",true],fn:function(){E(0,-1)}},{key:["down",true],fn:function(){E(0,
1)}},{key:["left",true],fn:function(){E(-1,0)}},{key:["right",true],fn:function(){E(1,0)}},{key:"shift+up",fn:function(){E(0,-10)}},{key:"shift+down",fn:function(){E(0,10)}},{key:"shift+left",fn:function(){E(-10,0)}},{key:"shift+right",fn:function(){E(10,0)}},{key:["alt+up",true],fn:function(){c.cloneSelectedElements(0,-1)}},{key:["alt+down",true],fn:function(){c.cloneSelectedElements(0,1)}},{key:["alt+left",true],fn:function(){c.cloneSelectedElements(-1,0)}},{key:["alt+right",true],fn:function(){c.cloneSelectedElements(1,
0)}},{key:["alt+shift+up",true],fn:function(){c.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",true],fn:function(){c.cloneSelectedElements(0,10)}},{key:["alt+shift+left",true],fn:function(){c.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",true],fn:function(){c.cloneSelectedElements(10,0)}},{key:"A",fn:function(){c.selectAllInCurrentLayer()}},{key:Va+"z",fn:Da},{key:Va+"shift+z",fn:fb},{key:Va+"y",fn:fb},{key:Va+"x",fn:d},{key:Va+"c",fn:o},{key:Va+"v",fn:n}],k={"4/Shift+4":"#tools_rect_show",
"5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var H={};a.each(g,function(F,O){var R;if(O.sel){R=a(O.sel);if(R.length==0)return true;if(O.evt){if(svgedit.browser.isTouch()&&O.evt==="click")O.evt="mousedown";R[O.evt](O.fn)}if(O.parent&&a(O.parent+"_show").length!=0){var Y=a(O.parent);Y.length||(Y=Wb(O.parent.substr(1)));Y.append(R);a.isArray(H[O.parent])||(H[O.parent]=[]);H[O.parent].push(O)}}if(O.key){var ga=O.fn,ja=false;if(a.isArray(O.key)){Y=O.key[0];if(O.key.length>1)ja=O.key[1]}else Y=
O.key;Y+="";a.each(Y.split("/"),function(ia,pa){a(document).bind("keydown",pa,function(va){ga();ja&&va.preventDefault();return false})});if(O.sel&&!O.hidekey&&R.attr("title")){var ma=R.attr("title").split("[")[0]+" ("+Y+")";k[Y]=O.sel;R.parents("#main_menu").length||R.attr("title",ma)}}});$b(H);a(".attr_changer, #image_url").bind("keydown","return",function(F){a(this).change();F.preventDefault()});a(window).bind("keydown","tab",function(F){if(sb==="canvas"){F.preventDefault();V()}}).bind("keydown",
"shift+tab",function(F){if(sb==="canvas"){F.preventDefault();M()}});a("#tool_zoom").dblclick(Xb)},setTitles:function(){a.each(k,function(H,F){var O=a(F).parents("#main_menu").length;a(F).each(function(){var R;R=O?a(this).text().split(" [")[0]:this.title.split(" [")[0];var Y="";a.each(H.split("/"),function(ga,ja){var ma=ja.split("+"),ia="";if(ma.length>1){ia=ma[0]+"+";ja=ma[1]}Y+=(ga?"/":"")+ia+(t["key_"+ja]||ja)});if(O)this.lastChild.textContent=R+" ["+Y+"]";else this.title=R+" ["+Y+"]"})})},getButtonData:function(H){var F;
a.each(g,function(O,R){if(R.sel===H)F=R});return F}}}();Cb.setAll();i.ready(function(){var g=s.initTool,k=a("#tools_left, #svg_editor .tools_flyout"),H=k.find("#tool_"+g);g=k.find("#"+g);(H.length?H:g.length?g:a("#tool_select")).click().mouseup();s.wireframe&&a("#tool_wireframe").click();s.showlayers&&mc();a("#rulers").toggle(!!s.showRulers);if(s.showRulers)a("#show_rulers")[0].checked=true;s.baseUnit&&a("#base_unit").val(s.baseUnit);if(s.gridSnapping)a("#grid_snapping_on")[0].checked=true;s.snappingStep&&
a("#grid_snapping_step").val(s.snappingStep);s.gridColor&&a("#grid_color").val(s.gridColor)});a("#rect_rx").SpinButton({min:0,max:1E3,callback:function(g){c.setRectRadius(g.value)}});a("#stroke_width").SpinButton({min:0,max:99,smallStep:0.1,callback:function(g){var k=g.value;if(k==0&&la&&["line","polyline"].indexOf(la.nodeName)>=0)k=g.value=1;c.setStrokeWidth(k)}});a("#angle").SpinButton({min:-180,max:180,step:5,callback:function(g){c.setRotationAngle(g.value);a("#tool_reorient").toggleClass("disabled",
parseInt(g.value,10)===0)}});a("#font_size").SpinButton({min:0.001,stepfunc:function(g,k){var H=Number(g.value),F=H+k,O=F>=H;if(k===0)return H;if(H>=24){if(O)return Math.round(H*1.1);return Math.round(H/1.1)}if(H<=1){if(O)return H*2;return H/2}return F},callback:function(g){c.setFontSize(g.value)}});a("#group_opacity").SpinButton({min:0,max:100,step:5,callback:Db});a("#blur").SpinButton({min:0,max:10,step:0.1,callback:Jb});a("#zoom").SpinButton({min:0.001,max:1E4,step:50,stepfunc:function(g,k){var H=
Number(g.value);if(H===0)return 100;var F=H+k;if(k===0)return H;if(H>=100)return F;if(F>=H)return H*2;return H/2},callback:Kb}).val(c.getZoom()*100);a("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(g){switch(g){case "delete":f();break;case "cut":d();break;case "copy":o();break;case "paste":c.pasteElements();break;case "paste_in_place":c.pasteElements("in_place");break;case "group_elements":c.groupSelectedElements();break;case "ungroup":c.ungroupSelectedElement();break;case "move_front":m();
break;case "move_up":w("Up");break;case "move_down":w("Down");break;case "move_back":u();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(g)&&svgedit.contextmenu.getCustomHandler(g).call()}c.clipBoard.length&&nb.enableContextMenuItems("#paste,#paste_in_place")});ya=function(g){switch(g){case "dupe":fa();break;case "delete":ea();break;case "merge_down":if(a("#layerlist tr.layersel").index()!=c.getCurrentDrawing().getNumLayers()-1){c.mergeLayer();Oa();qa()}break;case "merge_all":c.mergeAllLayers();
Oa();qa()}};a("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},ya);a("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:true},ya);a(".contextMenu li").mousedown(function(g){g.preventDefault()});a("#cmenu_canvas li").disableContextMenu();nb.enableContextMenuItems("#delete,#cut,#copy");window.addEventListener("beforeunload",function(g){if(jb.getUndoStackSize()===0)i.showSaveWarning=false;if(!s.no_save_warning&&i.showSaveWarning)return g.returnValue=t.notification.unsavedChanges},
false);i.openPrep=function(g){a("#main_menu").hide();jb.getUndoStackSize()===0?g(true):a.confirm(t.notification.QwantToOpen,g)};if(window.FileReader){ya=function(g){g.stopPropagation();g.preventDefault();a("#workarea").removeAttr("style");a("#main_menu").hide();if(g=g.type=="drop"?g.dataTransfer.files[0]:this.files[0])if(g.type.indexOf("image")!=-1){var k;if(g.type.indexOf("svg")!=-1){k=new FileReader;k.onloadend=function(H){c.importAtlasSvgString(H.target.result,true);c.alignSelectedElements("m",
"page");c.alignSelectedElements("c","page")};k.readAsText(g)}else{k=new FileReader;k.onloadend=function(H){var F=100,O=100,R=new Image;R.src=H.target.result;R.style.opacity=0;R.onload=function(){F=R.offsetWidth;O=R.offsetHeight;var Y=c.addSvgElementFromJson({element:"image",attr:{x:0,y:0,width:F,height:O,id:c.getNextId(),style:"pointer-events:inherit"}});c.setHref(Y,H.target.result);c.selectOnly([Y]);c.alignSelectedElements("m","page");c.alignSelectedElements("c","page");Oa()}};k.readAsDataURL(g)}}};
Z[0].addEventListener("dragenter",Ia,false);Z[0].addEventListener("dragover",Ba,false);Z[0].addEventListener("dragleave",Ab,false);Z[0].addEventListener("drop",ya,false);fc=a('<input type="file">').change(function(){alert("running");P();var g=this;i.openPrep(function(k){if(k){c.clear();if(g.files.length===1){a.process_cancel(t.notification.loadingImage);k=new FileReader;k.onloadend=function(H){J(H.target.result);eb()};k.readAsText(g.files[0])}}})});a("#tool_open").show().prepend(fc);var vc=a('<input style="display: none;" type="file">').change(ya),
Ac=a('<input style="display: none;" type="file">').change(function(g){g.stopPropagation();g.preventDefault();a("#workarea").removeAttr("style");a("#main_menu").hide();if(g=g.type=="drop"?g.dataTransfer.files[0]:this.files[0])if(g.type.indexOf("image")!=-1){var k=new FileReader;k.onloadend=function(H){var F=new Image;F.src=H.target.result;F.style.opacity=0;F.onload=function(){var O=c.getResolution();if(O.w===0||O.h===0){db();c.clear();c.setResolution(F.width,F.height);eb(true);Ma();qa();Oa();La()}c.setAtlasBackground("#fff",
F)}};k.readAsDataURL(g)}});a("#tool_import").click(function(){var g=s.dimensions;a.confirm(t.notification.elemImport,function(k){if(k){db();c.clear();c.setResolution(g[0],g[1]);eb(true);Ma();qa();Oa();La();c.runExtensions("onNewDocument");vc.click()}})});a("#tool_import_bg").click(function(){Ac.click()});a("#tool_import").show();a("#tool_import_bg").show();a("body").prepend(vc)}else alert("HTML5 File Reader Features not support !");eb(true);a(function(){window.svgCanvas=c;c.ready=i.ready});i.setLang=
function(g,k){i.langChanged=true;a.pref("lang",g);a("#lang_select").val(g);if(k){var H=a("#layerlist tr.layersel td.layername").text()==t.common.layer+" 1";a.extend(t,k);c.setUiStrings(k);Cb.setTitles();if(H){c.renameCurrentLayer(t.common.layer+" 1");qa()}if(qb.length)for(;qb.length;)qb.shift().langReady({lang:g,uiStrings:t});else c.runExtensions("langReady",{lang:g,uiStrings:t});c.runExtensions("langChanged",g);Qb();a.each({"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block",
"#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"},function(F,O){a(O).attr("title",a(F)[0].title)});a("#multiselected_panel div[id^=tool_align]").each(function(){a("#tool_pos"+this.id.substr(10))[0].title=this.title})}}};i.ready=function(j){h?j():r.push(j)};i.runCallbacks=function(){a.each(r,function(){this()});h=true};i.loadFromString=function(j){i.ready(function(){J(j)})};i.loadFromAtlasString=function(j){i.ready(function(){A(j);c.zoomChanged(window,"layer")})};i.disableUI=function(){};
i.loadFromURL=function(j,I){I||(I={});var T=I.cache,aa=I.callback;i.ready(function(){a.ajax({url:j,dataType:"text",cache:!!T,beforeSend:function(){a.process_cancel(t.notification.loadingImage)},success:function(oa){c.importAtlasSvgString(oa,true)},error:function(oa,ea,fa){oa.status!=404&&oa.responseText?J(oa.responseText,aa):a.alert(t.notification.URLloadFail+": \n"+fa,aa)},complete:function(){a("#dialog_box").hide()}})})};i.loadFromDataURI=function(j){i.ready(function(){var I=j.substring(26);J(e.decode64(I))})};
i.addExtension=function(){var j=arguments;a(function(){c&&c.addExtension.apply(this,j)})};return i}(jQuery);$(svgEditor.init)}})();var svgEditor=function(a,J){function A(c,p,e){var h,r,v,D,C,s=a("#svg_editor").parent();for(r in p){(v=p[r])||console.log(r);if(e)r="#"+r;h=s.find(r);if(h.length){D=s.find(r)[0];switch(c){case "content":for(h=0;h<D.childNodes.length;h++){C=D.childNodes[h];if(C.nodeType===3&&C.textContent.replace(/\s/g,"")){C.textContent=v;break}}break;case "title":D.title=v}}else console.log("Missing: "+r)}}var i;J.readLang=function(c){var p=J.canvas.runExtensions("addlangData",i,true);a.each(p,function(z,t){if(t.data)c=
a.merge(c,t.data)});if(c.tools){var e=c.tools;p=c.properties;var h=c.config,r=c.layers,v=c.common,D=c.ui;A("content",{curve_segments:p.curve_segments,fitToContent:e.fitToContent,fit_to_all:e.fit_to_all,fit_to_canvas:e.fit_to_canvas,fit_to_layer_content:e.fit_to_layer_content,fit_to_sel:e.fit_to_sel,icon_large:h.icon_large,icon_medium:h.icon_medium,icon_small:h.icon_small,icon_xlarge:h.icon_xlarge,image_opt_embed:h.image_opt_embed,image_opt_ref:h.image_opt_ref,includedImages:h.included_images,largest_object:e.largest_object,
layersLabel:r.layers,page:e.page,relativeToLabel:e.relativeTo,selLayerLabel:r.move_elems_to,selectedPredefined:h.select_predefined,selected_objects:e.selected_objects,smallest_object:e.smallest_object,straight_segments:p.straight_segments,svginfo_bg_url:h.editor_img_url+":",svginfo_bg_note:h.editor_bg_note,svginfo_change_background:h.background,svginfo_dim:h.doc_dims,svginfo_editor_prefs:h.editor_prefs,svginfo_height:v.height,svginfo_icons:h.icon_size,svginfo_image_props:h.image_props,svginfo_lang:h.language,
svginfo_title:h.doc_title,svginfo_width:v.width,tool_docprops_cancel:v.cancel,tool_docprops_save:v.ok,tool_source_cancel:v.cancel,tool_source_save:v.ok,tool_prefs_cancel:v.cancel,tool_prefs_save:v.ok,sidepanel_handle:r.layers.split("").join(" "),tool_clear:e.new_doc,tool_docprops:e.docprops,tool_export:e.export_img,tool_import:e.import_doc,tool_imagelib:e.imagelib,tool_open:e.open_doc,tool_save:e.save_doc,svginfo_units_rulers:h.units_and_rulers,svginfo_rulers_onoff:h.show_rulers,svginfo_unit:h.base_unit,
svginfo_grid_settings:h.grid,svginfo_snap_onoff:h.snapping_onoff,svginfo_snap_step:h.snapping_stepsize,svginfo_grid_color:h.grid_color},true);var C,s={};for(C in c.shape_cats)s['#shape_cats [data-cat="'+C+'"]']=c.shape_cats[C];setTimeout(function(){A("content",s)},2E3);var q={};a.each(["cut","copy","paste","paste_in_place","delete","group","ungroup","move_front","move_up","move_down","move_back"],function(){q['#cmenu_canvas a[href="#'+this+'"]']=e[this]});a.each(["dupe","merge_down","merge_all"],
function(){q['#cmenu_layers a[href="#'+this+'"]']=r[this]});q['#cmenu_layers a[href="#delete"]']=r.del;A("content",q);A("title",{align_relative_to:e.align_relative_to,circle_cx:p.circle_cx,circle_cy:p.circle_cy,circle_r:p.circle_r,cornerRadiusLabel:p.corner_radius,ellipse_cx:p.ellipse_cx,ellipse_cy:p.ellipse_cy,ellipse_rx:p.ellipse_rx,ellipse_ry:p.ellipse_ry,fill_color:p.fill_color,font_family:p.font_family,idLabel:p.id,image_height:p.image_height,image_url:p.image_url,image_width:p.image_width,layer_delete:r.del,
layer_down:r.move_down,layer_new:r["new"],layer_rename:r.rename,layer_moreopts:v.more_opts,layer_up:r.move_up,line_x1:p.line_x1,line_x2:p.line_x2,line_y1:p.line_y1,line_y2:p.line_y2,linecap_butt:p.linecap_butt,linecap_round:p.linecap_round,linecap_square:p.linecap_square,linejoin_bevel:p.linejoin_bevel,linejoin_miter:p.linejoin_miter,linejoin_round:p.linejoin_round,main_icon:e.main_menu,mode_connect:e.mode_connect,tools_shapelib_show:e.mode_shapelib,palette:D.palette_info,zoom_panel:D.zoom_level,
path_node_x:p.node_x,path_node_y:p.node_y,rect_height_tool:p.rect_height,rect_width_tool:p.rect_width,seg_type:p.seg_type,selLayerNames:r.move_selected,selected_x:p.pos_x,selected_y:p.pos_y,stroke_color:p.stroke_color,stroke_style:p.stroke_style,stroke_width:p.stroke_width,svginfo_title:h.doc_title,text:p.text_contents,toggle_stroke_tools:D.toggle_stroke_tools,tool_add_subpath:e.add_subpath,tool_alignbottom:e.align_bottom,tool_aligncenter:e.align_center,tool_alignleft:e.align_left,tool_alignmiddle:e.align_middle,
tool_alignright:e.align_right,tool_aligntop:e.align_top,tool_angle:p.angle,tool_blur:p.blur,tool_bold:p.bold,tool_circle:e.mode_circle,tool_clone:e.clone,tool_clone_multi:e.clone,tool_delete:e.del,tool_delete_multi:e.del,tool_ellipse:e.mode_ellipse,tool_eyedropper:e.mode_eyedropper,tool_fhellipse:e.mode_fhellipse,tool_fhpath:e.mode_fhpath,tool_fhrect:e.mode_fhrect,tool_font_size:p.font_size,tool_group_elements:e.group_elements,tool_make_link:e.make_link,tool_link_url:e.set_link_url,tool_image:e.mode_image,
tool_italic:p.italic,tool_line:e.mode_line,tool_move_bottom:e.move_bottom,tool_move_top:e.move_top,tool_node_clone:e.node_clone,tool_node_delete:e.node_delete,tool_node_link:e.node_link,tool_opacity:p.opacity,tool_openclose_path:e.openclose_path,tool_path:e.mode_path,tool_position:e.align_to_page,tool_rect:e.mode_rect,tool_redo:e.redo,tool_reorient:e.reorient_path,tool_select:e.mode_select,tool_source:e.source_save,tool_update:e.update,tool_square:e.mode_square,tool_text:e.mode_text,tool_topath:e.to_path,
tool_undo:e.undo,tool_ungroup:e.ungroup,tool_wireframe:e.wireframe_mode,view_grid:e.toggle_grid,tool_zoom:e.mode_zoom,url_notice:e.no_embed},true);J.setLang(i,c)}};J.putLocale=function(c,p){if(c)i=c;else{i=a.pref("lang");if(!i){if(navigator.userLanguage)i=navigator.userLanguage;else if(navigator.language)i=navigator.language;if(i==null)return}console.log("Lang: "+i);if(a.inArray(i,p)===-1&&i!=="test")i="en"}var e=J.curConfig.langPath+"lang."+i+".js";a.getScript(e,function(h){if(!h){h=document.createElement("script");
h.src=e;document.querySelector("head").appendChild(h)}})};return J}(jQuery,svgEditor);svgedit=svgedit||{};
(function(){var a=this;if(!svgedit.contextmenu)svgedit.contextmenu={};a.contextMenuExtensions={};svgEditor.ready(function(){for(var J in contextMenuExtensions){var A=contextMenuExtensions[J];Object.keys(a.contextMenuExtensions).length===0&&$("#cmenu_canvas").append("<li class='separator'>");var i=A.shortcut||"";$("#cmenu_canvas").append("<li class='disabled'><a href='#"+A.id+"'>"+A.label+"<span class='shortcut'>"+i+"</span></a></li>")}});svgedit.contextmenu.resetCustomMenus=function(){a.contextMenuExtensions={}};
svgedit.contextmenu.add=function(J){if(J&&J.id&&J.label&&J.action&&typeof J.action=="function")if(J.id in a.contextMenuExtensions)console.error('Cannot add extension "'+J.id+'", an extension by that name already exists"');else{console.log("Registed contextmenu item: {id:"+J.id+", label:"+J.label+"}");a.contextMenuExtensions[J.id]=J}else console.error("Menu items must be defined and have at least properties: id, label, action, where action must be a function")};svgedit.contextmenu.hasCustomHandler=
function(J){return a.contextMenuExtensions[J]&&true};svgedit.contextmenu.getCustomHandler=function(J){return a.contextMenuExtensions[J].action}})();
