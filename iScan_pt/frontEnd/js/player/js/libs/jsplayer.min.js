function patchOptimizations(e,a){var i=getGlobalScope();for(var n in a){var r=a[n];if(r){var t=e[n];t||(t="original"),console.info(n+": "+t),assert(t in r.options);var o=r.options[t].fn;o&&(i[r.original]=Module.patch(null,r.name,o),console.info("Patching: "+r.name+", with: "+t))}}}function getGlobalScope(){return function(){return this}.call(null)}function clip(e,a,i){return e>i?e:i>a?a:i}function OptimizedGetBoundaryStrengthsA(e,a){var i=e+28,n=HEAP16[i+0>>1],r=HEAP16[i+2>>1],t=HEAP16[i+4>>1],o=HEAP16[i+6>>1],l=HEAP16[i+8>>1],s=HEAP16[i+10>>1],d=HEAP16[i+12>>1],u=HEAP16[i+14>>1],p=HEAP16[i+16>>1],c=HEAP16[i+18>>1],y=HEAP16[i+20>>1],f=HEAP16[i+22>>1],P=HEAP16[i+24>>1],A=HEAP16[i+26>>1],H=HEAP16[i+28>>1],E=HEAP16[i+30>>1];HEAP32[a+32>>2]=t||n?2:0,HEAP32[a+40>>2]=o||r?2:0,HEAP32[a+48>>2]=d||l?2:0,HEAP32[a+56>>2]=u||s?2:0,HEAP32[a+64>>2]=p||t?2:0,HEAP32[a+72>>2]=c||o?2:0,HEAP32[a+80>>2]=P||d?2:0,HEAP32[a+88>>2]=A||u?2:0,HEAP32[a+96>>2]=y||p?2:0,HEAP32[a+104>>2]=f||c?2:0,HEAP32[a+112>>2]=H||P?2:0,HEAP32[a+120>>2]=E||A?2:0,HEAP32[a+12>>2]=r||n?2:0,HEAP32[a+20>>2]=l||r?2:0,HEAP32[a+28>>2]=s||l?2:0,HEAP32[a+44>>2]=o||t?2:0,HEAP32[a+52>>2]=d||o?2:0,HEAP32[a+60>>2]=u||d?2:0,HEAP32[a+76>>2]=c||p?2:0,HEAP32[a+84>>2]=P||c?2:0,HEAP32[a+92>>2]=A||P?2:0,HEAP32[a+108>>2]=f||y?2:0,HEAP32[a+116>>2]=H||f?2:0,HEAP32[a+124>>2]=E||H?2:0}function OptimizedFilterVerLumaEdge(e,a,i,n){var r,t,o,l,s,d,u,p,c,y,f=_h264bsdClip+512,P=HEAP32[i+4>>2],A=HEAP32[i+8>>2];if(4>a){o=t=255&HEAPU8[HEAP32[i>>2]+(a-1)];for(var H=4;H>0;H--)d=255&HEAPU8[e+-2],l=255&HEAPU8[e+-1],s=255&HEAPU8[e],u=255&HEAPU8[e+1],Math.abs(l-s)<P&&Math.abs(d-l)<A&&Math.abs(u-s)<A&&(p=255&HEAPU8[e-3],Math.abs(p-l)<A&&(y=p+(l+s+1>>1)-(d<<1)>>1,HEAP8[e-2]=d+clip(-t,t,y),o++),c=255&HEAPU8[e+2],Math.abs(c-s)<A&&(y=c+(l+s+1>>1)-(u<<1)>>1,HEAP8[e+1]=u+clip(-t,t,y),o++),y=(s-l<<2)+(d-u)+4>>3,r=clip(-o,o,y),l=255&HEAPU8[f+(l+r)],s=255&HEAPU8[f+(s-r)],o=t,HEAP8[e-1]=l,HEAP8[e]=s,e+=n)}else OriginalFilterVerLumaEdge(e,a,i,n)}function OptimizedFilterHorLuma(e,a,i,n){var r,t,o,l,s,d,u,p,c,y,f=_h264bsdClip+512,P=HEAP32[i+4>>2],A=HEAP32[i+8>>2];if(4>a){o=t=255&HEAPU8[HEAP32[i>>2]+(a-1)];for(var H=16;H>0;H--)d=255&HEAPU8[e+(-n<<1)],l=255&HEAPU8[e+-n],s=255&HEAPU8[e],u=255&HEAPU8[e+n],Math.abs(l-s)<P&&Math.abs(d-l)<A&&Math.abs(u-s)<A&&(p=255&HEAPU8[e+3*-n],Math.abs(p-l)<A&&(y=p+(l+s+1>>1)-(d<<1)>>1,HEAP8[e+(-n<<1)]=d+clip(-t,t,y),o++),c=255&HEAPU8[e+(n<<2)],Math.abs(c-s)<A&&(y=c+(l+s+1>>1)-(u<<1)>>1,HEAP8[e+n]=u+clip(-t,t,y),o++),y=(s-l<<2)+(d-u)+4>>3,r=clip(-o,o,y),l=255&HEAPU8[f+(l+r)],s=255&HEAPU8[f+(s-r)],o=t,HEAP8[e-n]=l,HEAP8[e]=s,e++)}else OriginalFilterHorLuma(e,a,i,n)}function yr(e,a,i,n){for(var r=0,t=a*i,o=a*i+a*i/4,l=0;i-8>l;l++)for(var s=0;a>s;s++){var d=s+l*a+r,u=(s>>1)+(l>>1)*a/2+t,p=(s>>1)+(l>>1)*a/2+o,c=e[d],y=e[u]-128,f=e[p]-128,P=c+1.371*f,A=c-.698*f-.336*y,H=c+1.732*y;op=4*s+a*l*4,n[0+op]=P,n[1+op]=A,n[2+op]=H,n[3+op]=255}}function error(e){console.error(e),console.trace()}function assert(e,a){e||error(a)}function isPowerOfTwo(e){return 0==(e&e-1)}function text(e){return e.join("\n")}function nextHighestPowerOfTwo(e){--e;for(var a=1;32>a;a<<=1)e|=e>>a;return e+1}function inherit(e,a){var i=Object.create(e.prototype);for(var n in a)i[n]=a[n];return i}var cachedModules=[];assert(Module),HEAP8=Module.HEAP8,HEAPU8=Module.HEAPU8,HEAP16=Module.HEAP16,HEAP32=Module.HEAP32,_h264bsdClip=Module._get_h264bsdClip();var _broadwayOnHeadersDecoded,_broadwayOnPictureDecoded,Avc=function(){function e(){Module._broadwayInit(),this.streamBuffer=a(Module._broadwayCreateStream(i),i),this.pictureBuffers={},this.onPictureDecoded=function(){},_broadwayOnHeadersDecoded=function(){},_broadwayOnPictureDecoded=function(e,i,n){var r=this.pictureBuffers[e];r||(r=this.pictureBuffers[e]=a(e,i*n*3/2)),this.onPictureDecoded(r,i,n)}.bind(this)}function a(e,a){return HEAPU8.subarray(e,e+a)}const i=1048576;return e.prototype={decode:function(e){this.streamBuffer.set(e),Module._broadwaySetStreamLength(e.length),Module._broadwayPlayStream()},configure:function(e){console.info("Broadway Configured: "+JSON.stringify(e))}},e}(),patches={filter:{name:"_h264bsdFilterPicture",display:"Filter Picture",original:"Original_h264bsdFilterPicture",options:{none:{display:"None",fn:function(){}},original:{display:"Original",fn:null}}},filterHorLuma:{name:"_FilterHorLuma",display:"Filter Hor Luma",original:"OriginalFilterHorLuma",options:{none:{display:"None",fn:function(){}},original:{display:"Original",fn:null},optimized:{display:"Optimized",fn:OptimizedFilterHorLuma}}},filterVerLumaEdge:{name:"_FilterVerLumaEdge",display:"Filter Ver Luma Edge",original:"OriginalFilterVerLumaEdge",options:{none:{display:"None",fn:function(){}},original:{display:"Original",fn:null},optimized:{display:"Optimized",fn:OptimizedFilterVerLumaEdge}}},getBoundaryStrengthsA:{name:"_GetBoundaryStrengthsA",display:"Get Boundary Strengths",original:"OriginalGetBoundaryStrengthsA",options:{none:{display:"None",fn:function(){}},original:{display:"Original",fn:null},optimized:{display:"Optimized",fn:OptimizedGetBoundaryStrengthsA}}}},flag=0,jsplayer={login:function(e,a,i){jsplayer._nalBuffer=new Array,jsplayer._lastSeq=null,jsplayer._cid=a,jsplayer._pwd=i,jsplayer._is_v_arv=!1,jsplayer._avc=new Avc,jsplayer._avc.onPictureDecoded=jsplayer._onPictureDecoded,jsplayer._videoObj=e,e.width=720,e.height=480,jsplayer._videoData=null,jsplayer._videoContext=null,jsplayer._jitterBuffer=new Uint8Array(24576),jsplayer._jitterLength=0,jsplayer.mediaSocket=new WebSocket("ws://218.206.129.156:19091"),jsplayer.mediaSocket.onopen=jsplayer._onOpen,jsplayer.mediaSocket.onmessage=jsplayer._onMessage,jsplayer.mediaSocket.onclose=jsplayer._onClose},play:function(){jsplayer.mediaSocket.send("play::"+jsplayer._cid+"::"+jsplayer._pwd)},stop:function(){jsplayer.mediaSocket.close(),jsplayer._is_v_arv=!1,jsplayer._videoObj.width=jsplayer._videoObj.width},Post:function(e,a,i){jsplayer.mediaSocket.send(e+"::"+a+"::"+i)},_onOpen:function(){jsplayer.mediaSocket.send("login::"+jsplayer._cid+"::"+jsplayer._pwd)},_onMessage:function(e){if(e.data instanceof Blob){0==jsplayer._is_v_arv&&(jsplayer._is_v_arv=!0,jsplayer.msgHandle("PLAY_START","")),e.data.slice;var a=new FileReader;a.onload=function(){jsplayer._onMediaData(this.result),a=null},a.readAsArrayBuffer(e.data)}else{var i=e.data.split("::");jsplayer.msgHandle(i[0],i[1])}},msgHandle:function(){},_onMediaData:function(e){var a=new Uint8Array(e);this.pushRabMedia(a),a=null},_onClose:function(){jsplayer.msgHandle("PLAY_STOPED","")},pushRabMedia:function(e){var a=65536*(255&e[1])+256*(255&e[2])+(255&e[3]),i=!1;if(121==e[0]&&(i=!0),i===!0?jsplayer._lastSeq=a:(jsplayer._lastSeq+1&16777215)===a&&(jsplayer._lastSeq=a),jsplayer._lastSeq===a){for(var n=new Array,r=8;r<e.length;r++)n[r-8]=e[r];jsplayer._avc.decode(n),n=null}},_onPictureDecoded:function(e,a,i){(jsplayer._videoObj.width!=a||jsplayer._videoObj.height!=i)&&(jsplayer._videoObj.width=a,jsplayer._videoObj.height=i,jsplayer._videoContext=jsplayer._videoObj.getContext("2d"),jsplayer._videoData=jsplayer._videoContext.createImageData(a,i),console.log("Created context and image data "+a+" "+i),console.log(jsplayer._videoData)),yr(e,a,i,jsplayer._videoData.data),jsplayer._videoContext.putImageData(jsplayer._videoData,0,0),jsplayer._videoData.data=null},_avc:null,_nalBuffer:null,_lastSeq:null,_videoData:null,_videoObj:null},Size=function(){function e(e,a){this.w=e,this.h=a}return e.prototype={toString:function(){return"("+this.w+", "+this.h+")"},getHalfSize:function(){return new Size(this.w>>>1,this.h>>>1)},length:function(){return this.w*this.h}},e}();