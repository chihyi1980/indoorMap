/*! AtlasSdk 2016-05-30 */
!function(a){var b=a.prototype;b.icons=["atlas-mom-baby","atlas-lift","atlas-stairs","atlas-escalator","atlas-gate","atlas-question-down","atlas-cashier-desk","atlas-parking","atlas-toilet","atlas-toilet-man","atlas-toilet-woman","atlas-vip-service","atlas-handicapped","atlas-taxi","atlas-ticket-service","atlas-metro","atlas-atm"];var c=function(){return"ontouchstart"in window?{click:"touchend"}:{click:"click"}}(),d=function(a,b,c){var d,e,f,g=a.scrollTop,h=Math.ceil(c/60)+1,i=a.firstChild.offsetHeight-a.offsetHeight;return b=b>i?i:0>b?0:b,b==g?!1:(d=b-g,e=d/h,f=Math.abs(e),function j(){g+=e,a.scrollTop=g,f+=Math.abs(e),f>=Math.abs(d)||requestAnimFrame(j)}(),void 0)};b._createFloorUI=function(){var a=this;if(a.options.enFloorUI){var b=document.createElement("div");b.setAttribute("class","atlas-floor-bar"),a.zoomDiv.appendChild(b),a.floorDiv=b}else a.floorDiv=null},b._setFloorUI=function(){var a,b,e,f=this,g=f.floorDiv;if(0!=f.options.floorList.length&&g){a=document.createElement("span"),a.setAttribute("class","atlas-floor-prev"),g.appendChild(a),b=document.createElement("div"),b.setAttribute("class","atlas-floor-list"),g.appendChild(b),e=document.createElement("span"),e.setAttribute("class","atlas-floor-next"),g.appendChild(e);var h=f.options.floorList,i=document.createElement("ul"),j=["space"];h=j.concat(h.concat(j)),b.appendChild(i);var k=35,l=k*h.length;i.setAttribute("style","height:"+l+"px;"),h.forEach(function(a){var b=document.createElement("li");if(b.setAttribute("style","height:"+k+"px;line-height:"+k+"px"),"space"==a)i.appendChild(b);else if("object"==typeof a){var d=Object.keys(a)[0];b.innerHTML=d.indexOf("B")>-1?d.replace("Floor",""):d.replace("loor",""),i.appendChild(b);var e;b.addEventListener("touchstart",function(a){e=(new Date).getTime(),a.stopPropagation()}),b.addEventListener("touchmove",function(a){a.stopPropagation()}),b.addEventListener(c.click,function(a){a.preventDefault(),(new Date).getTime()-e>200||(f.setFloor(d),a.stopPropagation())},!1)}}),f._initFloor(f.curFloor);var m=function(a){var c,e=b.scrollTop,f=2*k,g=l-b.clientHeight+k;-1==a&&(c=e-f>=0?e-f:0),1==a&&(c=g>=e+f?e+f:g),d(b,c,1e3)};e.addEventListener(c.click,function(a){a.preventDefault(),m(1),a.stopPropagation()},!1),a.addEventListener(c.click,function(a){a.preventDefault(),m(-1),a.stopPropagation()},!1)}},b._initFloor=function(a){var b=this;if(b.floorDiv){var c=b.floorDiv,e=c.getElementsByTagName("li"),f=c.getElementsByClassName("atlas-floor-list")[0];a=a.indexOf("B")>-1?a.replace("Floor",""):a.replace("loor","");for(var g,h=0;h<e.length;++h)if(e[h].textContent==a){g=e[h];break}if(g){var i=document.querySelector(".atlas-floor-bar .atlas-floor-list li.active");i&&(i.className=i.className.replace("active","")),g.className?g.className+=" active":g.className="active";var j=35;d(f,g.offsetTop-f.offsetTop-j,1e3)}}},b._setFacUI=function(){var a=this;if(a.options.enFacUI){var b,d,e,f,g;b=document.createElement("div"),b.setAttribute("class","atlas-fac-bar open"),a.zoomDiv.appendChild(b),d=document.createElement("div"),d.setAttribute("class","atlas-fac-modal"),a.zoomDiv.appendChild(d),e=document.createElement("div"),e.setAttribute("class","content"),e.style.display="none",d.appendChild(e),f=document.createElement("ul"),g=document.createElement("ul"),g.style.display="none",e.appendChild(f),e.appendChild(g),b.addEventListener(c.click,function(a){"atlas-fac-bar open"==this.className?(this.className="atlas-fac-bar close",d.className="atlas-fac-modal open",e.style.display="block"):(this.className="atlas-fac-bar open",d.className="atlas-fac-modal",e.style.display="none"),a.stopPropagation()},!1);var h,i,j=[{id:"8|9|10",displayName:"洗手间"},{id:"16",displayName:"ATM"},{id:"5",displayName:"问讯处"},{id:"6",displayName:"收银台"},{id:"1",displayName:"直梯"},{id:"3",displayName:"扶梯"},{id:"4",displayName:"出入口"},{id:"2",displayName:"楼梯"}];j.forEach(function(g){h=document.createElement("li"),f.appendChild(h),i=document.createElement("span");var j=g.id.indexOf("|")>-1?g.id.split("|"):[g.id];i.innerHTML='<i class="atlas '+a.icons[+j[0]]+'"></i><br/><b>'+g.displayName+"</b>",h.appendChild(i),i.addEventListener(c.click,function(c){a.enFacility(j),d.className="",e.style.display="none",b.className="atlas-fac-bar open",c.stopPropagation()},!1)})}else console.log("Option 'enFacUI' need set to true(boolean)!")},b._buffering=function(){var a=this;if(a.options.enBufferUI)if(document.getElementsByClassName("atlas-buffer")[0])a.bufferDiv.style.display="block";else{var b=document.createElement("div");b.setAttribute("class","atlas-buffer"),a.zoomDiv.appendChild(b),a.bufferDiv=b}},b._stopBuffering=function(){var a=this;a.bufferDiv&&(a.bufferDiv.style.display="none")},b._setNavPrompt=function(a){var b,d=this;d.__navPrompt&&d.zoomDiv.removeChild(d.__navPrompt),b=document.createElement("div"),b.setAttribute("class","atlas-nav-bar"),b.style.height="0px";var e=4,f=0;!function l(){f+=e,b.style.height=f+"px",f>=40||requestAnimFrame(l)}();var g=document.createElement("h5");b.appendChild(g),g.textContent=a||"";var h=document.createElement("button");b.appendChild(h),h.setAttribute("class","exit"),h.textContent="退出 导航",h.addEventListener(c.click,function(a){setTimeout(function(){d._exitNav()},100),a.stopPropagation()});var i=document.createElement("button"),j=document.createElement("button");if(i.setAttribute("class","next"),j.setAttribute("class","prev"),b.appendChild(i),b.appendChild(j),i.addEventListener(c.click,function(a){d._stepToggle(!0),a.stopPropagation()}),j.addEventListener(c.click,function(a){d._stepToggle(!1),a.stopPropagation()}),d.__navSteps&&d.__navSteps.steps){var k=d.__navSteps.steps[0];d.curFloor!=k.fname?d.setFloor(k.fname,function(){d.moveTo(k.x,k.y)}):d.moveTo(k.x,k.y)}d.__navPrompt=b,d.__descTxt=g,d.zoomDiv.appendChild(b)},b._stepToggle=function(a){a=a||!1;var b=this,c=!1;if(!b.__stepLock&&b.__navSteps){if(b.__stepLock=!0,a?b.__navSteps.index<b.__navSteps.total-1?(b.__navSteps.index++,c=!0):c=!1:b.__navSteps.index>0?(b.__navSteps.index--,c=!0):c=!1,!c)return b.__stepLock=!1;var d=b.__navSteps.steps[b.__navSteps.index],e=b.__navSteps.logs[b.__navSteps.index];d.fname!=b.curFloor?b.setFloor(d.fname,function(){b.moveTo(d.x,d.y),b.__stepLock=!1,b.__descTxt&&(b.__descTxt.textContent=e)}):(b.moveTo(d.x,d.y),b.__stepLock=!1,b.__descTxt&&(b.__descTxt.textContent=e))}},b._exitNav=function(){var a=this;a.clearNavPath(),a.__navPrompt&&(a.zoomDiv.removeChild(a.__navPrompt),a.__navPrompt=null)}}(Atlas),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();